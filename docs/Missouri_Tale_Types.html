
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tale Types Scraper &#8212; Story Notes - Technical Recipes</title>
    
    <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=3e71fa63ecd7719e64b6668c6ad94fdbd645785a" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
    <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=4a2ab92203046145cabe39b99b7fdcd3c3c45e62"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Thompson Motif Index" href="Thompson_Motif_Index.html" />
    <link rel="prev" title="Doc2Vec Searching of Lang Database" href="Lang_Doc2Vec.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="pl-4 pr-3 bd-sidebar site-navigation noprint " id="site-navigation">
    <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Story Notes - Technical Recipes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="preface.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="how-to-read-this-book.html">
   How To Read This Book (Do Not Be Afraid)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="running-the-book-code.html">
   Invoking the Incantations Contained in This Book
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Story Collection Scrapers and Search
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="lang-fairy-books-db.html">
   A Full Text Searchable Database of Lang’s Fairy Books
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lang-fairy-books-db_PART_2.html">
   Finding Book Index-Like Things In Lang’s Fairy Stories…
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lang-fairy-books-db_PART_3.html">
   Annotating Lang’s Fairy Tales With Wikipedia Links
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lang-fairy-books-db_PART_4.html">
   Identifying Common Refrains / Repeating Phrases In Lang’s Fairy Story Collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Ashliman_folk_texts_scraper.html">
   Ashliman “Folklore and Mythology Electronic Texts” Scraper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MFTD-Multilingual_Folk_Tale_Database.html">
   Multilingual Folk Tale Database (MFTD)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notes &amp; Queries
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Notes_and_Queries_DB.html">
   Exploring Notes &amp; Queries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notes_and_Queries_DB_PART_2.html">
   Generating a Full Text Searchable Database for
   <em>
    Notes &amp; Queries
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notes_and_Queries_DB_PART_3.html">
   Building a 19th c. Notes &amp; Queries Full Text Search Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notes_and_Queries_DB_PART_4.html">
   Creating a 19th c. Notes &amp; Queries Index Database
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced Search Techniques
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Lang_Doc2Vec.html">
   Doc2Vec Searching of Lang Database
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tale Types
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Tale Types Scraper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Thompson_Motif_Index.html">
   Thompson Motif Index
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Wikipedia and DBPedia
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DBPedia_Aarne-Thompson-Uther_Search.html">
   Aarne-Thompson-Uther (ATU) Search
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/psychemedia/storynotes/main?urlpath=lab/tree/./Missouri_Tale_Types.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="./lite/retro/notebooks?path=./Missouri_Tale_Types.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch via RetroLite"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_jupyterlite.svg">
  </span>
<span class="headerbtn__text-container">RetroLite</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/psychemedia/storynotes"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tale Types Scraper
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#story-scraper">
   Story Scraper
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#identifying-openly-available-archive-org-resources">
     Identifying Openly Available
     <code class="docutils literal notranslate">
      <span class="pre">
       archive.org
      </span>
     </code>
     Resources
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Tale Types Scraper</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tale Types Scraper
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#story-scraper">
   Story Scraper
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#identifying-openly-available-archive-org-resources">
     Identifying Openly Available
     <code class="docutils literal notranslate">
      <span class="pre">
       archive.org
      </span>
     </code>
     Resources
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="tale-types-scraper">
<h1>Tale Types Scraper<a class="headerlink" href="#tale-types-scraper" title="Permalink to this headline">¶</a></h1>
<p>The University of Missouri Libraries publish a useful look-up table of AT, ATU and Thompson Motif codes which might be handy to have in a simple database.</p>
<p>The original pages can be found from this explanatory guide: <a class="reference external" href="https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7541717">https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7541717</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7609090&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests_cache</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="n">requests_cache</span><span class="o">.</span><span class="n">install_cache</span><span class="p">(</span><span class="s1">&#39;web_cache&#39;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;sqlite&#39;</span><span class="p">,</span> <span class="n">expire_after</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">requests_html</span> <span class="kn">import</span> <span class="n">HTMLSession</span>
 
<span class="n">session</span> <span class="o">=</span> <span class="n">HTMLSession</span><span class="p">()</span>
<span class="n">index_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The resource pages are linked from a menu bar. The links we want are all but the first and the last one:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">link_elements</span> <span class="o">=</span> <span class="n">index_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nav-tabs&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">link_elements</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;Element &#39;li&#39; class=(&#39;active&#39;,)&gt;,
 &lt;Element &#39;li&#39; class=()&gt;,
 &lt;Element &#39;li&#39; class=()&gt;,
 &lt;Element &#39;li&#39; class=()&gt;,
 &lt;Element &#39;li&#39; class=()&gt;,
 &lt;Element &#39;li&#39; class=()&gt;,
 &lt;Element &#39;li&#39; class=()&gt;,
 &lt;Element &#39;li&#39; class=()&gt;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//a/@href&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">link_elements</span><span class="p">]</span>
<span class="n">index_links</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7609090&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7610331&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7619154&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7620890&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7621605&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7624305&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7624836&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7635705&#39;]
</pre></div>
</div>
</div>
</div>
<p>The pages are split into separate tables which are embedded in particular block elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index_links</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># dot notation: . is class, # is id</span>
<span class="c1">#s-lib-box s-lib-box-std</span>
<span class="n">boxes</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.s-lib-box&#39;</span><span class="p">)</span>
<span class="n">boxes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;Element &#39;div&#39; id=&#39;s-lg-box-24196290&#39; class=(&#39;s-lib-box&#39;, &#39;s-lib-box-std&#39;)&gt;,
 &lt;Element &#39;div&#39; id=&#39;s-lg-box-24196308&#39; class=(&#39;s-lib-box&#39;, &#39;s-lib-box-std&#39;)&gt;,
 &lt;Element &#39;div&#39; id=&#39;s-lg-box-24197326&#39; class=(&#39;s-lib-box&#39;, &#39;s-lib-box-std&#39;)&gt;,
 &lt;Element &#39;div&#39; id=&#39;s-lg-box-24197327&#39; class=(&#39;s-lib-box&#39;, &#39;s-lib-box-std&#39;)&gt;,
 &lt;Element &#39;div&#39; id=&#39;s-lg-box-24197417&#39; class=(&#39;s-lib-box&#39;, &#39;s-lib-box-std&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<p>We can extract the box title as a category label:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">category</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<span class="n">category</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Tales of Magic - Magic Object 560 - 571&#39;
</pre></div>
</div>
</div>
</div>
<p>And we can grab the table within the box (I think there is just one table per box, so take the first, but we coul also go defensive on this to check for multiple tables…):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_table</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">example_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Element &#39;table&#39; class=(&#39;table&#39;, &#39;table-bordered&#39;) style=&#39;border: 0px solid rgb(180, 180, 180);&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_table</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;table class=&quot;table table-bordered&quot; style=&quot;border: 0px solid rgb(180, 180, 180);&quot;&gt;\n&lt;tbody&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;571 \\&amp;quot;All Stick Together\\&amp;quot;&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;width:256px;&quot;&gt;ATU Classification Type\xa0&lt;/td&gt;\n&lt;td style=&quot;width:276px;&quot;&gt;\xa0AT Classification Type\xa0\xa0&lt;/td&gt;\n&lt;td style=&quot;width:631px;&quot;&gt;Thompson Motif&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td style=&quot;width:631px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 571B Lover Exposed&lt;/td&gt;\n&lt;td&gt;AT 571B Himphamp&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1010. &amp;#x2020;H1010. Impossible tasks&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;H1010. †H1010. Impossible tasks&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;571B Lover Exposed&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D812.3. &amp;#x2020;D812.3. Magic object received from devil.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D812.3. †D812.3. Magic object received from devil.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;571B Lover Exposed&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1413.8. &amp;#x2020;D1413.8. Chamber-pot to which one sticks.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1413.8. †D1413.8. Chamber-pot to which one sticks.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;571B Lover Exposed&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 576 Magic Knife&lt;/td&gt;\n&lt;td&gt;AT 576 Magic Knife&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D838. &amp;#x2020;D838. Magic object acquired by stealing&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D838. †D838. Magic object acquired by stealing&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;576 Magic Knife&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1083. &amp;#x2020;D1083. Magic knife.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1083. †D1083. Magic knife.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;576 Magic Knife&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1400.1.4.3. &amp;#x2020;D1400.1.4.3. Magic knife conquers enemy.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1400.1.4.3. †D1400.1.4.3. Magic knife conquers enemy.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;576 Magic Knife&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 577 The King\&#39;s Tasks&lt;/td&gt;\n&lt;td&gt;AT 577 The King\&#39;s Tasks&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H335. &amp;#x2020;H335. Tasks assigned suitors.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;H335. †H335. Tasks assigned suitors.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;577 The King\&#39;s Tasks&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1601.14. &amp;#x2020;D1601.14. Self-chopping axe.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1601.14. †D1601.14. Self-chopping axe.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;577 The King\&#39;s Tasks&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1601.15. &amp;#x2020;D1601.15. Automatic shovel.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1601.15. †D1601.15. Automatic shovel.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;577 The King\&#39;s Tasks&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1601.18.2. &amp;#x2020;D1601.18.2. Self-playing violin.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1601.18.2. †D1601.18.2. Self-playing violin.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;577 The King\&#39;s Tasks&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1581. &amp;#x2020;D1581. Tasks performed by use of magic object.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1581. †D1581. Tasks performed by use of magic object.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;577 The King\&#39;s Tasks&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H971.1. &amp;#x2020;H971.1. Tasks performed with help of old woman&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H971.1. †H971.1. Tasks performed with help of old woman&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;577 The King\&#39;s Tasks&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 580 Beloved of Women&lt;/td&gt;\n&lt;td&gt;AT 580 Beloved of Women&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1900. &amp;#x2020;D1900. Love induced by magic.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1900. †D1900. Love induced by magic.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;580 Beloved of Women&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D856. &amp;#x2020;D856. Magic object acquired by gaining love of owner.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D856. †D856. Magic object acquired by gaining love of owner.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;580 Beloved of Women&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1472.1.7. &amp;#x2020;D1472.1.7. Magic table supplies food and drink.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1472.1.7. †D1472.1.7. Magic table supplies food and drink.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;580 Beloved of Women&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1473. &amp;#x2020;D1473. Magic object furnishes clothes.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1473. †D1473. Magic object furnishes clothes.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;580 Beloved of Women&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;T45. &amp;#x2020;T45. Lover buys admission to woman\&#39;s room.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;T45. †T45. Lover buys admission to woman\&#39;s room.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;580 Beloved of Women&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 566 Three Magic Objects and Wonderful Fruits&lt;/td&gt;\n&lt;td&gt;AT 580* Money without End (now ATU 566)&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1451. &amp;#x2020;D1451. Inexhaustible purse furnishes money.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1451. †D1451. Inexhaustible purse furnishes money.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 303 The Twins or Blood-Brothers&lt;/td&gt;\n&lt;td&gt;AT 581 Twin Brother and Thier Magic Objects (now ATU 303)&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1081. &amp;#x2020;D1081. Magic sword.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1081. †D1081. Magic sword.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;303 The Twins or Blood-Brothers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 585 Spindle, Shuttle, and Needle&lt;/td&gt;\n&lt;td&gt;AT 585 Spindle, Shuttle, and Needle&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1311.2. &amp;#x2020;H1311.2. Quest for bride richest and poorest.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H1311.2. †H1311.2. Quest for bride richest and poorest.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;585 Spindle, Shuttle, and Needle&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1425.1. &amp;#x2020;D1425.1. Magic spindle brings back prince for heroine.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1425.1. †D1425.1. Magic spindle brings back prince for heroine.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;585 Spindle, Shuttle, and Needle&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1484.1. &amp;#x2020;D1484.1. Magic shuttle makes road.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1484.1. †D1484.1. Magic shuttle makes road.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;585 Spindle, Shuttle, and Needle&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1337.1.7. &amp;#x2020;D1337.1.7. Magic needle transforms a room from plainness to beauty.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1337.1.7. †D1337.1.7. Magic needle transforms a room from plainness to beauty.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;585 Spindle, Shuttle, and Needle&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 590 Faithless Mother&lt;/td&gt;\n&lt;td&gt;AT 590 Magic Belt&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1840. &amp;#x2020;D1840. Magic invulnerability.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1840. †D1840. Magic invulnerability.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;589 Faithless Mother&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1335.4. &amp;#x2020;D1335.4. Magic belt gives strength&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1335.4. †D1335.4. Magic belt gives strength&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;589 Faithless Mother&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;S12.1. &amp;#x2020;S12.1. Treacherous mother marries ogre and plots against son.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;S12.1. †S12.1. Treacherous mother marries ogre and plots against son.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H931. &amp;#x2020;H931. Tasks assigned in order to get rid of hero.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H931. †H931. Tasks assigned in order to get rid of hero.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1212. &amp;#x2020;H1212. Quest assigned because of feigned illness.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H1212. †H1212. Quest assigned because of feigned illness.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1333.3.1.1. &amp;#x2020;H1333.3.1.1. Quest for magic apple&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;H1333.3.1.1. †H1333.3.1.1. Quest for magic apple&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1361. &amp;#x2020;H1361. Quest for lion\&#39;s milk.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;H1361. †H1361. Quest for lion\&#39;s milk.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;F615. &amp;#x2020;F615. Strong man evades death.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;F615. †F615. Strong man evades death.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;B431.2. &amp;#x2020;B431.2. Helpful lion.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;B431.2. †B431.2. Helpful lion.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;K975. &amp;#x2020;K975. Secret of strength treacherously discovered.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;K975. †K975. Secret of strength treacherously discovered.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D861. &amp;#x2020;D861. Magic object stolen&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D861. †D861. Magic object stolen&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;B512. &amp;#x2020;B512. Medicine shown by animal.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;B512. †B512. Medicine shown by animal.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D880. &amp;#x2020;D880. Recovery of magic object.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D880. †D880. Recovery of magic object.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 592 The Dance Among Thorns&lt;/td&gt;\n&lt;td&gt;AT 592 Dancing in Thorns&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;S322.4. &amp;#x2020;S322.4. Evil stepmother casts boy forth.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;S322.4. †S322.4. Evil stepmother casts boy forth.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;592 The Dance Among Thorns&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;Q42.1. &amp;#x2020;Q42.1. Spendthrift knight.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;Q42.1. †Q42.1. Spendthrift knight.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;592 The Dance Among Thorns&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1761.0.2. &amp;#x2020;D1761.0.2. Limited number of wishes granted.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1761.0.2. †D1761.0.2. Limited number of wishes granted.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;592 The Dance Among Thorns&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1653.1.7. &amp;#x2020;D1653.1.7. Infallible gun.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1653.1.7. †D1653.1.7. Infallible gun.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;592 The Dance Among Thorns&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1415.2.5. &amp;#x2020;D1415.2.5. Magic fiddle causes dancing.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1415.2.5. †D1415.2.5. Magic fiddle causes dancing.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;592 The Dance Among Thorns&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N55. &amp;#x2020;N55. Shooting contest on wager.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;N55. †N55. Shooting contest on wager.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;592 The Dance Among Thorns&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;K551.3.1. &amp;#x2020;K551.3.1. Respite from death while one plays the fiddle&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;K551.3.1. †K551.3.1. Respite from death while one plays the fiddle&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;592 The Dance Among Thorns&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 593 Fiddevav&lt;/td&gt;\n&lt;td&gt;AT 593 Blowing Up the Fire&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N825.3. &amp;#x2020;N825.3. Old woman helper.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;N825.3. †N825.3. Old woman helper.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;593 Fiddevav&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1413. &amp;#x2020;D1413. Magic object holds person fast.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1413. †D1413. Magic object holds person fast.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;593 Fiddevav&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1413.17. &amp;#x2020;D1413.17. Magic adhesive stone.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1413.17. †D1413.17. Magic adhesive stone.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;593 Fiddevav&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D2172.1. &amp;#x2020;D2172.1. Magic repetition.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D2172.1. †D2172.1. Magic repetition.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;593 Fiddevav&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 610 The Healing Fruit&lt;/td&gt;\n&lt;td&gt;AT 610 Fruit to Cure the Princess&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;T68.1. &amp;#x2020;T68.1. Princess offered as prize to rescuer.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;T68.1. †T68.1. Princess offered as prize to rescuer.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H346. &amp;#x2020;H346. Princess given to man who can heal her.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H346. †H346. Princess given to man who can heal her.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;Q2. &amp;#x2020;Q2. Kind and unkind.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;Q2. †Q2. Kind and unkind.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;L13. &amp;#x2020;L13. Compassionate youngest son.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;L13. †L13. Compassionate youngest son.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;L10. &amp;#x2020;L10. Victorious youngest son.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;L10. †L10. Victorious youngest son.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N825.3. &amp;#x2020;N825.3. Old woman helper.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;N825.3. †N825.3. Old woman helper.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1500.1.5. &amp;#x2020;D1500.1.5. Magic healing fruit.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1500.1.5. †D1500.1.5. Magic healing fruit.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1010. &amp;#x2020;H1010. Impossible tasks&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;H1010. †H1010. Impossible tasks&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1533.1.1. &amp;#x2020;D1533.1.1. Magic land and water ship.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D1533.1.1. †D1533.1.1. Magic land and water ship.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1112. &amp;#x2020;H1112. Task: herding rabbits.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;H1112. †H1112. Task: herding rabbits.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H1331.1.2.1. &amp;#x2020;H1331.1.2.1. Quest for remarkable bird feathers.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H1331.1.2.1. †H1331.1.2.1. Quest for remarkable bird feathers.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;L161. &amp;#x2020;L161. Lowly hero marries princess&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;L161. †L161. Lowly hero marries princess&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;610 The Healing Fruit&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 612 The Three Snake-Leaves&lt;/td&gt;\n&lt;td&gt;AT 612 The Three Snake-Leaves&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;M254. &amp;#x2020;M254. Promise to be buried with wife if she dies first.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;M254. †M254. Promise to be buried with wife if she dies first.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;B512. &amp;#x2020;B512. Medicine shown by animal.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;B512. †B512. Medicine shown by animal.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;B491.1. &amp;#x2020;B491.1. Helpful serpent.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;B491.1. †B491.1. Helpful serpent.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1500.1.4. &amp;#x2020;D1500.1.4. Magic healing plant.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1500.1.4. †D1500.1.4. Magic healing plant.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;E165. &amp;#x2020;E165. Resuscitation of wife by husband giving up half his remaining life.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;E165. †E165. Resuscitation of wife by husband giving up half his remaining life.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;K2213.5. &amp;#x2020;K2213.5. The faithless resuscitated wife&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;K2213.5. †K2213.5. The faithless resuscitated wife&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;K2213.2. &amp;#x2020;K2213.2. Faithless wife and paramour throw hero overboard.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;K2213.2. †K2213.2. Faithless wife and paramour throw hero overboard.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;S142. &amp;#x2020;S142. Person thrown into the water and abandoned.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;S142. †S142. Person thrown into the water and abandoned.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;P361. &amp;#x2020;P361. Faithful servant.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;P361. †P361. Faithful servant.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;E105. &amp;#x2020;E105. Resuscitation by herbs (leaves).&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;E105. †E105. Resuscitation by herbs (leaves).&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;612 The Three Snake-Leaves&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 613 The Two Travelers&lt;/td&gt;\n&lt;td&gt;AT 613 The Two Travelers: Truth and Falsehood&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N61. &amp;#x2020;N61. Wager that falsehood is better than truth.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;N61. †N61. Wager that falsehood is better than truth.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;K451.1. &amp;#x2020;K451.1. Unjust umpire decides a religious dispute&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;K451.1. †K451.1. Unjust umpire decides a religious dispute&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N92. &amp;#x2020;N92. Wager to win or lose according to whether jackal howls or ass brays before game is finished.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;N92. †N92. Wager to win or lose according to whether jackal howls or ass brays before game is finished.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N2.3.3. &amp;#x2020;N2.3.3. Eyes wagered.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;N2.3.3. †N2.3.3. Eyes wagered.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;M225. &amp;#x2020;M225. Eyes exchanged for food.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;M225. †M225. Eyes exchanged for food.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;F1045. &amp;#x2020;F1045. Night spent in tree.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;F1045. †F1045. Night spent in tree.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N451.1. &amp;#x2020;N451.1. Secrets of animals (demons) accidentally overheard from tree (bridge) hiding place.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;N451.1. †N451.1. Secrets of animals (demons) accidentally overheard from tree (bridge) hiding place.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D1505.5. &amp;#x2020;D1505.5. Magic water restores sight.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;D1505.5. †D1505.5. Magic water restores sight.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;D2064.1. &amp;#x2020;D2064.1. Magic sickness because girl has thrown away her consecrated wafer.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;D2064.1. †D2064.1. Magic sickness because girl has thrown away her consecrated wafer.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;F933.2. &amp;#x2020;F933.2. Dry spring restored by removal of certain stone.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;F933.2. †F933.2. Dry spring restored by removal of certain stone.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H346. &amp;#x2020;H346. Princess given to man who can heal her.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H346. †H346. Princess given to man who can heal her.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;N471. &amp;#x2020;N471. Foolish attempt of second man to overhear secrets (from animals, demons etc.).&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;N471. †N471. Foolish attempt of second man to overhear secrets (from animals, demons etc.).&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;613 The Two Travelers&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;ATU 857 Louse-Skin&lt;/td&gt;\n&lt;td&gt;AT 621 The Louse-Skin (now ATU 857)&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;B873.1. &amp;#x2020;B873.1. Giant louse.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;B873.1. †B873.1. Giant louse.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;857 Louse-Skin&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;F983.2. &amp;#x2020;F983.2. Louse fattened.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;F983.2. †F983.2. Louse fattened.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;857 Louse-Skin&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H551. &amp;#x2020;H551. Princess offered to man who can out-riddle her.&amp;quot;}&quot; style=&quot;width:631px;&quot;&gt;H551. †H551. Princess offered to man who can out-riddle her.&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;857 Louse-Skin&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H522.1. &amp;#x2020;H522.1. Test: guessing origin of certain skin.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H522.1. †H522.1. Test: guessing origin of certain skin.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr height=&quot;21&quot;&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;857 Louse-Skin&amp;quot;}&quot; height=&quot;21&quot; style=&quot;height:21px;&quot;&gt;\xa0&lt;/td&gt;\n&lt;td&gt;\xa0&lt;/td&gt;\n&lt;td data-sheets-value=&quot;{&amp;quot;1&amp;quot;:2,&amp;quot;2&amp;quot;:&amp;quot;H573.3. &amp;#x2020;H573.3. Riddle solved by listening to propounder talk in his sleep.&amp;quot;}&quot;&gt;\n&lt;div&gt;\n&lt;div&gt;H573.3. †H573.3. Riddle solved by listening to propounder talk in his sleep.&lt;/div&gt;\n&lt;/div&gt;\n&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;&#39;
</pre></div>
</div>
</div>
</div>
<p>We can parse that table into a pandas dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1">#Parse HTML table as dataframe</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">example_table</span><span class="o">.</span><span class="n">html</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ATU Classification Type</td>
      <td>AT Classification Type</td>
      <td>Thompson Motif</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 571B Lover Exposed</td>
      <td>AT 571B Himphamp</td>
      <td>H1010. †H1010. Impossible tasks</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
    </tr>
    <tr>
      <th>84</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>F983.2. †F983.2. Louse fattened.</td>
    </tr>
    <tr>
      <th>85</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>H551. †H551. Princess offered to man who can o...</td>
    </tr>
    <tr>
      <th>86</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
    </tr>
    <tr>
      <th>87</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
    </tr>
  </tbody>
</table>
<p>88 rows × 3 columns</p>
</div></div></div>
</div>
<p>The first table in the page has a structure distinct from all the rest. In particular, it includes some blank lines and the column headers.</p>
<p>We could parse out the column headers, or we could set them explicitly. For conveniences, let’s set them explicilty, then remove them if they appear in the table.</p>
<p>For the first table in the page, we can then tidy up the dataframe by dropping at least the first three lines (the index count strats at 0), as well as dropping empty rows, resetting the index to account for that, and replacing null values with an empty string:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">example_table</span><span class="o">.</span><span class="n">html</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Do some cleaning</span>
<span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">,</span> <span class="s2">&quot;AT Classification Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Thompson Motif&quot;</span><span class="p">]</span>
<span class="c1">#Explicitly set column names</span>
<span class="n">table_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames</span>

<span class="c1"># Remove column names if they were in the table and reset the indeex</span>
<span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">table_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td></td>
      <td>D1083. †D1083. Magic knife.</td>
    </tr>
    <tr>
      <th>4</th>
      <td></td>
      <td></td>
      <td>D1400.1.4.3. †D1400.1.4.3. Magic knife conquer...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>80</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
    </tr>
    <tr>
      <th>81</th>
      <td></td>
      <td></td>
      <td>F983.2. †F983.2. Louse fattened.</td>
    </tr>
    <tr>
      <th>82</th>
      <td></td>
      <td></td>
      <td>H551. †H551. Princess offered to man who can o...</td>
    </tr>
    <tr>
      <th>83</th>
      <td></td>
      <td></td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
    </tr>
    <tr>
      <th>84</th>
      <td></td>
      <td></td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
    </tr>
  </tbody>
</table>
<p>85 rows × 3 columns</p>
</div></div></div>
</div>
<p>We notice that sometimes there are blanks in the ATU and AT columns, the assumption being that the values are inherited from above. We can explicitly fill down these values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>
<span class="n">table_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1083. †D1083. Magic knife.</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1400.1.4.3. †D1400.1.4.3. Magic knife conquer...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>80</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
    </tr>
    <tr>
      <th>81</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>F983.2. †F983.2. Louse fattened.</td>
    </tr>
    <tr>
      <th>82</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H551. †H551. Princess offered to man who can o...</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
    </tr>
    <tr>
      <th>84</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
    </tr>
  </tbody>
</table>
<p>85 rows × 3 columns</p>
</div></div></div>
</div>
<p>We can also add in the category:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>
<span class="n">table_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1083. †D1083. Magic knife.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1400.1.4.3. †D1400.1.4.3. Magic knife conquer...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>80</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>81</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>F983.2. †F983.2. Louse fattened.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>82</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H551. †H551. Princess offered to man who can o...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
    <tr>
      <th>84</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
    </tr>
  </tbody>
</table>
<p>85 rows × 4 columns</p>
</div></div></div>
</div>
<p>For the other tables, we don’t need to drop any rows and we can recycle the column names, retaining the empty row dropper and null value cleaner just in case.</p>
<p>Some of the other tables may have column names, others may not. So let’s always add column names explicitly, then drop any row that appears to duplicate them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Work with the second table in a page... </span>
<span class="n">example_df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">boxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">example_df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">columns</span>
<span class="c1"># Remove column names if they were in the table</span>
<span class="n">example_df2</span> <span class="o">=</span> <span class="n">example_df2</span><span class="p">[</span><span class="n">example_df2</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span>

<span class="n">example_df2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>ATU Classification Type</td>
      <td>AT Classification Type</td>
      <td>Thompson Motif</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>ATU 571B Lover Exposed</td>
      <td>AT 571B Himphamp</td>
      <td>H1010. †H1010. Impossible tasks</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>82</th>
      <td>83</td>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
    </tr>
    <tr>
      <th>83</th>
      <td>84</td>
      <td></td>
      <td></td>
      <td>F983.2. †F983.2. Louse fattened.</td>
    </tr>
    <tr>
      <th>84</th>
      <td>85</td>
      <td></td>
      <td></td>
      <td>H551. †H551. Princess offered to man who can o...</td>
    </tr>
    <tr>
      <th>85</th>
      <td>86</td>
      <td></td>
      <td></td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
    </tr>
    <tr>
      <th>86</th>
      <td>87</td>
      <td></td>
      <td></td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
    </tr>
  </tbody>
</table>
<p>87 rows × 4 columns</p>
</div></div></div>
</div>
<p>Some of the tables include “metadata” rows rather than splitting things into separate pages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index_links</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

<span class="c1"># dot notation: . is class, # is id</span>
<span class="c1">#s-lib-box s-lib-box-std</span>
<span class="n">boxes</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.s-lib-box&#39;</span><span class="p">)</span>
<span class="n">borked_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">borked_df</span> <span class="o">=</span> <span class="n">borked_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">borked_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames</span>
<span class="n">borked_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>ATU 1008 Lighting the Road</td>
      <td>AT 1008 Lighting the Way by Setting the Barn o...</td>
      <td>K1412. Lighting the road (or painting the hous...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>ATU 1009 Guarding the Store-room Door</td>
      <td>AT 1009 Guarding the Door by Carrying it Away</td>
      <td>K1413. Guarding the door.</td>
    </tr>
    <tr>
      <th>12</th>
      <td>ATU 1010 Repairing the House</td>
      <td>AT 1010 Fixing Things Up</td>
      <td>K1415. Repairing the house</td>
    </tr>
    <tr>
      <th>13</th>
      <td>ATU 1011 Tearing up the Orchard (Vineyard)</td>
      <td>AT 1011 Cutting Down the Orchard</td>
      <td>K1416. Tearing up the orchard (vineyard).</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ATU 1012 Cleaning the Child</td>
      <td>AT 1012 Cleaning the Master's Child</td>
      <td>K1461.1. Cleaning the child.</td>
    </tr>
    <tr>
      <th>15</th>
      <td>ATU 1013 Bathing (Warming) Grandmother</td>
      <td>AT 1013 Bathing the Grandmother in Boiling Water</td>
      <td>K1462. Washing the grandmother -- in boiling w...</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ATU 1029 The woman as Cuckoo in the Tree</td>
      <td>AT 1029 The Bargain Ends When the Cuckoo Sings</td>
      <td>K1691. The woman as cuckoo on the tree shot down.</td>
    </tr>
    <tr>
      <th>17</th>
      <td>_____________</td>
      <td>_____________</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
    </tr>
    <tr>
      <th>18</th>
      <td>ATU 1030 The Crop Division</td>
      <td>AT 1030 Man and Ogre Share the Harvest</td>
      <td>K171.1. Deceptive crop division: above the gro...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ATU 1036 Hogs with Curly Tails</td>
      <td>AT 1036 Hogs with Curly Tails</td>
      <td>K171.4. Deceptive division of pigs: curly and ...</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ATU 1045 Pulling the Lake Together</td>
      <td>AT 1045 Pulling Down the Forest with a Rope</td>
      <td>K1744. Hero threatens to pull the lake togethe...</td>
    </tr>
    <tr>
      <th>21</th>
      <td>ATU 1049 The heavy axe</td>
      <td>AT 1049 The heavy Axe or the Giant Bucket</td>
      <td>K1741.1. Felling the whole forest.</td>
    </tr>
    <tr>
      <th>22</th>
      <td></td>
      <td></td>
      <td>K1741.3. Bringing the whole well.</td>
    </tr>
    <tr>
      <th>23</th>
      <td>ATU 1050 Felling trees</td>
      <td>AT 1050 Contest in Felling Trees</td>
      <td>K44. Deceptive contest in chopping.</td>
    </tr>
    <tr>
      <th>24</th>
      <td></td>
      <td></td>
      <td>K178. Deceptive bargain: felling the tree.</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can split the table on these “headers” and use the new heading as the category:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find index of split rows</span>
<span class="n">borked_df</span><span class="p">[</span><span class="n">borked_df</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17</th>
      <td>_____________</td>
      <td>_____________</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
    </tr>
    <tr>
      <th>29</th>
      <td>_____________</td>
      <td>_____________</td>
      <td>Contest between Man and Ogre 1060 - 1114</td>
    </tr>
    <tr>
      <th>53</th>
      <td>_____________</td>
      <td>_____________</td>
      <td>Man Kills (Injures) Ogre 1115 - 1144</td>
    </tr>
    <tr>
      <th>72</th>
      <td>_____________</td>
      <td>_____________</td>
      <td>Ogre Frightened by Man 1145 - 1154</td>
    </tr>
    <tr>
      <th>80</th>
      <td>_____________</td>
      <td>_____________</td>
      <td>Man Outwits the Devil 1155 - 1169</td>
    </tr>
    <tr>
      <th>92</th>
      <td>_____________</td>
      <td>_____________</td>
      <td>Souls Saved from the Devil 1170 - 1199</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we get the index values of these we can iteratively split the dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">split_indexes</span> <span class="o">=</span> <span class="n">borked_df</span><span class="p">[</span><span class="n">borked_df</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">split_indexes</span>

<span class="n">split_dfs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">prev_ix</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">split_indexes</span><span class="p">:</span>
    <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">borked_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">prev_ix</span><span class="p">:</span><span class="n">ix</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">split_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_df</span><span class="p">)</span>
    <span class="n">prev_ix</span> <span class="o">=</span> <span class="n">ix</span>

<span class="c1"># Remaining part:</span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">borked_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">prev_ix</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">split_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first row of each of the split dataframes contains the new category:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">split_dfs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ATU Classification Type                               _____________
AT Classification Type                                _____________
Thompson Motif             Contest between Man and Ogre 1060 - 1114
Name: 0, dtype: object
</pre></div>
</div>
</div>
</div>
<p>We can process the dataframes by extracting the category, updating the dataframe with it, and dropping the metadata row:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">split_df</span> <span class="ow">in</span> <span class="n">split_dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">split_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">split_df</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>
    <span class="c1"># Because we are modifying the dataframes as referenced objects, we change them inplace</span>
    <span class="n">split_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">split_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">split_dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ATU 1030 The Crop Division</td>
      <td>AT 1030 Man and Ogre Share the Harvest</td>
      <td>K171.1. Deceptive crop division: above the gro...</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ATU 1036 Hogs with Curly Tails</td>
      <td>AT 1036 Hogs with Curly Tails</td>
      <td>K171.4. Deceptive division of pigs: curly and ...</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 1045 Pulling the Lake Together</td>
      <td>AT 1045 Pulling Down the Forest with a Rope</td>
      <td>K1744. Hero threatens to pull the lake togethe...</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 1049 The heavy axe</td>
      <td>AT 1049 The heavy Axe or the Giant Bucket</td>
      <td>K1741.1. Felling the whole forest.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
    </tr>
    <tr>
      <th>4</th>
      <td></td>
      <td></td>
      <td>K1741.3. Bringing the whole well.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can split out each row into more detail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ATU_splitter</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split out ATU Classification type elements.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cell</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="c1">#&quot;ATU_code&quot;:&quot; &quot;.join(parts[:2]),</span>
                          <span class="s2">&quot;ATU_code&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="s2">&quot;ATU_label&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:])})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;ATU_code&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;ATU_label&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>

<span class="n">table_df</span><span class="p">[[</span><span class="s2">&quot;ATU_code&quot;</span><span class="p">,</span><span class="s2">&quot;ATU_label&quot;</span><span class="p">]]</span><span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ATU_splitter</span><span class="p">)</span>
<span class="n">table_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
      <th>ATU_code</th>
      <th>ATU_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1083. †D1083. Magic knife.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1400.1.4.3. †D1400.1.4.3. Magic knife conquer...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>80</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
    </tr>
    <tr>
      <th>81</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>F983.2. †F983.2. Louse fattened.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
    </tr>
    <tr>
      <th>82</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H551. †H551. Princess offered to man who can o...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
    </tr>
    <tr>
      <th>84</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
    </tr>
  </tbody>
</table>
<p>85 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AT_splitter</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split out AT Classification type elements.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cell</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="c1">#&quot;AT_code&quot;:&quot; &quot;.join(parts[:2]),</span>
                          <span class="s2">&quot;AT_code&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="s2">&quot;AT_label&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:])})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;AT_code&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;AT_label&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>

<span class="n">table_df</span><span class="p">[[</span><span class="s2">&quot;AT_code&quot;</span><span class="p">,</span><span class="s2">&quot;AT_label&quot;</span><span class="p">]]</span><span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;AT Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">AT_splitter</span><span class="p">)</span>
<span class="n">table_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
      <th>ATU_code</th>
      <th>ATU_label</th>
      <th>AT_code</th>
      <th>AT_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1083. †D1083. Magic knife.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1400.1.4.3. †D1400.1.4.3. Magic knife conquer...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>80</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
    </tr>
    <tr>
      <th>81</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>F983.2. †F983.2. Louse fattened.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
    </tr>
    <tr>
      <th>82</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H551. †H551. Princess offered to man who can o...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
    </tr>
    <tr>
      <th>84</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
    </tr>
  </tbody>
</table>
<p>85 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Thompson_Motif_splitter</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split out Thompson Motif elements.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cell</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;Motif_code&quot;</span><span class="p">:</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="s2">&quot;Motif_label&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;Motif_code&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;Motif_label&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>

<span class="n">table_df</span><span class="p">[[</span><span class="s2">&quot;Motif_code&quot;</span><span class="p">,</span><span class="s2">&quot;Motif_label&quot;</span><span class="p">]]</span><span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;Thompson Motif&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Thompson_Motif_splitter</span><span class="p">)</span>
<span class="n">table_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
      <th>ATU_code</th>
      <th>ATU_label</th>
      <th>AT_code</th>
      <th>AT_label</th>
      <th>Motif_code</th>
      <th>Motif_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>D812.3</td>
      <td>†D812.3. Magic object received from devil.</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>D1413.8</td>
      <td>†D1413.8. Chamber-pot to which one sticks.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>D838</td>
      <td>†D838. Magic object acquired by stealing</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1083. †D1083. Magic knife.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>D1083</td>
      <td>†D1083. Magic knife.</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D1400.1.4.3. †D1400.1.4.3. Magic knife conquer...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>D1400.1.4.3</td>
      <td>†D1400.1.4.3. Magic knife conquers enemy.</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>80</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>B873.1. †B873.1. Giant louse.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
      <td>B873.1</td>
      <td>†B873.1. Giant louse.</td>
    </tr>
    <tr>
      <th>81</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>F983.2. †F983.2. Louse fattened.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
      <td>F983.2</td>
      <td>†F983.2. Louse fattened.</td>
    </tr>
    <tr>
      <th>82</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H551. †H551. Princess offered to man who can o...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
      <td>H551</td>
      <td>†H551. Princess offered to man who can out-rid...</td>
    </tr>
    <tr>
      <th>83</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H522.1. †H522.1. Test: guessing origin of cert...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
      <td>H522.1</td>
      <td>†H522.1. Test: guessing origin of certain skin.</td>
    </tr>
    <tr>
      <th>84</th>
      <td>ATU 857 Louse-Skin</td>
      <td>AT 621 The Louse-Skin (now ATU 857)</td>
      <td>H573.3. †H573.3. Riddle solved by listening to...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>857</td>
      <td>Louse-Skin</td>
      <td>621</td>
      <td>The Louse-Skin (now ATU 857)</td>
      <td>H573.3</td>
      <td>†H573.3. Riddle solved by listening to propoun...</td>
    </tr>
  </tbody>
</table>
<p>85 rows × 10 columns</p>
</div></div></div>
</div>
<p>We can add those codes to a simple database. Let’s create the database first:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlite_utils</span> <span class="kn">import</span> <span class="n">Database</span>

<span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;tale_types_demo.db&quot;</span>

<span class="c1"># While developing the script, recreate database each time...</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">db_name</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;tale_types&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete_where</span><span class="p">()</span>

<span class="n">table_df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;tale_types&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/site-packages/pandas/core/generic.py:2872: UserWarning: The spaces in these column names will not be changed. In pandas versions &lt; 0.14, spaces were converted to underscores.
  sql.to_sql(
</pre></div>
</div>
</div>
</div>
<p>Try a test query:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">read_sql</span>

<span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tale_types LIMIT 3&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
      <th>ATU_code</th>
      <th>ATU_label</th>
      <th>AT_code</th>
      <th>AT_label</th>
      <th>Motif_code</th>
      <th>Motif_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>D812.3</td>
      <td>†D812.3. Magic object received from devil.</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>D1413.8</td>
      <td>†D1413.8. Chamber-pot to which one sticks.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>D838</td>
      <td>†D838. Magic object acquired by stealing</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can create a simple function to scrape all the tables on the page, process them and add them to the database.</p>
<p>We can also add the page title as a column entry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_dataframe1</span><span class="p">(</span><span class="n">table_df</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process the &quot;&quot;&quot;</span>
    <span class="c1">#Explicitly set column names</span>
    <span class="n">table_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">,</span> <span class="s2">&quot;AT Classification Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Thompson Motif&quot;</span><span class="p">]</span>

    <span class="c1"># Remove column names if they were in the table</span>
    <span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">table_df</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>
   
    <span class="k">return</span> <span class="n">table_df</span>

<span class="k">def</span> <span class="nf">patch_motif_label</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fix borked motif label.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cell</span> <span class="ow">and</span> <span class="n">cell</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;†&quot;</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">return</span>  <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;Motif_label&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">&quot;Motif_label&quot;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>
    
<span class="k">def</span> <span class="nf">process_dataframe2</span><span class="p">(</span><span class="n">table_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process the &quot;&quot;&quot;</span>   
    <span class="c1"># Fill down on blanks</span>
    <span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>
    <span class="n">table_df</span><span class="p">[[</span><span class="s2">&quot;ATU_code&quot;</span><span class="p">,</span><span class="s2">&quot;ATU_label&quot;</span><span class="p">]]</span><span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ATU_splitter</span><span class="p">)</span>
    <span class="n">table_df</span><span class="p">[[</span><span class="s2">&quot;AT_code&quot;</span><span class="p">,</span><span class="s2">&quot;AT_label&quot;</span><span class="p">]]</span><span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;AT Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">AT_splitter</span><span class="p">)</span>
    <span class="n">table_df</span><span class="p">[[</span><span class="s2">&quot;Motif_code&quot;</span><span class="p">,</span><span class="s2">&quot;Motif_label&quot;</span><span class="p">]]</span><span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;Thompson Motif&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Thompson_Motif_splitter</span><span class="p">)</span>
    
    <span class="c1"># There may be some cruft in Motif_label</span>
    <span class="n">table_df</span><span class="p">[[</span><span class="s2">&quot;Motif_label&quot;</span><span class="p">]]</span><span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;Motif_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">patch_motif_label</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">table_df</span>

    
<span class="k">def</span> <span class="nf">scrape_page_tables</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scrape all the tables on the page.&quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="c1"># dot notation: . is class, # is id</span>
    <span class="c1">#s-lib-box s-lib-box-std</span>
    <span class="n">boxes</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.s-lib-box&#39;</span><span class="p">)</span>
    
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">box</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">boxes</span><span class="p">):</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
        
        <span class="c1"># Some pages have cruft boxes with no tables</span>
        <span class="n">_tables</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_tables</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">_tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># There may be cruft empty tables at the top of the page</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">table_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">html</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">html</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">table_df</span> <span class="o">=</span> <span class="n">process_dataframe1</span><span class="p">(</span><span class="n">table_df</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>

        <span class="c1"># Some dataframes are actually multiple dataframes</span>
        <span class="n">split_indexes</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Classification Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">split_indexes</span><span class="p">:</span>
            <span class="n">split_dfs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">prev_ix</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">split_indexes</span><span class="p">:</span>
                <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">prev_ix</span><span class="p">:</span><span class="n">ix</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">split_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_df</span><span class="p">)</span>
                <span class="n">prev_ix</span> <span class="o">=</span> <span class="n">ix</span>

            <span class="c1"># Remaining part:</span>
            <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">prev_ix</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">split_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_df</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">split_df</span> <span class="ow">in</span> <span class="n">split_dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">partial_category</span> <span class="o">=</span> <span class="n">split_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">split_df</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial_category</span>
                <span class="n">split_df</span> <span class="o">=</span> <span class="n">split_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">split_df</span> <span class="o">=</span> <span class="n">process_dataframe2</span><span class="p">(</span><span class="n">split_df</span><span class="p">)</span>
                <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split_df</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_df</span> <span class="o">=</span> <span class="n">process_dataframe2</span><span class="p">(</span><span class="n">table_df</span><span class="p">)</span>
            <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tables</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_links</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7624305&#39;
</pre></div>
</div>
</div>
</div>
<p>Let’s try it out:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scrape_page_tables</span><span class="p">(</span><span class="n">index_links</span><span class="p">[</span><span class="mi">5</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
      <th>ATU_code</th>
      <th>ATU_label</th>
      <th>AT_code</th>
      <th>AT_label</th>
      <th>Motif_code</th>
      <th>Motif_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ATU 1030 The Crop Division</td>
      <td>AT 1030 Man and Ogre Share the Harvest</td>
      <td>K171.1. Deceptive crop division: above the gro...</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1030</td>
      <td>The Crop Division</td>
      <td>1030</td>
      <td>Man and Ogre Share the Harvest</td>
      <td>K171.1</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>ATU 1036 Hogs with Curly Tails</td>
      <td>AT 1036 Hogs with Curly Tails</td>
      <td>K171.4. Deceptive division of pigs: curly and ...</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1036</td>
      <td>Hogs with Curly Tails</td>
      <td>1036</td>
      <td>Hogs with Curly Tails</td>
      <td>K171.4</td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 1045 Pulling the Lake Together</td>
      <td>AT 1045 Pulling Down the Forest with a Rope</td>
      <td>K1744. Hero threatens to pull the lake togethe...</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1045</td>
      <td>Pulling the Lake Together</td>
      <td>1045</td>
      <td>Pulling Down the Forest with a Rope</td>
      <td>K1744</td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 1049 The heavy axe</td>
      <td>AT 1049 The heavy Axe or the Giant Bucket</td>
      <td>K1741.1. Felling the whole forest.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1049</td>
      <td>The heavy axe</td>
      <td>1049</td>
      <td>The heavy Axe or the Giant Bucket</td>
      <td>K1741.1</td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 1049 The heavy axe</td>
      <td>AT 1049 The heavy Axe or the Giant Bucket</td>
      <td>K1741.3. Bringing the whole well.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1049</td>
      <td>The heavy axe</td>
      <td>1049</td>
      <td>The heavy Axe or the Giant Bucket</td>
      <td>K1741.3</td>
      <td></td>
    </tr>
    <tr>
      <th>5</th>
      <td>ATU 1050 Felling trees</td>
      <td>AT 1050 Contest in Felling Trees</td>
      <td>K44. Deceptive contest in chopping.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1050</td>
      <td>Felling trees</td>
      <td>1050</td>
      <td>Contest in Felling Trees</td>
      <td>K44</td>
      <td></td>
    </tr>
    <tr>
      <th>6</th>
      <td>ATU 1050 Felling trees</td>
      <td>AT 1050 Contest in Felling Trees</td>
      <td>K178. Deceptive bargain: felling the tree.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1050</td>
      <td>Felling trees</td>
      <td>1050</td>
      <td>Contest in Felling Trees</td>
      <td>K178</td>
      <td></td>
    </tr>
    <tr>
      <th>7</th>
      <td>ATU 1050 Felling trees</td>
      <td>AT 1050 Contest in Felling Trees</td>
      <td>K1421. Clearing land: axe broken.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1050</td>
      <td>Felling trees</td>
      <td>1050</td>
      <td>Contest in Felling Trees</td>
      <td>K1421</td>
      <td></td>
    </tr>
    <tr>
      <th>8</th>
      <td>ATU 1051 Bending a Tree</td>
      <td>AT 1051 Springing with a Bent Tree</td>
      <td>K1112. Bending the tree.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1051</td>
      <td>Bending a Tree</td>
      <td>1051</td>
      <td>Springing with a Bent Tree</td>
      <td>K1112</td>
      <td></td>
    </tr>
    <tr>
      <th>9</th>
      <td>ATU 1052 Carrying a Tree</td>
      <td>AT 1052 A Contest in Carrying a Tree</td>
      <td>K71. Deceptive contest in carrying a tree: rid...</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1052</td>
      <td>Carrying a Tree</td>
      <td>1052</td>
      <td>A Contest in Carrying a Tree</td>
      <td>K71</td>
      <td></td>
    </tr>
    <tr>
      <th>10</th>
      <td>ATU 1053 Shooting Wild Boars</td>
      <td>AT 1053 Shooting Wild Boars</td>
      <td>K1741.2. A thousand at one shot.</td>
      <td>Partnership between Man and Ogre 1030 - 1059</td>
      <td>1053</td>
      <td>Shooting Wild Boars</td>
      <td>1053</td>
      <td>Shooting Wild Boars</td>
      <td>K1741.2</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can now scrape the whole collection:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>


<span class="c1"># Note that this assumes a globally defined requests session and database</span>
<span class="k">def</span> <span class="nf">scrape_pages</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://libraryguides.missouri.edu/c.php?g=1039894&amp;p=7609090&quot;</span><span class="p">,</span>
                 <span class="n">db_table</span><span class="o">=</span><span class="s2">&quot;tale_types&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scrape all tale type lookup pages.&quot;&quot;&quot;</span>
    <span class="n">index_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="c1"># Get links for lookup pages</span>
    <span class="n">link_elements</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nav-tabs&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">index_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//a/@href&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">link_elements</span><span class="p">]</span>
    
    <span class="c1"># Parse each page</span>
    <span class="k">for</span> <span class="n">index_link</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">index_links</span><span class="p">):</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="n">scrape_page_tables</span><span class="p">(</span><span class="n">index_link</span><span class="p">)</span>
        
        <span class="c1"># Add to database</span>
        <span class="c1"># Note that we need to ensure we append the data to an existing table</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">table</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">db_table</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clear out the table</span>
<span class="c1">#db[&quot;tale_types&quot;].drop()</span>
<span class="n">db</span><span class="p">[</span><span class="s2">&quot;tale_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete_where</span><span class="p">()</span>

<span class="c1"># And scrape everything</span>
<span class="n">scrape_pages</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4f2d36cc0edb438c8acd7aaa97764759", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/site-packages/pandas/core/generic.py:2872: UserWarning: The spaces in these column names will not be changed. In pandas versions &lt; 0.14, spaces were converted to underscores.
  sql.to_sql(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tale_types LIMIT 3&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
      <th>ATU_code</th>
      <th>ATU_label</th>
      <th>AT_code</th>
      <th>AT_label</th>
      <th>Motif_code</th>
      <th>Motif_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td></td>
      <td></td>
      <td>D812.3. †D812.3. Magic object received from de...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>D812.3</td>
      <td>†D812.3. Magic object received from devil.</td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td></td>
      <td>D1413.8. †D1413.8. Chamber-pot to which one st...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>D1413.8</td>
      <td>†D1413.8. Chamber-pot to which one sticks.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 576 Magic Knife</td>
      <td>AT 576 Magic Knife</td>
      <td>D838. †D838. Magic object acquired by stealing</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>576</td>
      <td>Magic Knife</td>
      <td>D838</td>
      <td>†D838. Magic object acquired by stealing</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(*) AS numrows FROM tale_types&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>numrows</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2311</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tale_types WHERE ATU_code=610&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Classification Type</th>
      <th>AT Classification Type</th>
      <th>Thompson Motif</th>
      <th>category</th>
      <th>ATU_code</th>
      <th>ATU_label</th>
      <th>AT_code</th>
      <th>AT_label</th>
      <th>Motif_code</th>
      <th>Motif_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>T68.1. †T68.1. Princess offered as prize to re...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>T68.1</td>
      <td>†T68.1. Princess offered as prize to rescuer.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H346. †H346. Princess given to man who can hea...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H346</td>
      <td>†H346. Princess given to man who can heal her.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>Q2. †Q2. Kind and unkind.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>Q2</td>
      <td>†Q2. Kind and unkind.</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>L13. †L13. Compassionate youngest son.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>L13</td>
      <td>†L13. Compassionate youngest son.</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>L10. †L10. Victorious youngest son.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>L10</td>
      <td>†L10. Victorious youngest son.</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>N825.3. †N825.3. Old woman helper.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>N825.3</td>
      <td>†N825.3. Old woman helper.</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>D1500.1.5. †D1500.1.5. Magic healing fruit.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>D1500.1.5</td>
      <td>†D1500.1.5. Magic healing fruit.</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H1010. †H1010. Impossible tasks</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H1010</td>
      <td>†H1010. Impossible tasks</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>D1533.1.1. †D1533.1.1. Magic land and water ship.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>D1533.1.1</td>
      <td>†D1533.1.1. Magic land and water ship.</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H1112. †H1112. Task: herding rabbits.</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H1112</td>
      <td>†H1112. Task: herding rabbits.</td>
    </tr>
    <tr>
      <th>10</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H1331.1.2.1. †H1331.1.2.1. Quest for remarkabl...</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H1331.1.2.1</td>
      <td>†H1331.1.2.1. Quest for remarkable bird feathers.</td>
    </tr>
    <tr>
      <th>11</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>L161. †L161. Lowly hero marries princess</td>
      <td>Tales of Magic - Magic Object 560 - 571</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>L161</td>
      <td>†L161. Lowly hero marries princess</td>
    </tr>
    <tr>
      <th>12</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>T68.1. †T68.1. Princess offered as prize to re...</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>T68.1</td>
      <td>Princess offered as prize to rescuer.</td>
    </tr>
    <tr>
      <th>13</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H346. †H346. Princess given to man who can hea...</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H346</td>
      <td>Princess given to man who can heal her.</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>Q2. †Q2. Kind and unkind.</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>Q2</td>
      <td>Kind and unkind.</td>
    </tr>
    <tr>
      <th>15</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>L13. †L13. Compassionate youngest son.</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>L13</td>
      <td>Compassionate youngest son.</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>L10. †L10. Victorious youngest son.</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>L10</td>
      <td>Victorious youngest son.</td>
    </tr>
    <tr>
      <th>17</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>N825.3. †N825.3. Old woman helper.</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>N825.3</td>
      <td>Old woman helper.</td>
    </tr>
    <tr>
      <th>18</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>D1500.1.5. †D1500.1.5. Magic healing fruit.</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>D1500.1.5</td>
      <td>Magic healing fruit.</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H1010. †H1010. Impossible tasks</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H1010</td>
      <td>Impossible tasks</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>D1533.1.1. †D1533.1.1. Magic land and water ship.</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>D1533.1.1</td>
      <td>Magic land and water ship.</td>
    </tr>
    <tr>
      <th>21</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H1112. †H1112. Task: herding rabbits.</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H1112</td>
      <td>Task: herding rabbits.</td>
    </tr>
    <tr>
      <th>22</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>H1331.1.2.1. †H1331.1.2.1. Quest for remarkabl...</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>H1331.1.2.1</td>
      <td>Quest for remarkable bird feathers.</td>
    </tr>
    <tr>
      <th>23</th>
      <td>ATU 610 The Healing Fruit</td>
      <td>AT 610 Fruit to Cure the Princess</td>
      <td>L161. †L161. Lowly hero marries princess</td>
      <td>Tales of Magic - Magic Object 571B - 649</td>
      <td>610</td>
      <td>The Healing Fruit</td>
      <td>610</td>
      <td>Fruit to Cure the Princess</td>
      <td>L161</td>
      <td>Lowly hero marries princess</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="story-scraper">
<h1>Story Scraper<a class="headerlink" href="#story-scraper" title="Permalink to this headline">¶</a></h1>
<p>The Missouri Libraries website also maintain a collection of stories referenced by AT and ATU categorised tale types: <a class="reference external" href="https://libraryguides.missouri.edu/c.php?g=1083510">https://libraryguides.missouri.edu/c.php?g=1083510</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tales_index_url</span> <span class="o">=</span> <span class="s2">&quot;https://libraryguides.missouri.edu/c.php?g=1083510&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">HTMLSession</span><span class="p">()</span>
<span class="n">tales_index_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tales_index_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can get links for the separate index pages as we did before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tales_link_elements</span> <span class="o">=</span> <span class="n">tales_index_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nav-tabs&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">tales_index_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//a/@href&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">tales_link_elements</span><span class="p">]</span>
<span class="n">tales_index_links</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;https://libraryguides.missouri.edu/c.php?g=1083510&amp;p=7898512&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1083510&amp;p=7901911&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1083510&amp;p=7913834&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1083510&amp;p=7916779&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1083510&amp;p=7916818&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1083510&amp;p=7916872&#39;,
 &#39;https://libraryguides.missouri.edu/c.php?g=1083510&amp;p=7917477&#39;]
</pre></div>
</div>
</div>
</div>
<p>There is just a single box per page although it may contain several tables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tales_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tales_index_links</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># dot notation: . is class, # is id</span>
<span class="c1">#s-lib-box s-lib-box-std</span>
<span class="n">boxes</span> <span class="o">=</span> <span class="n">tales_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.s-lib-box&#39;</span><span class="p">)</span>
<span class="n">boxes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;Element &#39;div&#39; id=&#39;s-lg-box-25061504&#39; class=(&#39;s-lib-box&#39;, &#39;s-lib-box-std&#39;)&gt;]
</pre></div>
</div>
</div>
</div>
<p>As before, we can extract the box title as a category heading:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">category</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<span class="n">category</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;ATU 300 - 559 Tales of Magic&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_tales_tables</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>
<span class="n">example_tales_tables</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;Element &#39;table&#39; border=&#39;1&#39; cellpadding=&#39;0&#39; cellspacing=&#39;0&#39; dir=&#39;ltr&#39; style=&#39;table-layout:fixed;font-size:10pt;font-family:Arial;width:0px;border-collapse:collapse;border:none&#39; xmlns=&#39;http://www.w3.org/1999/xhtml&#39;&gt;,
 &lt;Element &#39;table&#39; border=&#39;1&#39; cellpadding=&#39;0&#39; cellspacing=&#39;0&#39; dir=&#39;ltr&#39; style=&#39;table-layout:fixed;font-size:10pt;font-family:Arial;width:0px;border-collapse:collapse;border:none&#39; xmlns=&#39;http://www.w3.org/1999/xhtml&#39;&gt;,
 &lt;Element &#39;table&#39; border=&#39;1&#39; cellpadding=&#39;0&#39; cellspacing=&#39;0&#39; dir=&#39;ltr&#39; style=&#39;table-layout:fixed;font-size:10pt;font-family:Arial;width:0px;border-collapse:collapse;border:none&#39; xmlns=&#39;http://www.w3.org/1999/xhtml&#39;&gt;]
</pre></div>
</div>
</div>
</div>
<p>Each table can be mapped to a dataframe, removing empty rows and filling down on the blanks.</p>
<p>The columns could be detected, but they are consistent and will need rolling over for multiple tables in a box, so we might as well set them explicitly and then tidy up.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">example_tales_tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">example_df</span> <span class="o">=</span> <span class="n">example_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
<span class="n">example_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">,</span> <span class="s2">&quot;AT&quot;</span><span class="p">,</span> <span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="s2">&quot;Origin&quot;</span><span class="p">]</span>

<span class="c1"># Remove column names if they were in the table and reset index</span>
<span class="n">example_df</span> <span class="o">=</span> <span class="n">example_df</span><span class="p">[</span><span class="n">example_df</span><span class="p">[</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Tidy AT</span>
<span class="n">example_df</span><span class="p">[</span><span class="s2">&quot;AT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example_df</span><span class="p">[</span><span class="s2">&quot;AT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Tidy ATU Title</span>
<span class="n">example_df</span><span class="p">[</span><span class="s2">&quot;ATU Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">example_df</span><span class="p">[</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]))</span>
<span class="n">example_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Title</th>
      <th>AT</th>
      <th>Title</th>
      <th>Origin</th>
      <th>ATU Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Three Brothers and the three Tasks</td>
      <td>British</td>
      <td>The Dragon-Slayer</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Three Dogs</td>
      <td>German</td>
      <td>The Dragon-Slayer</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Black Crow and the White Cheese</td>
      <td>Egyptian</td>
      <td>The Dragon-Slayer</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Five Counsels</td>
      <td>Mexican</td>
      <td>The Dragon-Slayer</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Monster's Hairs</td>
      <td>Armenian</td>
      <td>The Dragon-Slayer</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Also note that we need to parse out the link for the tale in the HTML table. The <em>pandas</em> <code class="docutils literal notranslate"><span class="pre">.read_html()</span></code> function does not do this out of the can, although we can patch <em>pandas</em> to support it. Alternatively, we can grab the links from the table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="k">def</span> <span class="nf">get_table_links</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse an HMTL table and extract links from it.&quot;&quot;&quot;</span>
    <span class="n">table_soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>

    <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">td</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
                <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">td</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">],</span> <span class="n">td</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

    <span class="n">link_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">,</span> <span class="s2">&quot;Title&quot;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">link_df</span>

<span class="n">link_df</span> <span class="o">=</span> <span class="n">get_table_links</span><span class="p">(</span><span class="n">example_tales_tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span><span class="p">)</span>
<span class="n">link_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>link</th>
      <th>Title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>https://archive.org/details/dictionaryofbrit01...</td>
      <td>Three Brothers and the three Tasks</td>
    </tr>
    <tr>
      <th>1</th>
      <td>https://archive.org/details/greenfairybook00la...</td>
      <td>Three Dogs</td>
    </tr>
    <tr>
      <th>2</th>
      <td>https://archive.org/details/folktalesofegypt00...</td>
      <td>Black Crow and the White Cheese</td>
    </tr>
    <tr>
      <th>3</th>
      <td>https://archive.org/details/folktalesofmexic00...</td>
      <td>Five Counsels</td>
    </tr>
    <tr>
      <th>4</th>
      <td>https://archive.org/details/100armeniantales00...</td>
      <td>Monster's Hairs</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that there may be duplicate story names within a table, so we will join by the index value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_df</span> <span class="o">=</span> <span class="n">example_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">link_df</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">])</span>
<span class="n">example_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Title</th>
      <th>AT</th>
      <th>Title</th>
      <th>Origin</th>
      <th>ATU Name</th>
      <th>link</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Three Brothers and the three Tasks</td>
      <td>British</td>
      <td>The Dragon-Slayer</td>
      <td>https://archive.org/details/dictionaryofbrit01...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Three Dogs</td>
      <td>German</td>
      <td>The Dragon-Slayer</td>
      <td>https://archive.org/details/greenfairybook00la...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Black Crow and the White Cheese</td>
      <td>Egyptian</td>
      <td>The Dragon-Slayer</td>
      <td>https://archive.org/details/folktalesofegypt00...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Five Counsels</td>
      <td>Mexican</td>
      <td>The Dragon-Slayer</td>
      <td>https://archive.org/details/folktalesofmexic00...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ATU 300 The Dragon-Slayer</td>
      <td>300</td>
      <td>Monster's Hairs</td>
      <td>Armenian</td>
      <td>The Dragon-Slayer</td>
      <td>https://archive.org/details/100armeniantales00...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To parse the page completely, we’d need to iterate over all the tables.</p>
<p>Let’s build a scraper for all the pages and all the tables in a page:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scrape_tale_links</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://libraryguides.missouri.edu/c.php?g=1083510&quot;</span><span class="p">,</span>
                      <span class="n">db_table</span><span class="o">=</span><span class="s2">&quot;tale_links&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scrape all tale links.&quot;&quot;&quot;</span>
    
    <span class="n">tales_index_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="n">tales_link_elements</span> <span class="o">=</span> <span class="n">tales_index_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.nav-tabs&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">tales_index_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//a/@href&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">tales_link_elements</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">tales_page_link</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">tales_index_links</span><span class="p">):</span>
        <span class="n">tales_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tales_page_link</span><span class="p">)</span>
        <span class="c1"># dot notation: . is class, # is id</span>
        <span class="c1">#s-lib-box s-lib-box-std</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">tales_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.s-lib-box&#39;</span><span class="p">)</span>

        <span class="n">category</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>

        <span class="n">tables</span> <span class="o">=</span>  <span class="n">boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">table_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">html</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
            <span class="n">table_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">,</span> <span class="s2">&quot;AT&quot;</span><span class="p">,</span> <span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="s2">&quot;Origin&quot;</span><span class="p">]</span>
            <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;AT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;AT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;AT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

            <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>

            <span class="c1"># Remove column names if they were in the table</span>
            <span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">]</span>

            <span class="c1"># Tidy AT</span>
            <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;AT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;AT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Tidy ATU Title</span>
            <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_df</span><span class="p">[</span><span class="s2">&quot;ATU Title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]))</span>
            
            <span class="c1"># Add links</span>
            <span class="n">link_df</span> <span class="o">=</span> <span class="n">get_table_links</span><span class="p">(</span><span class="n">example_tales_tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span><span class="p">)</span>
            <span class="n">table_df</span> <span class="o">=</span> <span class="n">table_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">link_df</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">])</span>
            
            <span class="n">table_df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">db_table</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clear the db table (if it exists)</span>
<span class="c1">#db[&quot;tale_links&quot;].drop()</span>
<span class="n">db</span><span class="p">[</span><span class="s2">&quot;tale_links&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete_where</span><span class="p">()</span>

<span class="n">scrape_tale_links</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "731cee1f44f244e2860fab07b9b6a776", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/site-packages/pandas/core/generic.py:2872: UserWarning: The spaces in these column names will not be changed. In pandas versions &lt; 0.14, spaces were converted to underscores.
  sql.to_sql(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM tale_links LIMIT 10&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATU Title</th>
      <th>AT</th>
      <th>Title</th>
      <th>Origin</th>
      <th>category</th>
      <th>ATU Name</th>
      <th>link</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AT</td>
      <td>AT</td>
      <td>Title</td>
      <td>Origin</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/dictionaryofbrit01...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>The Wolf and the Fox</td>
      <td>French</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/greenfairybook00la...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>Fox in Inishkea</td>
      <td>Irish</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/folktalesofegypt00...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>Fish Thief</td>
      <td>Japanesse</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/folktalesofmexic00...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1</td>
      <td>Tub of Butter</td>
      <td>Canadian</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/100armeniantales00...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>1</td>
      <td>Fox and Lapp</td>
      <td>Lapp</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/irishfolktales00gl...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>1</td>
      <td>Reynard and Bruin</td>
      <td>European</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/greenhillsofmagi00...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1*</td>
      <td>1</td>
      <td>Fox and the Hare in Winter</td>
      <td>German</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/irishfolktales00gl...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1*</td>
      <td>1</td>
      <td>Fox and the Magpie</td>
      <td>British</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/moreenglishfairy00...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1*</td>
      <td>1</td>
      <td>Hare, Badger, Monkey, and Otter</td>
      <td>Japanesse</td>
      <td>ATU 1-299 Animal Tales</td>
      <td></td>
      <td>https://archive.org/details/greyfairybook00lan...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Lots of the links are to resources held by <code class="docutils literal notranslate"><span class="pre">archive.org</span></code>,  although many of them are limited preview books.</p>
<p>It might be interesting trying to build something to check whether a resource is openly available there, or limited access, and if it is openly available, perhaps attempt to scrape the story text from the Internet Archive.</p>
<div class="section" id="identifying-openly-available-archive-org-resources">
<h2>Identifying Openly Available <code class="docutils literal notranslate"><span class="pre">archive.org</span></code> Resources<a class="headerlink" href="#identifying-openly-available-archive-org-resources" title="Permalink to this headline">¶</a></h2>
<p>Let’s start by just grabbing a list of unique resources on <code class="docutils literal notranslate"><span class="pre">archive.org</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM tale_links WHERE link LIKE &quot;https://archive.org/details/%&quot;;&#39;</span>

<span class="n">xx</span> <span class="o">=</span> <span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
<span class="n">xx</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;https://archive.org/details/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">xx</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">xx</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;dictionaryofbrit01brig&#39;, &#39;greenfairybook00lang_0&#39;,
       &#39;folktalesofegypt00elsh&#39;, &#39;folktalesofmexic0000pare&#39;,
       &#39;100armeniantales0000unse&#39;, &#39;irishfolktales00glas&#39;,
       &#39;greenhillsofmagi0000musi&#39;, &#39;moreenglishfairy00jaco&#39;,
       &#39;greyfairybook00lang&#39;, &#39;russianfairytale00afan&#39;,
       &#39;folktalesofgreec0000mega&#39;, &#39;englishfairytale1902jaco&#39;,
       &#39;italianfolktales00calv&#39;, &#39;populartalesfrom00daseiala&#39;,
       &#39;yellowfairybook00lang02&#39;, &#39;folktalesofgerma00kurt&#39;,
       &#39;bluefairybook00langiala&#39;, &#39;brownfairybook00langrich&#39;,
       &#39;folktalesoffranc00mass&#39;, &#39;folktalesofjapan00seki&#39;,
       &#39;moregreekfolktal0000dawk&#39;, &#39;violetfairybook00lang&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>I’ve already got a database of the Lang coloured Fairy Books, so it should be possible to join in to that.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "psychemedia/storynotes",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Lang_Doc2Vec.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Doc2Vec Searching of Lang Database</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Thompson_Motif_Index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Thompson Motif Index</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Tony Hirst<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
    <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  

  </body>
</html>