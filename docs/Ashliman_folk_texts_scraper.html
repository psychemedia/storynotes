
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ashliman “Folklore and Mythology Electronic Texts” Scraper &#8212; Story Notes - Technical Recipes</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multilingual Folk Tale Database (MTFD)" href="MTFD-Multilingual_Folk_Tale_Database.html" />
    <link rel="prev" title="A Full Text Searchable Database of Lang’s Fairy Books" href="lang-fairy-books-db.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Story Notes - Technical Recipes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="preface.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Story Collection Scrapers and Search
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="lang-fairy-books-db.html">
   A Full Text Searchable Database of Lang’s Fairy Books
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Ashliman “Folklore and Mythology Electronic Texts” Scraper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MTFD-Multilingual_Folk_Tale_Database.html">
   Multilingual Folk Tale Database (MTFD)
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Advanced Search Techniques
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Lang_Doc2Vec.html">
   Connecting to the Database
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Tale Types
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Missouri_Tale_Types.html">
   Tale Types Scraper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Thompson_Motif_Index.html">
   Thompson Motif Index
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Wikipedia and DBPedia
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DBPedia_Aarne-Thompson-Uther_Search.html">
   Aarne-Thompson-Uther (ATU) Search
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Ashliman_folk_texts_scraper.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-simple-database">
   Create a Simple Database
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="ashliman-folklore-and-mythology-electronic-texts-scraper">
<h1>Ashliman “Folklore and Mythology Electronic Texts” Scraper<a class="headerlink" href="#ashliman-folklore-and-mythology-electronic-texts-scraper" title="Permalink to this headline">¶</a></h1>
<p>A scraper to grab all the stories edited / translated by D. L. Ashliman that are referenced from <a class="reference external" href="https://sites.pitt.edu/~dash/folktexts.html">https://sites.pitt.edu/~dash/folktexts.html</a> .</p>
<p>Note that these are <em>Copyright D. L. Ashliman, University of Pittsburgh, 1996-2022</em>.</p>
<p>My intention is to create personal collection of these stories to support personal search and discovery of stories.</p>
<p>The stories appear to have been added to the website over several years. Whilst there is a lot of structure that we can can exploit to extract the story texts, there may be some stories that arenlt extracted correctly, or even at all.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">story_list_url</span> <span class="o">=</span> <span class="s2">&quot;https://sites.pitt.edu/~dash/folktexts.html&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>The stories are collected on thematic / story type pages that are referenced from <a class="reference external" href="https://sites.pitt.edu/~dash/folktexts.html">https://sites.pitt.edu/~dash/folktexts.html</a>.</p>
<p>Let’s start by grabbing links to all those pages; we’ll use <code class="docutils literal notranslate"><span class="pre">requests-cache</span></code> to cache the pages so we donlt repeatedly hit the website as we test the script…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%pip install requests-HTML</span>
<span class="kn">import</span> <span class="nn">requests_cache</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="n">requests_cache</span><span class="o">.</span><span class="n">install_cache</span><span class="p">(</span><span class="s1">&#39;ashliman_cache&#39;</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;sqlite&#39;</span><span class="p">,</span> <span class="n">expire_after</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">requests_html</span> <span class="kn">import</span> <span class="n">HTMLSession</span>
 
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://sites.pitt.edu/~dash/folktexts.html&quot;</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">HTMLSession</span><span class="p">()</span>
<span class="n">index_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Clean the set of links to just the links we are interested in</span>
<span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">index_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">absolute_links</span> <span class="k">if</span> \
         <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="s2">&quot;#&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
<span class="n">links</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;https://sites.pitt.edu/~dash/type1592.html&#39;,
 &#39;https://sites.pitt.edu/~dash/type1586.html&#39;,
 &#39;https://sites.pitt.edu/~dash/alibaba.html&#39;]
</pre></div>
</div>
</div>
</div>
<p>The story pages have a consistent form, so if we inspect one of the pages, we should be able to generate some sort of template for scraping all the pages.</p>
<p>First of all, grab a story page:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">page_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see if we can extract some information from the header at the top of the page:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the head information</span>
<span class="c1"># This works for many pages, but not all..</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="p">:</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//h1[@align=&quot;CENTER&quot;]&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">header</span><span class="p">:</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">full_text</span>

<span class="n">header</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;The Foolish Friend&#39;
</pre></div>
</div>
</div>
</div>
<p>The general category is given in the first line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">category</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">category</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;The Foolish Friend&#39;
</pre></div>
</div>
</div>
</div>
<p>We may also have subheader content:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># eg https://sites.pitt.edu/~dash/type1586.html</span>
<span class="n">subheading</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//p[@align=&quot;CENTER&quot;]&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">subheading</span><span class="p">:</span>
    <span class="n">subheading</span> <span class="o">=</span> <span class="n">subheading</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>

<span class="n">subheader</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;and other folktales of Aarne-Thompson-Uther type 1586\n\nin which a fool kills an insect resting on someone&#39;s head,\nwith catastrophic consequences,\nselected and edited by\n\nD. L. Ashliman\n© 1999-2014&quot;
</pre></div>
</div>
</div>
</div>
<p>Some page URLs are ATU codes; we can co-ot these as low hanging fruit if we canlt otherwise access the ATU reference:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">url_regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^type(?P&lt;atu&gt;[\da-zA-Z]+)\.html&quot;</span>

<span class="n">_url</span> <span class="o">=</span> <span class="s1">&#39;https://sites.pitt.edu/~dash/type1586.html&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1">#links[12].split(&#39;/&#39;)[-1]</span>
<span class="n">matches</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">_url</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

<span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
    <span class="n">atu</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>

<span class="n">atu</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1586&#39;
</pre></div>
</div>
</div>
</div>
<p>In some headers, there may be an indication of the Aarne-Thompson-Uther story type. If the tale type is described in a conventional way, we can easily extract it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">regex</span><span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^.*Aarne-Thompson-Uther type (?P&lt;atu&gt;[\da-zA-Z]+).*&quot;</span>

<span class="n">matches</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">full_text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

<span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
    <span class="n">atu</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>

<span class="n">atu</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&#39;
</pre></div>
</div>
</div>
</div>
<p>Inspection of the page response HTML suggests that stories are separated by the repeated <code class="docutils literal notranslate"><span class="pre">&lt;hr/&gt;&lt;hr/&gt;</span></code> element. We can also find a break before the first tale as <code class="docutils literal notranslate"><span class="pre">\n\n&lt;hr/&gt;\n\n&lt;p&gt;\n</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the full HTML text</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
<span class="c1"># In some cases, the page may not be in an HTML tag but may just be body content</span>
<span class="k">if</span> <span class="n">html</span><span class="p">:</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">html</span>
    <span class="c1"># This pages are old so patch them</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;hr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;hr/&gt;&quot;</span><span class="p">)</span>

<span class="c1"># Split out the section containing the stories</span>
<span class="n">stories_html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&lt;hr/&gt;</span><span class="se">\n</span><span class="s2">&lt;p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Chunk the stories</span>
<span class="n">story_chunks</span> <span class="o">=</span> <span class="n">stories_html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;hr/&gt;&lt;hr/&gt;&quot;</span><span class="p">)</span>
<span class="c1"># Some old pages may just carry one story with no splits</span>
<span class="c1"># If there is only one item, use that...</span>
<span class="n">story_chunks</span> <span class="o">=</span> <span class="n">story_chunks</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">story_chunks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">story_chunks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">story_chunks</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;&lt;h2&gt;&lt;a name=&quot;panchatantra&quot;&gt;Miracle upon Miracle&lt;/a&gt;&lt;/h2&gt;\n&lt;h3&gt;India&lt;/h3&gt;\nIn a certain place there once lived a merchant by the name of Nanduka, which means &quot;cheerful one&quot; and a merchant by the name of Lakschmana, which means &quot;fortunate one.&quot;  The latter, who had lost all his wealth, decided to travel abroad.  For it is said: &lt;i&gt; A person who has lived well in a particular place, but who stays there after he has lost his wealth, is of common mind.&lt;/i&gt; And further: &lt;i&gt;A person who, reduced to misery, remains at a place where he once was happy, is worthy of reproach.&lt;/i&gt;\n&lt;p&gt;\nIn his house there was a large set of heavy iron scales that had been acquired by his ancestors.  He gave these to the guild-master Nanduka for safekeeping, and set forth for foreign lands.  &lt;p&gt; \nAfter he had pursued his desires for a long time abroad, he returned to his homeland, and said to the guild-master Nanduka, &quot;Guild-master, give me back the scales that I left here for safekeeping.&quot; &lt;p&gt;\nNanduka replied, &quot;Oh, your scales are no longer here.  The mice ate them up.&quot; &lt;p&gt; \nWhen he heard this, Lakschmana said, &quot;Well, Nanduka, if the mice ate them up, then it is through no fault of yours.  That is the way of the world.  Nothing in it is eternal.  But now I would like to bathe myself in the river.  Send your child with me, the boy named Dhanadeva, to carry my bathing things.&quot; &lt;p&gt; \nNanduka, fearing Lakschama because of the theft he had committed against him, said to his son, &quot;Child, your uncle Lakschmana wants to take a bath in the river.  Go with him and carry his bathing things.&quot;  &lt;p&gt; \nYes, with truth they say: &lt;i&gt;No one does a favor for another, unless driven by fear, greed, or some other purpose.&lt;/i&gt; And further: &lt;i&gt;If someone shows you unusual courtesy, be cautious, lest it lead to a bad end.&lt;/i&gt; &lt;p&gt; \nNanduka\&#39;s son, carrying the bathing things, set forth happily with Lakschmana.  After taking his bath, Lakschmana threw Nanduka\&#39;s son Dhanadeva into a cave on the bank of the river, and sealed the opening with a large stone.  Then he rushed back to Nanduka\&#39;s house.  &lt;p&gt; \nThe merchant asked him, &quot;Speak up, Lakschmana!  Tell me, where is my child who went to the river with you?&quot; &lt;p&gt;\nLakschmana said, &quot;He was taken away from the river\&#39;s bank by a falcon.&quot; &lt;p&gt;\nThe merchant cried, &quot;You liar!  How in the world can a falcon steal a boy?  Give me back my son, or I will bring action against you at the king\&#39;s court.&quot; &lt;p&gt;\nLakschmana said, &quot;Oh, you who always speak the truth!  A falcon can carry away a boy, if mice can eat a large set of heavy iron scales.  If you want your son back, then give me my scales!&quot; &lt;p&gt;\nThus quarreling one with another, they went to the king\&#39;s gate, where Nanduka cried out loudly, &quot;A dastardly crime has happened here!  This thief has robbed me of my child!&quot; &lt;p&gt; \nHearing this, the judges said to Lakschmana, &quot;Return the guild-master\&#39;s son to him!&quot; &lt;p&gt;\nLakschmana answered, &quot;What can I do?  Before my very eyes a falcon carried him away from the bank of the river.&quot; &lt;p&gt;\nHearing this, they said, &quot;You do not tell the truth.  How could a falcon be capable of carrying off a fifteen-year-old boy?&quot; &lt;p&gt;\nLakschmana answered, laughing, &quot;Ha!  Listen to this proverb: &lt;i&gt;When mice can eat a thousand pounds of iron, then a falcon can carry away an elephant, to say nothing of a little boy.&lt;/i&gt;&quot; &lt;p&gt;\nThe judges said, &quot;What do you mean by that?&quot; &lt;p&gt;\nThen Lakschmana told the whole story about the scales.  After hearing this, they laughed at what Nanduka and Lakschmana had done, reconciled the two with each other, and made them respectively return the scales and the boy. &lt;p&gt;\n&lt;hr/&gt;\n&lt;ul&gt;\n&lt;li&gt;Source: The &lt;i&gt;Panchatantra&lt;/i&gt;, book 1, story 21. &lt;p&gt;\n&lt;li&gt;I have used the following edition:  &lt;i&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PR3#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;Pantschatantra: Fünf Bücher indischer Fabeln, Märchen und Erzählungen&lt;/a&gt;&lt;/i&gt;.  Aus dem Sanskrit übersetzt mit Einleitung und Anmerkungen von Theodor Benfey (Leipzig: F. A. Brockhaus, 1859), &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PA120#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;vol. 2, pp. 120-22&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Translated from the German by D. L. Ashliman. &lt;p&gt;\n&lt;li&gt;Link to additional tales from &lt;a target=&quot;_blank&quot; href=&quot;panchatantra.html&quot;&gt;&lt;i&gt;The Panchatantra&lt;/i&gt;&lt;/a&gt;.    &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n&#39;,
 &#39;\n&lt;h2&gt;&lt;a name=&quot;somadeva&quot;&gt;The Mice That Ate an Iron Balance&lt;/a&gt;&lt;/h2&gt;\n&lt;h3&gt;India&lt;/h3&gt;\nOnce on a time the was a merchant\&#39;s son, who had spent all his father\&#39;s wealth, and had only an iron balance left to him. Now the balance was made of a thousand &lt;i&gt;palas&lt;/i&gt; of iron; and depositing it in the care of a certain merchant, he went to another land. &lt;p&gt; \nAnd when, on his return, he came to that merchant to demand back his balance, the merchant said to him, &quot;It has been eaten by mice.&quot; He repeated, &quot;It is quite true, the iron, of which it was composed, was particularly sweet, and so the mice ate it.&quot; &lt;p&gt; \nThis he said with an outward show of sorrow, laughing in his heart. Then the merchant\&#39;s son asked him to give him some food, and he, being in a good temper, consented to give him some. &lt;p&gt; \nThen the merchant\&#39;s son went to bathe, taking with him the son of that merchant, who was a mere child, and whom he persuaded to come with him by giving him a dish of &lt;i&gt;ámalakas&lt;/i&gt;. And after he had bathed, the wise merchant\&#39;s son deposited the boy in the house of a friend, and returned alone to the house of that merchant. &lt;p&gt; \nAnd the merchant said to him, &quot;Where is that son of mine?&quot; &lt;p&gt; \nHe replied, &quot;A kite swooped down from the air and carried him off.&quot; &lt;p&gt; \nThe merchant in a rage said, &quot;You have concealed my son,&quot; and so he took him into the king\&#39;s judgment hall; and there the merchant\&#39;s son made the same statement. &lt;p&gt; \nThe officers of the court said, &quot; This is impossible, how could a kite carry off a boy?&quot; &lt;p&gt; \nBut the merchant\&#39;s son answered, &quot; In a country where a large balance of iron was eaten by mice, a kite might carry off an elephant, much more a boy.&quot; &lt;p&gt; \nWhen the officers heard that, they asked about it, out of curiosity, and made the merchant restore the balance to the owner, and he, for his part, restored the merchant\&#39;s child. &lt;p&gt;\n&lt;hr/&gt;\n&lt;ul&gt;\n&lt;li&gt;Source: Somadeva Bhatta,  &lt;i&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=6cVDAAAAYAAJ&amp;amp;pg=PP5#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;The Kátha Sarit Ságara; or, Ocean of the Streams of Story&lt;/a&gt;&lt;/i&gt;, vol. 2. Translated from the original Sanskrit by C. H. Tawney (Calcutta: Printed by J. W. Thomas at the Baptist Mission Press, 1884), &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=6cVDAAAAYAAJ&amp;amp;pg=PA41#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;pp. 41-42&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n&#39;]
</pre></div>
</div>
</div>
</div>
<p>Each chunk may have additioanl information after the story, separated by a single <code class="docutils literal notranslate"><span class="pre">&lt;hr/&gt;</span></code>. So lets split each stroy into a 2-tuple for now of the form <code class="docutils literal notranslate"><span class="pre">(story,</span> <span class="pre">additional_info)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">story_chunk_tuples</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">story_chunk</span> <span class="ow">in</span> <span class="n">story_chunks</span><span class="p">:</span>
    <span class="n">story_chunk_items</span> <span class="o">=</span> <span class="n">story_chunk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">story_chunk_items</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">story_chunk_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">story_chunk_items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">story_chunk_items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
    
<span class="n">story_chunk_tuples</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;&lt;h2&gt;&lt;a name=&quot;panchatantra&quot;&gt;Miracle upon Miracle&lt;/a&gt;&lt;/h2&gt;\n&lt;h3&gt;India&lt;/h3&gt;\nIn a certain place there once lived a merchant by the name of Nanduka, which means &quot;cheerful one&quot; and a merchant by the name of Lakschmana, which means &quot;fortunate one.&quot;  The latter, who had lost all his wealth, decided to travel abroad.  For it is said: &lt;i&gt; A person who has lived well in a particular place, but who stays there after he has lost his wealth, is of common mind.&lt;/i&gt; And further: &lt;i&gt;A person who, reduced to misery, remains at a place where he once was happy, is worthy of reproach.&lt;/i&gt;\n&lt;p&gt;\nIn his house there was a large set of heavy iron scales that had been acquired by his ancestors.  He gave these to the guild-master Nanduka for safekeeping, and set forth for foreign lands.  &lt;p&gt; \nAfter he had pursued his desires for a long time abroad, he returned to his homeland, and said to the guild-master Nanduka, &quot;Guild-master, give me back the scales that I left here for safekeeping.&quot; &lt;p&gt;\nNanduka replied, &quot;Oh, your scales are no longer here.  The mice ate them up.&quot; &lt;p&gt; \nWhen he heard this, Lakschmana said, &quot;Well, Nanduka, if the mice ate them up, then it is through no fault of yours.  That is the way of the world.  Nothing in it is eternal.  But now I would like to bathe myself in the river.  Send your child with me, the boy named Dhanadeva, to carry my bathing things.&quot; &lt;p&gt; \nNanduka, fearing Lakschama because of the theft he had committed against him, said to his son, &quot;Child, your uncle Lakschmana wants to take a bath in the river.  Go with him and carry his bathing things.&quot;  &lt;p&gt; \nYes, with truth they say: &lt;i&gt;No one does a favor for another, unless driven by fear, greed, or some other purpose.&lt;/i&gt; And further: &lt;i&gt;If someone shows you unusual courtesy, be cautious, lest it lead to a bad end.&lt;/i&gt; &lt;p&gt; \nNanduka\&#39;s son, carrying the bathing things, set forth happily with Lakschmana.  After taking his bath, Lakschmana threw Nanduka\&#39;s son Dhanadeva into a cave on the bank of the river, and sealed the opening with a large stone.  Then he rushed back to Nanduka\&#39;s house.  &lt;p&gt; \nThe merchant asked him, &quot;Speak up, Lakschmana!  Tell me, where is my child who went to the river with you?&quot; &lt;p&gt;\nLakschmana said, &quot;He was taken away from the river\&#39;s bank by a falcon.&quot; &lt;p&gt;\nThe merchant cried, &quot;You liar!  How in the world can a falcon steal a boy?  Give me back my son, or I will bring action against you at the king\&#39;s court.&quot; &lt;p&gt;\nLakschmana said, &quot;Oh, you who always speak the truth!  A falcon can carry away a boy, if mice can eat a large set of heavy iron scales.  If you want your son back, then give me my scales!&quot; &lt;p&gt;\nThus quarreling one with another, they went to the king\&#39;s gate, where Nanduka cried out loudly, &quot;A dastardly crime has happened here!  This thief has robbed me of my child!&quot; &lt;p&gt; \nHearing this, the judges said to Lakschmana, &quot;Return the guild-master\&#39;s son to him!&quot; &lt;p&gt;\nLakschmana answered, &quot;What can I do?  Before my very eyes a falcon carried him away from the bank of the river.&quot; &lt;p&gt;\nHearing this, they said, &quot;You do not tell the truth.  How could a falcon be capable of carrying off a fifteen-year-old boy?&quot; &lt;p&gt;\nLakschmana answered, laughing, &quot;Ha!  Listen to this proverb: &lt;i&gt;When mice can eat a thousand pounds of iron, then a falcon can carry away an elephant, to say nothing of a little boy.&lt;/i&gt;&quot; &lt;p&gt;\nThe judges said, &quot;What do you mean by that?&quot; &lt;p&gt;\nThen Lakschmana told the whole story about the scales.  After hearing this, they laughed at what Nanduka and Lakschmana had done, reconciled the two with each other, and made them respectively return the scales and the boy. &lt;p&gt;\n&#39;,
  &#39;\n&lt;ul&gt;\n&lt;li&gt;Source: The &lt;i&gt;Panchatantra&lt;/i&gt;, book 1, story 21. &lt;p&gt;\n&lt;li&gt;I have used the following edition:  &lt;i&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PR3#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;Pantschatantra: Fünf Bücher indischer Fabeln, Märchen und Erzählungen&lt;/a&gt;&lt;/i&gt;.  Aus dem Sanskrit übersetzt mit Einleitung und Anmerkungen von Theodor Benfey (Leipzig: F. A. Brockhaus, 1859), &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PA120#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;vol. 2, pp. 120-22&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Translated from the German by D. L. Ashliman. &lt;p&gt;\n&lt;li&gt;Link to additional tales from &lt;a target=&quot;_blank&quot; href=&quot;panchatantra.html&quot;&gt;&lt;i&gt;The Panchatantra&lt;/i&gt;&lt;/a&gt;.    &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n&#39;),
 (&#39;\n&lt;h2&gt;&lt;a name=&quot;somadeva&quot;&gt;The Mice That Ate an Iron Balance&lt;/a&gt;&lt;/h2&gt;\n&lt;h3&gt;India&lt;/h3&gt;\nOnce on a time the was a merchant\&#39;s son, who had spent all his father\&#39;s wealth, and had only an iron balance left to him. Now the balance was made of a thousand &lt;i&gt;palas&lt;/i&gt; of iron; and depositing it in the care of a certain merchant, he went to another land. &lt;p&gt; \nAnd when, on his return, he came to that merchant to demand back his balance, the merchant said to him, &quot;It has been eaten by mice.&quot; He repeated, &quot;It is quite true, the iron, of which it was composed, was particularly sweet, and so the mice ate it.&quot; &lt;p&gt; \nThis he said with an outward show of sorrow, laughing in his heart. Then the merchant\&#39;s son asked him to give him some food, and he, being in a good temper, consented to give him some. &lt;p&gt; \nThen the merchant\&#39;s son went to bathe, taking with him the son of that merchant, who was a mere child, and whom he persuaded to come with him by giving him a dish of &lt;i&gt;ámalakas&lt;/i&gt;. And after he had bathed, the wise merchant\&#39;s son deposited the boy in the house of a friend, and returned alone to the house of that merchant. &lt;p&gt; \nAnd the merchant said to him, &quot;Where is that son of mine?&quot; &lt;p&gt; \nHe replied, &quot;A kite swooped down from the air and carried him off.&quot; &lt;p&gt; \nThe merchant in a rage said, &quot;You have concealed my son,&quot; and so he took him into the king\&#39;s judgment hall; and there the merchant\&#39;s son made the same statement. &lt;p&gt; \nThe officers of the court said, &quot; This is impossible, how could a kite carry off a boy?&quot; &lt;p&gt; \nBut the merchant\&#39;s son answered, &quot; In a country where a large balance of iron was eaten by mice, a kite might carry off an elephant, much more a boy.&quot; &lt;p&gt; \nWhen the officers heard that, they asked about it, out of curiosity, and made the merchant restore the balance to the owner, and he, for his part, restored the merchant\&#39;s child. &lt;p&gt;\n&#39;,
  &#39;\n&lt;ul&gt;\n&lt;li&gt;Source: Somadeva Bhatta,  &lt;i&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=6cVDAAAAYAAJ&amp;amp;pg=PP5#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;The Kátha Sarit Ságara; or, Ocean of the Streams of Story&lt;/a&gt;&lt;/i&gt;, vol. 2. Translated from the original Sanskrit by C. H. Tawney (Calcutta: Printed by J. W. Thomas at the Baptist Mission Press, 1884), &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=6cVDAAAAYAAJ&amp;amp;pg=PA41#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;pp. 41-42&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n&#39;)]
</pre></div>
</div>
</div>
</div>
<p>We can now start to parse the separate chunks of story. For example, the title appears in an <code class="docutils literal notranslate"><span class="pre">&lt;h2&gt;</span></code> element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">requests_html</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="n">example_story_html</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="n">story_chunk_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">example_story_html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Miracle upon Miracle&#39;
</pre></div>
</div>
</div>
</div>
<p>There is sometimes a subtitle in an <code class="docutils literal notranslate"><span class="pre">&lt;h3&gt;</span></code> element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_subheading</span> <span class="o">=</span> <span class="n">example_story_html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">example_subheading</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">example_subheading</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>India
</pre></div>
</div>
</div>
</div>
<p>We have access to the full story text:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_story_html</span><span class="o">.</span><span class="n">full_text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Miracle upon Miracle\nIndia\nIn a certain place there once lived a merchant by the name of Nanduka, which means &quot;cheerful one&quot; and a merchant by the name of Lakschmana, which means &quot;fortunate one.&quot;  The latter, who had lost all his wealth, decided to travel abroad.  For it is said:  A person who has lived well in a particular place, but who stays there after he has lost his wealth, is of common mind. And further: A person who, reduced to misery, remains at a place where he once was happy, is worthy of reproach.\n\nIn his house there was a large set of heavy iron scales that had been acquired by his ancestors.  He gave these to the guild-master Nanduka for safekeeping, and set forth for foreign lands.   \nAfter he had pursued his desires for a long time abroad, he returned to his homeland, and said to the guild-master Nanduka, &quot;Guild-master, give me back the scales that I left here for safekeeping.&quot; \nNanduka replied, &quot;Oh, your scales are no longer here.  The mice ate them up.&quot;  \nWhen he heard this, Lakschmana said, &quot;Well, Nanduka, if the mice ate them up, then it is through no fault of yours.  That is the way of the world.  Nothing in it is eternal.  But now I would like to bathe myself in the river.  Send your child with me, the boy named Dhanadeva, to carry my bathing things.&quot;  \nNanduka, fearing Lakschama because of the theft he had committed against him, said to his son, &quot;Child, your uncle Lakschmana wants to take a bath in the river.  Go with him and carry his bathing things.&quot;   \nYes, with truth they say: No one does a favor for another, unless driven by fear, greed, or some other purpose. And further: If someone shows you unusual courtesy, be cautious, lest it lead to a bad end.  \nNanduka\&#39;s son, carrying the bathing things, set forth happily with Lakschmana.  After taking his bath, Lakschmana threw Nanduka\&#39;s son Dhanadeva into a cave on the bank of the river, and sealed the opening with a large stone.  Then he rushed back to Nanduka\&#39;s house.   \nThe merchant asked him, &quot;Speak up, Lakschmana!  Tell me, where is my child who went to the river with you?&quot; \nLakschmana said, &quot;He was taken away from the river\&#39;s bank by a falcon.&quot; \nThe merchant cried, &quot;You liar!  How in the world can a falcon steal a boy?  Give me back my son, or I will bring action against you at the king\&#39;s court.&quot; \nLakschmana said, &quot;Oh, you who always speak the truth!  A falcon can carry away a boy, if mice can eat a large set of heavy iron scales.  If you want your son back, then give me my scales!&quot; \nThus quarreling one with another, they went to the king\&#39;s gate, where Nanduka cried out loudly, &quot;A dastardly crime has happened here!  This thief has robbed me of my child!&quot;  \nHearing this, the judges said to Lakschmana, &quot;Return the guild-master\&#39;s son to him!&quot; \nLakschmana answered, &quot;What can I do?  Before my very eyes a falcon carried him away from the bank of the river.&quot; \nHearing this, they said, &quot;You do not tell the truth.  How could a falcon be capable of carrying off a fifteen-year-old boy?&quot; \nLakschmana answered, laughing, &quot;Ha!  Listen to this proverb: When mice can eat a thousand pounds of iron, then a falcon can carry away an elephant, to say nothing of a little boy.&quot; \nThe judges said, &quot;What do you mean by that?&quot; \nThen Lakschmana told the whole story about the scales.  After hearing this, they laughed at what Nanduka and Lakschmana had done, reconciled the two with each other, and made them respectively return the scales and the boy. \n&#39;
</pre></div>
</div>
</div>
</div>
<p>If the original HTML included “useful” HTML tags, these would be stripped out in the <code class="docutils literal notranslate"><span class="pre">full_text</span></code>,, so instead it might be useful to parse the story and additional information HTML as markdown (a simple structured text format).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">story_chunk_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;h2&gt;&lt;a name=&quot;panchatantra&quot;&gt;Miracle upon Miracle&lt;/a&gt;&lt;/h2&gt;\n&lt;h3&gt;India&lt;/h3&gt;\nIn a certain place there once lived a merchant by the name of Nanduka, which means &quot;cheerful one&quot; and a merchant by the name of Lakschmana, which means &quot;fortunate one.&quot;  The latter, who had lost all his wealth, decided to travel abroad.  For it is said: &lt;i&gt; A person who has lived well in a particular place, but who stays there after he has lost his wealth, is of common mind.&lt;/i&gt; And further: &lt;i&gt;A person who, reduced to misery, remains at a place where he once was happy, is worthy of reproach.&lt;/i&gt;\n&lt;p&gt;\nIn his house there was a large set of heavy iron scales that had been acquired by his ancestors.  He gave these to the guild-master Nanduka for safekeeping, and set forth for foreign lands.  &lt;p&gt; \nAfter he had pursued his desires for a long time abroad, he returned to his homeland, and said to the guild-master Nanduka, &quot;Guild-master, give me back the scales that I left here for safekeeping.&quot; &lt;p&gt;\nNanduka replied, &quot;Oh, your scales are no longer here.  The mice ate them up.&quot; &lt;p&gt; \nWhen he heard this, Lakschmana said, &quot;Well, Nanduka, if the mice ate them up, then it is through no fault of yours.  That is the way of the world.  Nothing in it is eternal.  But now I would like to bathe myself in the river.  Send your child with me, the boy named Dhanadeva, to carry my bathing things.&quot; &lt;p&gt; \nNanduka, fearing Lakschama because of the theft he had committed against him, said to his son, &quot;Child, your uncle Lakschmana wants to take a bath in the river.  Go with him and carry his bathing things.&quot;  &lt;p&gt; \nYes, with truth they say: &lt;i&gt;No one does a favor for another, unless driven by fear, greed, or some other purpose.&lt;/i&gt; And further: &lt;i&gt;If someone shows you unusual courtesy, be cautious, lest it lead to a bad end.&lt;/i&gt; &lt;p&gt; \nNanduka\&#39;s son, carrying the bathing things, set forth happily with Lakschmana.  After taking his bath, Lakschmana threw Nanduka\&#39;s son Dhanadeva into a cave on the bank of the river, and sealed the opening with a large stone.  Then he rushed back to Nanduka\&#39;s house.  &lt;p&gt; \nThe merchant asked him, &quot;Speak up, Lakschmana!  Tell me, where is my child who went to the river with you?&quot; &lt;p&gt;\nLakschmana said, &quot;He was taken away from the river\&#39;s bank by a falcon.&quot; &lt;p&gt;\nThe merchant cried, &quot;You liar!  How in the world can a falcon steal a boy?  Give me back my son, or I will bring action against you at the king\&#39;s court.&quot; &lt;p&gt;\nLakschmana said, &quot;Oh, you who always speak the truth!  A falcon can carry away a boy, if mice can eat a large set of heavy iron scales.  If you want your son back, then give me my scales!&quot; &lt;p&gt;\nThus quarreling one with another, they went to the king\&#39;s gate, where Nanduka cried out loudly, &quot;A dastardly crime has happened here!  This thief has robbed me of my child!&quot; &lt;p&gt; \nHearing this, the judges said to Lakschmana, &quot;Return the guild-master\&#39;s son to him!&quot; &lt;p&gt;\nLakschmana answered, &quot;What can I do?  Before my very eyes a falcon carried him away from the bank of the river.&quot; &lt;p&gt;\nHearing this, they said, &quot;You do not tell the truth.  How could a falcon be capable of carrying off a fifteen-year-old boy?&quot; &lt;p&gt;\nLakschmana answered, laughing, &quot;Ha!  Listen to this proverb: &lt;i&gt;When mice can eat a thousand pounds of iron, then a falcon can carry away an elephant, to say nothing of a little boy.&lt;/i&gt;&quot; &lt;p&gt;\nThe judges said, &quot;What do you mean by that?&quot; &lt;p&gt;\nThen Lakschmana told the whole story about the scales.  After hearing this, they laughed at what Nanduka and Lakschmana had done, reconciled the two with each other, and made them respectively return the scales and the boy. &lt;p&gt;\n&#39;
</pre></div>
</div>
</div>
</div>
<p>The following function will attempt to repair any broken HTML before we pass it to <code class="docutils literal notranslate"><span class="pre">markdownify</span></code>. There are probably better ways of doing this!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%pip install --upgrade markdownify</span>
<span class="kn">import</span> <span class="nn">html5lib</span>
<span class="kn">import</span> <span class="nn">lxml</span>

<span class="kn">import</span> <span class="nn">markdownify</span>

<span class="k">def</span> <span class="nf">repair_HTML</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Repair HTML.&quot;&quot;&quot;</span>
    <span class="c1"># html5bib repairs the broken HTML</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">html5lib</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">treebuilder</span><span class="o">=</span><span class="s1">&#39;lxml&#39;</span><span class="p">,</span> <span class="n">namespaceHTMLElements</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">html_</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;&lt;body&gt;</span><span class="si">{html}</span><span class="s2">&lt;/body&gt;&quot;</span><span class="p">,</span> <span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">html_</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">html_</span><span class="p">[</span><span class="s1">&#39;html&#39;</span><span class="p">],</span> <span class="n">tree</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span>


<span class="p">(</span><span class="n">_html</span><span class="p">,</span> <span class="n">_tree</span><span class="p">)</span> <span class="o">=</span> <span class="n">repair_HTML</span><span class="p">(</span><span class="n">story_chunk_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

<span class="n">markdownify</span><span class="o">.</span><span class="n">markdownify</span><span class="p">(</span><span class="n">_html</span><span class="p">,</span> <span class="n">bullets</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Miracle upon Miracle\n--------------------\n\n\n### India\n\n\nIn a certain place there once lived a merchant by the name of Nanduka, which means &quot;cheerful one&quot; and a merchant by the name of Lakschmana, which means &quot;fortunate one.&quot; The latter, who had lost all his wealth, decided to travel abroad. For it is said:  *A person who has lived well in a particular place, but who stays there after he has lost his wealth, is of common mind.* And further: *A person who, reduced to misery, remains at a place where he once was happy, is worthy of reproach.*\n\nIn his house there was a large set of heavy iron scales that had been acquired by his ancestors. He gave these to the guild-master Nanduka for safekeeping, and set forth for foreign lands. \n\n \nAfter he had pursued his desires for a long time abroad, he returned to his homeland, and said to the guild-master Nanduka, &quot;Guild-master, give me back the scales that I left here for safekeeping.&quot; \n\n\nNanduka replied, &quot;Oh, your scales are no longer here. The mice ate them up.&quot; \n\n \nWhen he heard this, Lakschmana said, &quot;Well, Nanduka, if the mice ate them up, then it is through no fault of yours. That is the way of the world. Nothing in it is eternal. But now I would like to bathe myself in the river. Send your child with me, the boy named Dhanadeva, to carry my bathing things.&quot; \n\n \nNanduka, fearing Lakschama because of the theft he had committed against him, said to his son, &quot;Child, your uncle Lakschmana wants to take a bath in the river. Go with him and carry his bathing things.&quot; \n\n \nYes, with truth they say: *No one does a favor for another, unless driven by fear, greed, or some other purpose.* And further: *If someone shows you unusual courtesy, be cautious, lest it lead to a bad end.* \n\n \nNanduka\&#39;s son, carrying the bathing things, set forth happily with Lakschmana. After taking his bath, Lakschmana threw Nanduka\&#39;s son Dhanadeva into a cave on the bank of the river, and sealed the opening with a large stone. Then he rushed back to Nanduka\&#39;s house. \n\n \nThe merchant asked him, &quot;Speak up, Lakschmana! Tell me, where is my child who went to the river with you?&quot; \n\n\nLakschmana said, &quot;He was taken away from the river\&#39;s bank by a falcon.&quot; \n\n\nThe merchant cried, &quot;You liar! How in the world can a falcon steal a boy? Give me back my son, or I will bring action against you at the king\&#39;s court.&quot; \n\n\nLakschmana said, &quot;Oh, you who always speak the truth! A falcon can carry away a boy, if mice can eat a large set of heavy iron scales. If you want your son back, then give me my scales!&quot; \n\n\nThus quarreling one with another, they went to the king\&#39;s gate, where Nanduka cried out loudly, &quot;A dastardly crime has happened here! This thief has robbed me of my child!&quot; \n\n \nHearing this, the judges said to Lakschmana, &quot;Return the guild-master\&#39;s son to him!&quot; \n\n\nLakschmana answered, &quot;What can I do? Before my very eyes a falcon carried him away from the bank of the river.&quot; \n\n\nHearing this, they said, &quot;You do not tell the truth. How could a falcon be capable of carrying off a fifteen-year-old boy?&quot; \n\n\nLakschmana answered, laughing, &quot;Ha! Listen to this proverb: *When mice can eat a thousand pounds of iron, then a falcon can carry away an elephant, to say nothing of a little boy.*&quot; \n\n\nThe judges said, &quot;What do you mean by that?&quot; \n\n\nThen Lakschmana told the whole story about the scales. After hearing this, they laughed at what Nanduka and Lakschmana had done, reconciled the two with each other, and made them respectively return the scales and the boy.&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_tree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;lxml.etree._ElementTree at 0x11d5ea240&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span>

<span class="n">Markdown</span><span class="p">(</span><span class="n">markdownify</span><span class="o">.</span><span class="n">markdownify</span><span class="p">(</span><span class="n">repair_HTML</span><span class="p">(</span><span class="n">story_chunk_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<span class="docutils literal">/Users/tonyhirst/Documents/GitHub/storynotes/Ashliman_folk_texts_scraper.ipynb</span>, line 1)</p>
<p>Non-consecutive header level increase; 0 to 2 [myst.header]</p>
</div>
</div>
</div>
<p>If we look at the additional information, we see that it contains a list of items, which may contain links. The final list item is boilerplate and we can remove it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">story_chunk_tuples</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\n&lt;ul&gt;\n&lt;li&gt;Source: Jean de La Fontaine, &lt;i&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=93eRAAAAIAAJ&amp;amp;pg=PR3#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;The Fables of La Fontaine&lt;/a&gt;&lt;/i&gt;. Translated from the French by Elizur Wright. A new edition with notes by J. W. M. Gibbs (London: George Bell and Sons, 1888), &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=93eRAAAAIAAJ&amp;amp;pg=PA220#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;book 9, fable 1, pp. 220-23&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Link to the original French text: &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=buf_8PDVOYYC&amp;amp;pg=PA332#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;Le dépositaire infidèle&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">additional_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">li</span><span class="o">.</span><span class="n">html</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="n">story_chunk_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">additional_info</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;&lt;li&gt;Source: The &lt;i&gt;Panchatantra&lt;/i&gt;, book 1, story 21. &lt;p&gt;\n&lt;li&gt;I have used the following edition:  &lt;i&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PR3#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;Pantschatantra: Fünf Bücher indischer Fabeln, Märchen und Erzählungen&lt;/a&gt;&lt;/i&gt;.  Aus dem Sanskrit übersetzt mit Einleitung und Anmerkungen von Theodor Benfey (Leipzig: F. A. Brockhaus, 1859), &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PA120#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;vol. 2, pp. 120-22&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Translated from the German by D. L. Ashliman. &lt;p&gt;\n&lt;li&gt;Link to additional tales from &lt;a target=&quot;_blank&quot; href=&quot;panchatantra.html&quot;&gt;&lt;i&gt;The Panchatantra&lt;/i&gt;&lt;/a&gt;.    &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&#39;,
 &#39;&lt;li&gt;I have used the following edition:  &lt;i&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PR3#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;Pantschatantra: Fünf Bücher indischer Fabeln, Märchen und Erzählungen&lt;/a&gt;&lt;/i&gt;.  Aus dem Sanskrit übersetzt mit Einleitung und Anmerkungen von Theodor Benfey (Leipzig: F. A. Brockhaus, 1859), &lt;a target=&quot;_blank&quot; href=&quot;http://books.google.com/books?id=_i0qAAAAYAAJ&amp;amp;pg=PA120#v=onepage&amp;amp;q&amp;amp;f=false&quot;&gt;vol. 2, pp. 120-22&lt;/a&gt;. &lt;p&gt;\n&lt;li&gt;Translated from the German by D. L. Ashliman. &lt;p&gt;\n&lt;li&gt;Link to additional tales from &lt;a target=&quot;_blank&quot; href=&quot;panchatantra.html&quot;&gt;&lt;i&gt;The Panchatantra&lt;/i&gt;&lt;/a&gt;.    &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&#39;,
 &#39;&lt;li&gt;Translated from the German by D. L. Ashliman. &lt;p&gt;\n&lt;li&gt;Link to additional tales from &lt;a target=&quot;_blank&quot; href=&quot;panchatantra.html&quot;&gt;&lt;i&gt;The Panchatantra&lt;/i&gt;&lt;/a&gt;.    &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&#39;,
 &#39;&lt;li&gt;Link to additional tales from &lt;a target=&quot;_blank&quot; href=&quot;panchatantra.html&quot;&gt;&lt;i&gt;The Panchatantra&lt;/i&gt;&lt;/a&gt;.    &lt;p&gt;\n&lt;li&gt;Return to the &lt;a href=&quot;#contents&quot;&gt;table of contents&lt;/a&gt;. &lt;p&gt;\n&lt;/p&gt;&lt;/li&gt;&lt;/p&gt;&lt;/li&gt;&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;&lt;body&gt;</span><span class="si">{html}</span><span class="s2">&lt;/body&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&lt;body&gt;sdsds&lt;/body&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Result () {&#39;html&#39;: &#39;sdsds&#39;}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lxml</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;&lt;body&gt;&lt;p&gt;sdsd&lt;/p&gt;&lt;p&gt;sdsds&lt;/p&gt;&lt;/body&gt;&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">markdownify</span><span class="o">.</span><span class="n">markdownify</span><span class="p">(</span><span class="n">story_chunk_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;b&#39;&lt;body&gt;&lt;p&gt;sdsd&lt;/p&gt;&lt;p&gt;sdsds&lt;/p&gt;&lt;/body&gt;&#39;&quot;
</pre></div>
</div>
</div>
</div>
<p>In some records, the Aarne-Thompson-Uther type is given, which we can easily parse out if it is presented in a regular form:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">parse</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="c1">#Aarne-Thompson-Uther type 1586.</span>

<span class="c1"># Requires exact match</span>
<span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Aarne-Thompson-Uther type </span><span class="si">{atu}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="s2">&quot;Aarne-Thompson-Uther type 1586.&quot;</span><span class="p">)</span>
<span class="c1"># Accepts arbitrary but required prefix</span>
<span class="n">parse</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Aarne-Thompson-Uther type </span><span class="si">{atu}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="s2">&quot;Similar to Aarne-Thompson-Uther type 1586.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Result (&#39;Similar to &#39;,) {&#39;atu&#39;: &#39;1586&#39;}&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-a-simple-database">
<h2>Create a Simple Database<a class="headerlink" href="#create-a-simple-database" title="Permalink to this headline">¶</a></h2>
<p>We can create a simple database structure to hold the stories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlite_utils</span> <span class="kn">import</span> <span class="n">Database</span>

<span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;ashliman_demo.db&quot;</span>

<span class="c1"># While developing the script, recreate database each time...</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">db_name</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s start off with a table for the stories. This should include:</p>
<ul class="simple">
<li><p>story title;</p></li>
<li><p>story text;</p></li>
<li><p>story metadata.</p></li>
</ul>
<p>There may also be optional subheading information.</p>
<p>From the page, we will also be able to get the general tale type. We may also be able to get the ATU tale type, either from the page, or from the story record. We can include these in our table definition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;ashliman_stories&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete_where</span><span class="p">()</span>
<span class="n">db</span><span class="p">[</span><span class="s2">&quot;ashliman_stories&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;subheading&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;generic_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;generic_info&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;atu&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="c1"># This may be null</span>
    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1"># Create a full text search table to improve search support</span>
<span class="n">db</span><span class="p">[</span><span class="s2">&quot;ashliman_stories&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">enable_fts</span><span class="p">([</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">create_triggers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="s2">&quot;porter&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Table ashliman_stories (title, subheading, text, metadata, generic_type, generic_info, atu, url)&gt;
</pre></div>
</div>
</div>
</div>
<p>Let’s see if we can add create an example set of records from a single page and add it to the database:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fetch_and_parse_page</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fetch and parse Ashliman story pages.&quot;&quot;&quot;</span>
    
    <span class="n">page_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="n">atu_regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^.*Aarne-Thompson-Uther type (?P&lt;atu&gt;[\da-zA-Z]+).*&quot;</span>
    
    <span class="n">story_records</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">atu</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">generic_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="c1"># Low hanging fruit: ATU in URL</span>
    <span class="n">url_regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^type(?P&lt;atu&gt;[\da-zA-Z]+)\.html&quot;</span>
    <span class="n">_url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">matches</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">_url</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">atu</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>
    <span class="c1"># Low hanging fruit - atu in text</span>
    <span class="n">generic_info</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//p[@align=&quot;CENTER&quot;]&#39;</span><span class="p">)</span>
    <span class="n">generic_info</span> <span class="o">=</span> <span class="n">generic_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">generic_info</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># Check to see if we can find an ATU; if we do, this overrides the page atu</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atu_regex</span><span class="p">,</span> <span class="n">generic_info</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">atu</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>
    
    <span class="c1"># The generic type is the page title</span>
    <span class="c1"># Get the head information</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//h1[@align=&quot;CENTER&quot;]&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">full_text</span>
        <span class="n">generic_type</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c1"># See if an ATU is defined in the header</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atu_regex</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">atu</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>

    <span class="c1"># Now find stories</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">html</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">html</span>
        <span class="c1"># This pages are old so patch them</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;hr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;hr/&gt;&quot;</span><span class="p">)</span>
        
    <span class="c1"># Split out the section containing the stories</span>
    <span class="n">story_section</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&lt;hr/&gt;</span><span class="se">\n</span><span class="s2">&lt;p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">exceptions</span><span class="p">[</span><span class="n">url</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">story_section</span><span class="si">}{</span><span class="n">exceptions</span><span class="p">[</span><span class="n">url</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">stories_html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">story_section</span><span class="p">)</span>
    <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stories_html</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">stories_html</span> <span class="o">=</span> <span class="n">stories_html</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

    <span class="c1"># Chunk the stories</span>
    <span class="n">story_chunks</span> <span class="o">=</span> <span class="n">stories_html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;hr/&gt;&lt;hr/&gt;&quot;</span><span class="p">)</span>
    <span class="c1"># Some old pages may not have the non-story boilerplate at the end</span>
    <span class="n">story_chunks</span> <span class="o">=</span> <span class="n">story_chunks</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">story_chunks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">story_chunks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Now iterate through all the stories</span>
    <span class="k">for</span> <span class="n">story_chunk</span> <span class="ow">in</span> <span class="n">story_chunks</span><span class="p">:</span>
        <span class="n">record</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;generic_type&#39;</span><span class="p">:</span> <span class="n">generic_type</span><span class="p">,</span>
                  <span class="s1">&#39;generic_info&#39;</span><span class="p">:</span> <span class="n">generic_info</span><span class="p">,</span>
                  <span class="s1">&#39;atu&#39;</span><span class="p">:</span><span class="n">atu</span><span class="p">,</span>
                  <span class="s1">&#39;metadata&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
        
        <span class="n">story_chunk_items</span> <span class="o">=</span> <span class="n">story_chunk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">)</span>
    
    
    
        <span class="c1"># Trap any broken html...</span>
        <span class="c1">#try:</span>
        <span class="c1">#    story_html = HTML(html=story_chunk_items[0])</span>
        <span class="c1">#except:</span>
        <span class="c1">#    pass</span>
        <span class="c1">#record[&#39;text&#39;] = story_html.full_text.strip()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_html</span><span class="p">,</span> <span class="n">story_tree</span><span class="p">)</span> <span class="o">=</span> <span class="n">repair_HTML</span><span class="p">(</span><span class="n">story_chunk_items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">markdownify</span><span class="o">.</span><span class="n">markdownify</span><span class="p">(</span><span class="n">_html</span><span class="p">,</span> <span class="n">bullets</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1">#record[&#39;html&#39;] = _html</span>
            <span class="n">story_tree</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="n">_html</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
        
        <span class="c1"># If there is no story text, move on</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]:</span>
            <span class="k">continue</span>
        
        <span class="c1"># Get title</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">story_tree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">title</span> <span class="k">else</span> <span class="n">generic_type</span>
        <span class="c1"># If we have not dropped the contents section, and we can identify it, move on...</span>
        <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="s1">&#39;Contents&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        
        <span class="c1"># Get optional subheading</span>
        <span class="n">subheading</span> <span class="o">=</span> <span class="n">story_tree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span>
        <span class="n">subheading</span> <span class="o">=</span> <span class="n">subheading</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">subheading</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;subheading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subheading</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">story_chunk_items</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_html</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">repair_HTML</span><span class="p">(</span><span class="n">story_chunk_items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">markdownify</span><span class="o">.</span><span class="n">markdownify</span><span class="p">(</span><span class="n">_html</span><span class="p">,</span> <span class="n">bullets</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># Cleaning, added as and when I spot it&#39;s necessary</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;- Return to the [table of contents](#contents).&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">record</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># Check to see if we can find an ATU; if we do, this overrides the page atu</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atu_regex</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
                <span class="n">record</span><span class="p">[</span><span class="s1">&#39;atu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>
        
        <span class="c1"># Depending on the layout, we may get what is essentially a null record</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;folktexts&#39;</span> <span class="ow">and</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Return to D. L. Ashliman&quot;</span><span class="p">):</span>
            <span class="n">story_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">story_records</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try that function out:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a hack fix - some pages don&#39;t have the conventional split string</span>
<span class="n">exceptions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;https://sites.pitt.edu/~dash/hildebrand.html&quot;</span><span class="p">:</span> <span class="s2">&quot;I have heard tell&quot;</span><span class="p">,</span>
              <span class="s2">&quot;https://sites.pitt.edu/~dash/bluebelt.html&quot;</span><span class="p">:</span> <span class="s2">&quot;Once upon a time&quot;</span><span class="p">,</span>
              <span class="s2">&quot;https://sites.pitt.edu/~dash/lowell.html&quot;</span><span class="p">:</span> <span class="s2">&quot;I had a little daughter&quot;</span><span class="p">,</span>
              <span class="s2">&quot;https://sites.pitt.edu/~dash/changeling.html&quot;</span><span class="p">:</span> <span class="s1">&#39;&lt;h2&gt;&lt;a name=&quot;legends&quot;&gt;The legends &lt;/a&gt;&lt;/h2&gt;&#39;</span><span class="p">}</span>
    
<span class="n">example_records</span> <span class="o">=</span> <span class="n">fetch_and_parse_page</span><span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">exceptions</span><span class="p">)</span>
<span class="n">example_records</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;generic_type&#39;: &#39;The Foolish Friend&#39;,
  &#39;generic_info&#39;: &quot;and other folktales of Aarne-Thompson-Uther type 1586\nin which a fool kills an insect resting on someone&#39;s head,\nwith catastrophic consequences,\nselected and edited by\n\nD. L. Ashliman\n© 1999-2014&quot;,
  &#39;atu&#39;: &#39;1586&#39;,
  &#39;metadata&#39;: &quot;- Source: [*Æsop&#39;s Fables*](http://archive.org/stream/aesopsfables00chesuoft#page/n11/mode/2up), translated by V. S. Vernon Jones (London: William Heinemann, 1916), [p. 129](http://archive.org/stream/aesopsfables00chesuoft#page/128/mode/2up).\n- Link to additional [folktales about \nbald men](bald.html).&quot;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type1586.html&#39;,
  &#39;text&#39;: &#39;The Bald Man and the Fly\n------------------------\n\n\n### Aesop\n\n \nA fly settled on the head of a bald man and bit him. In his eagerness to \nkill it, he hit himself a smart slap.  \nBut the fly escaped, and said to him in derision, &quot;You tried to kill me \nfor just one little bite; what will you do to yourself now, for the heavy \nsmack you have just given yourself?&quot; \n\n \n&quot;Oh, for that blow I bear no grudge,&quot; he replied, &quot;for I never intended \nmyself any harm; but as for you, you contemptible insect, who live by \nsucking human blood, I\&#39;d have borne a good deal more than that for the \nsatisfaction of dashing the life out of you!&quot;&#39;,
  &#39;title&#39;: &#39;The Bald Man and the Fly&#39;,
  &#39;subheading&#39;: &#39;Aesop&#39;},
 {&#39;generic_type&#39;: &#39;The Foolish Friend&#39;,
  &#39;generic_info&#39;: &quot;and other folktales of Aarne-Thompson-Uther type 1586\nin which a fool kills an insect resting on someone&#39;s head,\nwith catastrophic consequences,\nselected and edited by\n\nD. L. Ashliman\n© 1999-2014&quot;,
  &#39;atu&#39;: &#39;1586&#39;,
  &#39;metadata&#39;: &#39;&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type1586.html&#39;,
  &#39;text&#39;: &#39;The Seven Wise Men of Buneyr\n----------------------------\n\n\n### Pakistan\n\n\nSeven men of Buneyr once left their native wilds for the purpose of\nseeking their fortunes. When evening came they all sat down under a tree\nto rest, when one of them said, &quot;Let us count to see if we are all here.&quot;\nSo he counted, &quot;One, two, three, four, five, six,&quot; but, quite omitting to\nreckon himself, he exclaimed, &quot;There\&#39;s one of us missing, we are only\nsix!&quot;\n\n\n&quot;Nonsense!&quot; cried the others, and the whole company of seven began\ncounting with uplifted forefingers, but they all forgot to count\nthemselves.\n\n\nFearing some evil, they now rose up, and at once set out to search for\ntheir missing comrade. Presently they met a shepherd, who greeted them\ncivilly and said, &quot;Friends, why are you in such low spirits?&quot;\n\n\n&quot;We have lost one of our party,&quot; answered they; &quot;we started this\nmorning seven in number, and now we are only six. Have you seen any one of\nus hereabouts?&quot;\n\n\n&quot;But,&quot; said the shepherd, &quot;seven you are, for I have found your lost\ncompanion; behold: one, two, three, four, five, six, *seven!*&quot;\n\n\n&quot;Ah,&quot; answered the wise men of Buneyr, &quot;you have indeed found our\nmissing brother. We owe you a debt of gratitude. Because you have done us\nthis service, we insist on doing a month\&#39;s free labor for you.&quot;\n\n\nSo the shepherd, overjoyed with his good fortune, took the men home\nwith him.\n\n\nNow, the shepherd\&#39;s mother was a very old woman, in her dotage, utterly\nfeeble and unable to help herself. When the morning came he placed her\nunder the care of one of the Buneyris, saying to him, &quot;You will stay here\nand take care of my old mother.&quot;\n\n\nTo another Buneyri he said, &quot;You take out my goats, graze them on the\nhills by day, and watch over them by night.&quot;\n\n\nTo the other five he said, &quot;As for you, I shall have work for you\ntomorrow.&quot;\n\n\nThe man who was left in charge of the old crippled mother found that\nhis time was fully occupied in the constant endeavor to drive off the\ninnumerable flies which in that hot season kept her in a state of\ncontinual excitement and irritation. When, however, he saw that all his\nefforts were fruitless, and that he flapped the wretches away in vain, he\nbecame desperate, and, lifting up a large stone, he aimed it deliberately\nat a certain fly which had settled on the woman\&#39;s face. Hurling it with\nall his might, he of course missed the fly, but, alas! he knocked the\nwoman prone on her back. When the shepherd saw this he wrung his hands in\ndespair. &quot;Ah,&quot; cried he, &quot;what has your stupidity done for me? The fly has\nescaped, but as for my poor old mother, you have killed her dead.&quot;\n\n\nMeanwhile, the second Buneyri led his flock of goats up and down among\nthe hills, and when midday came he rested to eat his bread, while many of\nthe assembled goats lay down beside him. As he was eating he began to\nobserve how the goats were chewing the cud and occasionally looking at him\nSo he foolishly imagined that they were mocking him, and waxed wroth.\n&quot;So,&quot; cried he, &quot;because I am taking my food, you must needs crowd round\nand make game of me, must you?&quot; And, seizing his hatchet, he made a sudden\nrush at the poor animals, and he had already struck off the heads of\nseveral of them, when the shepherd came running to the spot, bemoaning his\nbad luck and crying to the fellow to desist from slaughter.\n\n\nThat night was a sorrowful one for the trustful shepherd, and bitterly\nhe repented his rashness. In the morning the remaining five wise men of\nBuneyr came to him, and said, &quot;It is now our turn. Give us some work to\ndo, too!&quot;\n\n\n&quot;No, no, my friends,&quot; answered he; &quot;you have amply repaid me for the\ntrifling favor I did for you in finding your missing companion; and now,\nfor God\&#39;s sake, go your way and let me see you no more.&quot;\n\n\nHearing these words, the wise men of Buneyr resumed their journey.&#39;,
  &#39;title&#39;: &#39;The Seven Wise Men of Buneyr&#39;,
  &#39;subheading&#39;: &#39;Pakistan&#39;}]
</pre></div>
</div>
</div>
</div>
<p>For the metadata, we could have a metadata table, with one or more rows per book depending on the number of metadata list items? Or is the use of lists in metadata inconsistently applied?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Markdown</span><span class="p">(</span><span class="n">example_records</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;metadata&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>We can add these to the database and have a go at querying them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="p">[</span><span class="s2">&quot;ashliman_stories&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete_where</span><span class="p">()</span>
<span class="n">db</span><span class="p">[</span><span class="s2">&quot;ashliman_stories&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert_all</span><span class="p">(</span><span class="n">example_records</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Table ashliman_stories (title, subheading, text, metadata, generic_type, generic_info, atu, url)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">read_sql</span>

<span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM ashliman_stories LIMIT 12&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>subheading</th>
      <th>text</th>
      <th>metadata</th>
      <th>generic_type</th>
      <th>generic_info</th>
      <th>atu</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>The Bald Man and the Fly</td>
      <td>Aesop</td>
      <td>The Bald Man and the Fly\n--------------------...</td>
      <td>- Source: [*Æsop's Fables*](http://archive.org...</td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Seven Wise Men of Buneyr</td>
      <td>Pakistan</td>
      <td>The Seven Wise Men of Buneyr\n----------------...</td>
      <td></td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Giufà and the Judge</td>
      <td>Italy</td>
      <td>Giufà and the Judge\n-------------------\n\n\n...</td>
      <td></td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>3</th>
      <td>The Tale of a Butter Tub</td>
      <td>Iceland</td>
      <td>The Tale of a Butter Tub\n--------------------...</td>
      <td>- Source: Jón Árnason, *[Icelandic \nLegends](...</td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>4</th>
      <td>The Seven Crazy Fellows</td>
      <td>Philippines</td>
      <td>The Seven Crazy Fellows\n---------------------...</td>
      <td>- Source: Fansler, [*Filipino \nPopular Tales*...</td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>5</th>
      <td>The Monkeys and the Dragonflies</td>
      <td>Philippines</td>
      <td>The Monkeys and the Dragonflies\n-------------...</td>
      <td>- Source: Fansler, [*Filipino \nPopular Tales*...</td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s now try to populate the whole database:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tqdm gives us a progress bar</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># Empty the database</span>
<span class="n">db</span><span class="p">[</span><span class="s2">&quot;ashliman_stories&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">delete_where</span><span class="p">()</span>

<span class="c1"># Iterate through all the pages, adding the stories to the db as we do so</span>
<span class="n">broken_parser_pages</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Also recall that requests-cache should be cacheing pages</span>
<span class="c1"># so we should only hit the original site once per page</span>
<span class="c1"># no matter how many times we run this in testing and development</span>
<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">fetch_and_parse_page</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="n">db</span><span class="p">[</span><span class="s2">&quot;ashliman_stories&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert_all</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">broken_parser_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "9ac435489b004dc4961c149983aa9a3a", "version_major": 2, "version_minor": 0}
</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: sleep.html&quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: _blank&quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:258: DataLossWarning: Coercing non-XML name: &lt;i
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: pentamerone&lt;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: href&#39;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:258: DataLossWarning: Coercing non-XML name: &quot;https:
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: &quot;https:
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: berdiemundarten00miklgoog#page
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:258: DataLossWarning: Coercing non-XML name: 2up&quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: 2up&quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: target&quot;_blank&quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: o:p
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:258: DataLossWarning: Coercing non-XML name: &quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: https:
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: books?id
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
</pre></div>
</div>
</div>
</div>
<p>Are there any pages that didn’t get parsed?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">broken_parser_pages</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>How many stories are there?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(*) AS num_stories FROM ashliman_stories&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>num_stories</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1122</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM ashliman_stories LIMIT 10&quot;</span>

<span class="n">read_sql</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>subheading</th>
      <th>text</th>
      <th>metadata</th>
      <th>generic_type</th>
      <th>generic_info</th>
      <th>atu</th>
      <th>url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Miracle upon Miracle</td>
      <td>India</td>
      <td>Miracle upon Miracle\n--------------------\n\n...</td>
      <td>- Source: The *Panchatantra*, book 1, story 21...</td>
      <td>The Iron-Eating Mice</td>
      <td></td>
      <td>1592</td>
      <td>https://sites.pitt.edu/~dash/type1592.html</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Mice That Ate an Iron Balance</td>
      <td>India</td>
      <td>The Mice That Ate an Iron Balance\n-----------...</td>
      <td>- Source: Somadeva Bhatta, *[The Kátha Sarit S...</td>
      <td>The Iron-Eating Mice</td>
      <td></td>
      <td>1592</td>
      <td>https://sites.pitt.edu/~dash/type1592.html</td>
    </tr>
    <tr>
      <th>2</th>
      <td>The Iron Weights and Scales Which Were Eaten b...</td>
      <td>India</td>
      <td>The Iron Weights and Scales Which Were Eaten b...</td>
      <td>- Source: *[The Enchanted Parrot: Being a Sele...</td>
      <td>The Iron-Eating Mice</td>
      <td></td>
      <td>1592</td>
      <td>https://sites.pitt.edu/~dash/type1592.html</td>
    </tr>
    <tr>
      <th>3</th>
      <td>The Faithless Depositary</td>
      <td>Jean de La Fontaine</td>
      <td>The Faithless Depositary\n--------------------...</td>
      <td>- Source: Jean de La Fontaine, *[The Fables of...</td>
      <td>The Iron-Eating Mice</td>
      <td></td>
      <td>1592</td>
      <td>https://sites.pitt.edu/~dash/type1592.html</td>
    </tr>
    <tr>
      <th>4</th>
      <td>The Two Merchants</td>
      <td>Russia, Leo Tolstoy</td>
      <td>The Two Merchants\n-----------------\n\n\n### ...</td>
      <td>- Source: Léon Tolstoï [Leo Tolstoy], "Les deu...</td>
      <td>The Iron-Eating Mice</td>
      <td></td>
      <td>1592</td>
      <td>https://sites.pitt.edu/~dash/type1592.html</td>
    </tr>
    <tr>
      <th>5</th>
      <td>The Bald Man and the Fly</td>
      <td>Aesop</td>
      <td>The Bald Man and the Fly\n--------------------...</td>
      <td>- Source: [*Æsop's Fables*](http://archive.org...</td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>6</th>
      <td>The Seven Wise Men of Buneyr</td>
      <td>Pakistan</td>
      <td>The Seven Wise Men of Buneyr\n----------------...</td>
      <td></td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Giufà and the Judge</td>
      <td>Italy</td>
      <td>Giufà and the Judge\n-------------------\n\n\n...</td>
      <td></td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>8</th>
      <td>The Tale of a Butter Tub</td>
      <td>Iceland</td>
      <td>The Tale of a Butter Tub\n--------------------...</td>
      <td>- Source: Jón Árnason, *[Icelandic \nLegends](...</td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Seven Crazy Fellows</td>
      <td>Philippines</td>
      <td>The Seven Crazy Fellows\n---------------------...</td>
      <td>- Source: Fansler, [*Filipino \nPopular Tales*...</td>
      <td>The Foolish Friend</td>
      <td>and other folktales of Aarne-Thompson-Uther ty...</td>
      <td>1586</td>
      <td>https://sites.pitt.edu/~dash/type1586.html</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TO DO - various bits of identified brokeness / warnings etc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fetch_and_parse_page</span><span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="mi">53</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: href&#39;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:258: DataLossWarning: Coercing non-XML name: &quot;https:
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: &quot;https:
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: berdiemundarten00miklgoog#page
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:258: DataLossWarning: Coercing non-XML name: 2up&quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
/usr/local/lib/python3.9/site-packages/html5lib/_ihatexml.py:266: DataLossWarning: Coercing non-XML name: 2up&quot;
  warnings.warn(&quot;Coercing non-XML name: %s&quot; % name, DataLossWarning)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (books.google.com): Evald Tang Kristensen, &quot;Prinsessens Mærker,&quot; *[Jyske Folkeminder: Især fra Hammerum Herred](https://books.google.com/books?id=dk21a14LY5MC&amp;pg=PR2#v=onepage&amp;q&amp;f=false)*, Femte Samling, (Copenhagen: Konrad Jørgensen, 1881), [no. 12, pp. 89-95](https://books.google.com/books?id=dk21a14LY5MC&amp;pg=PA89#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Evald Tang Kristensen, &quot;Prinsessens Mærker,&quot; *[Jyske Folkeminder: Især fra Hammerum Herred](https://archive.org/stream/jyskefolkeminde02krisgoog#page/n12/mode/2up)*, Femte Samling, (Copenhagen: Konrad Jørgensen, 1881), no. 12, pp. 89-95.\n- Translated by D. L. Ashliman. © 2016.&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Princess\&#39;s Birthmarks\n-------------------------\n\n\n### Denmark\n\n\nThere was a band of robbers who had their hideaway dug into a large mountain. Their captain had a son who was born there, but when he was grown, he did not want to stay with them, because he did not like their dealings, so his father allowed him to leave and seek work as an honest man. \nOn saying farewell, his father gave him a wallet and a golden box, things to remind him of his home. \n\n\nSome time later he found work with a squire to look after the sheep. On the squire\&#39;s farm was a mound where the sheep were not allowed to graze for fear that a wild troll might capture them. On his first morning the new shepherd drove the sheep to the mound, then sat down to eat his lunch. The troll suddenly appeared and asked for some of his lunch, and the shepherd gave him half. \n\n\nThen the troll said, &quot;Because you have shared your lunch with me, all will go well with your sheep.&quot; \n\n\nThus every day the lad went to the mound and shared his lunch with the troll, and in return the troll showed him the best places to graze the sheep. \n\n\nOne day the troll said to the lad, &quot;If you will continue to serve here until you are eighteen, I\&#39;ll help you.&quot; \n\n\nThe boy agreed to this and served four more years (he was fourteen when he started there). \n\n\nWhen the time came for him to leave, the troll said, &quot;You should now go to the king\&#39;s castle and take service there as a swineherd. I\&#39;ll give you this flute, and whenever you blow into it the pigs will dance ever so nicely. \n\n\nThe lad thanked him and went on his way. \n\n\nThe king had nine pigs, and the lad took them into the woods. On returning to the castle with them he blew into the flute, and the pigs jumped about and danced ever so beautifully. \n\n\nNow the princess saw the dancing pigs from her bedroom window, and she wanted to have one of them. The next day she secretly went into the woods and asked the swineherd if his pigs could indeed dance. \n\n\n&quot;Yes,&quot; he replied. &quot;Do you want to see them dance?&quot; \n\n\nHe blew into the flute, and the pigs danced. \n\n\n&quot;Will you sell me one of the pigs?&quot; \n\n\n&quot;I can do that,&quot; he said. \n\n\n&quot;How much will it cost? But it must be a pig that can dance.&quot; \n\n\nIn payment he asked only to see her garters. \n\n\nThis displeased the princess, but the swineherd would accept nothing else, so in the end she lifted up her skirts, and he gave her one of the pigs. \n\n\nBack at the castle she sent for her musicians, but for all their skill they could not make the pig dance. All the pig would do was to squeal and scream. So the next day she returned to the woods and complained to the swineherd. \n\n\n&quot;Your pig must have been too lonely to dance,&quot; explained the swineherd. &quot;You should buy another pig.&quot; \n\n\n&quot;Yes, but what will I have to pay for this one?&quot; \n\n\nShe would have to show him her breasts. So she undid her bodice and let him look, and he saw that she had two silver hairs below her left armpit and one golden hair below her right armpit. \n\n\nThus she got the second pig, but upon returning to the castle it too would not dance. So the next day she went once again into the woods to complain to the swineherd. \n\n\n&quot;I can give you a dancing pig,&quot; he promised, &quot;but first you must show me your bare arms.&quot; \n\n\nBy now she was used to such requests, so she rolled up her sleeves. He saw that on her left arm was a blood-red spot as large as a ducat. It was a birthmark that she had been born with. \n\n\nSo she got the third pig and returned home with it, but it too refused to dance, however much her musicians played and drummed. \n\n\nThat evening when the lad returned to the castle with his six pigs the king noticed that three were missing, and because the swineherd could not explain how they had disappeared, the king dismissed him forthwith. \n\n\nNow in those same days the king issued a proclamation throughout the realm that whoever might guess the princess\&#39;s birthmarks could have her in marriage. \n\n\nMany suitors arrived on the appointed day. The king saw them one by one, but none guessed right. All the while the swineherd was hiding behind a door where he could hear everything. \n\n\nOne of the suitors was a good-looking student, and he pumped the swineherd for an answer to the riddle. \n\n\n&quot;I guess she has two silver hairs beneath right armpit and a gold hair beneath her left armpit,&quot; replied the swineherd, so when the student presented himself, this is the answer that he gave. \n\n\n&quot;Not true!&quot; shouted the swineherd. &quot;She has a gold hair beneath her *right* armpit and two silver hairs beneath her *left* armpit.&quot; \n\n\n&quot;Hold your tongue, boy!&quot; said the king, who liked the good-looking student. &quot;Just what are you saying?&quot; \n\n\n&quot;What I say is true!&quot; said the swineherd, and it turned out that he was right. \n\n\nThe king then asked the student, &quot;Can you tell me on which arm the princess has a birthmark?&quot; \n\n\n&quot;Her right arm.&quot; \n\n\n&quot;Not true!&quot; shouted the swineherd. On her *left* arm is a red mark the size of a ducat. \n\n\nHer arm was examined, and everyone in the hall said, &quot;The boy is right.&quot; \n\n\nNonetheless, the king refused to accept the swineherd, and instead he set an additional task. That night each suitor would go to bed on either side of the princess, the one she was facing the next morning would be the winner. \n\n\nBefore bedtime the king gave a feast for the judges and some of the suitors. The student thought himself in seventh heaven, for he was sure that he would win the princess, and thus he drank until he was quite drunk. But the swineherd was not so foolish. Finally the three went to bed, and the bedroom door was locked behind them. The princess turned to face the student, for she favored him. \n\n\nNow before bedtime the swineherd had purchased a bag of prunes and raisins, and as he lay there he munched on them. \n\n\nIn the night the student became ill from his overeating and overdrinking. Needing to vomit, he tried to go outside, but the door was locked, so he had to puke in the corner. When he returned to bed the princess smelled his breath, and it was so foul that she turned toward the swineherd, whose breath smelled much better. They all slept until daybreak, and when the king looked in on them she was facing the swineherd. \n\n\nThus the case was settled. Nothing more could be said against the swineherd. \n\n\n&quot;Now that you have won the contest,&quot; said the king, &quot;tell us about your possessions.&quot; \n\n\nThe boy told him of the wallet and the golden box. These were his entire inheritance, and he had not opened them since leaving home. The king wanted to see them, and opening the wallet he saw photographs of the lad\&#39;s father and mother, and he recognized the father as his own twin brother. When their father had died they had battled each other over the kingdom. The loser had escaped into the woods and had become the leader of a band of robbers. Then they opened the golden box, and it contained a rich inheritance. The wallet was given to the king, for he had often thought about his brother and longed for him. Now he knew that he was still alive. \n\n\nOf course the lad should marry the princess, and their wedding was soon celebrated. He received half the kingdom at once, along with a dowry, and when the king died he received the second half as well.&#39;,
  &#39;title&#39;: &quot;The Princess&#39;s Birthmarks&quot;,
  &#39;subheading&#39;: &#39;Denmark&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (Internet Archive): Wilhelm Busch, &quot;Der Schweinejunge und die Prinzessin,&quot; *[Ut ôler Welt: Volksmärchen, Sagen, Volkslieder und Reime](https://archive.org/stream/utolerweltvolksm00buscuoft#page/n5/mode/2up)* (Munich: Lothar Joachim Verlag, 1910), [no. 39, pp. 104-106](https://archive.org/stream/utolerweltvolksm00buscuoft#page/104/mode/2up).\n- Source (books.google.com): Wilhelm Busch, &quot;Der Schweinejunge und die Prinzessin,&quot; *Aus alter Zeit: Volksmärchen und Sagen,* (Hamburg: mach-mir-ein-ebook.de, 2014), [not paginated](https://books.google.com/books?id=XjdbAwAAQBAJ&amp;lpg=PP1&amp;pg=PT208#v=onepage&amp;q&amp;f=false).\n- Translated by D. L. Ashliman. © 2016.&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Pig-Boy and the Princess\n----------------------------\n\n\n### Germany, Wilhelm Busch\n\n\nOnce there was a pig-boy who bought a flute and three colorful little piglets to amuse himself. With time and energy he taught the piglets to stand on two legs and dance very nicely to the tune of the flute. They could dance the gallop, waltzes, and -- in short -- all the popular dances of the land. Whenever he drove his herd out into the woods and camped there he would take out his flute and play a cheerful tune, and as soon as he blew into the flute the three piglets immediately began to dance, jumping around him so merrily that it was a welcome break from the loneliness of the forest. \nNow it happened that one day he drove the pigs near the royal princess\&#39;s summer palace. He lay down beneath an oak tree in the warm sunshine and had his piglets dance to his flute. The princess saw this from her window, and she thought that they were so cute and funny that at once she sent her maid down to the lad to ask him if he wouldn\&#39;t sell her one of the piglets. \n\n\n&quot;Greetings from the princess,&quot; said the maid to the lad. &quot;She would like to know if one of your lovely colorful piglets would be for sale. \n\n\n&quot;They\&#39;re not for sale,&quot; said the lad, &quot;but one can be earned. Just tell your princess that if I may sleep one night in the same bed with her chambermaid, I would be happy to give her one of my piglets.&quot; \n\n\nThe maid returned to the princess with this message, and the princess wanted one of the cute little piglets so badly that she let the lad have his way. \n\n\nAfter receiving the piglet she bought herself a flute to make it dance, but it would not dance. She played the most beautiful dance tunes that she knew, petted the animal, and stroked it, but it would not dance. \n\n\n&quot;Oh, dear,&quot; said the princess. &quot;The little animal won\&#39;t dance, because it doesn\&#39;t have a playmate. I\&#39;ll have to see if I cannot get one for him.&quot; \n\n\nShe was very sad that her little piglet would not dance. \n\n\nThe next day the lad was once again tending his animals near the castle. The princess sent to him a second time, asking if one of his two piglets were not for sale. \n\n\n&quot;Not for sale,&quot; said the lad once again. &quot;But it can be earned. If I may sleep a second night in the same bed with the princess\&#39;s chambermaid, then I\&#39;ll give the princess one of the piglets. Nothing else will do.&quot; \n\n\nThe princess, who wanted the piglet ever so badly, let the lad have his way. \n\n\nLater, after she had the second piglet, she brought the two together, took out her flute, and played many lovely tunes, but the piglets did not dance. Now she concluded that the problem was with the flute, so she waited impatiently until the lad came back to see if she could not get the third piglet as well as the flute from him. \n\n\nThe lad did indeed come back the next day. He lay down beneath the oak tree in the warm sunshine and had his piglet dance to his flute: the gallop, waltzes, and -- in short -- all the dances that were popular in the country. \n\n\nThe princess sent to him and asked if the third piglet, together with the flute, were for sale. \n\n\n&quot;Not for sale,&quot; said the lad once again. &quot;But they can be earned. If tonight I may sleep with the princess in her bed, then I will give her my piglet, together with the flute.&quot; \n\n\nWhen the princess heard this, it was a little too much for her, but she wanted the piglet and the flute so badly that she asked if it wouldn\&#39;t be all the same if he could sleep yet another night with the chambermaid in her bed. \n\n\n&quot;No!&quot; answered the lad. &quot;Only the princess will do. If she won\&#39;t agree, it\&#39;s all right with me. I\&#39;ll just keep my piglet and my flute.&quot; \n\n\nThus the princess saw that there was no other way. She had to let the lad do what he wanted to do. \n\n\nNow she had all three of the colorful little piglets together, and they danced ever so cheerfully to the sound of the flute: the gallop, waltzes, and -- in short -- all the dances that were popular in the country. This delighted the princes so much that she never grew tired of playing for the little animals. \n\n\nOn the other hand, now that the lad no longer had his piglets and his flutes, he was no longer happy in these parts, so he set forth into the wide world. \n\n\nNow it happened that soon afterward the king proclaimed far and wide that whoever would be able to guess what kind of birthmark the princess had on her body could have her as a wife, be he rich or poor, nobleman or commoner. However, anyone who attempted, but guessed wrong, would lose his head, and thus his life. \n\n\nWhen the pig-boy heard this news he immediately set forth toward home, thinking that he would be able to solve the riddle. Underway he met up with a priest who asked him where he had come from, where he was going, and what sort of business was taking him there. \n\n\n&quot;I am going to the king\&#39;s court,&quot; replied the lad, &quot;to see if I can\&#39;t guess the princess\&#39;s birthmark.&quot; \n\n\nThe priest said, &quot;Do you already know something about it, my son? Otherwise you\&#39;ll likely lose your head and thus your young life.&quot; \n\n\n&quot;I don\&#39;t know for sure,&quot; said the lad, &quot;but one thing is certain: The princess has three hairs on one side of her body.&quot; \n\n\nHearing this, the priest thought that now that he that knew the answer he would seek the prize for himself by getting ahead of the boy if at all possible. \n\n\n&quot;I am seeking the same goal as you are, my son,&quot; he said to the boy. &quot;If it\&#39;s all right with you, let\&#39;s walk on together.&quot; \n\n\nThe lad agreed, and together they made their way to the royal court. They announced themselves to the king, and as soon as he realized why they had come he sent for the executioner who made ready his bare sword. \n\n\n&quot;So!&quot; said the king. &quot;Let us begin. The priest can be first, and then the pig-boy. Reverend sir, what kind of birthmark does my daughter have on her body?&quot; \n\n\nThe cunning priest, happy that his turn came first, quickly spoke out: &quot;Three hairs on one side!&quot; \n\n\n&quot;Right!&quot; said the king, &quot;but, my dear sir, on which side? And how long are they? And how thick are they? And what do they look like?&quot; \n\n\nThe priest, not knowing what to say, just stood there with his mouth hanging open. \n\n\n&quot;Listen up, priest!&quot; said the king. &quot;Rightfully you would now be made shorter by one head, but because you guessed at least something right your life will be spared this time.&quot; \n\n\nThen he turned to the pig-boy and said, &quot;Now, my lad, it\&#39;s your turn to guess. What is the birthmark that my daughter has on her body?&quot; \n\n\n&quot;Three hairs on one side.&quot; \n\n\n&quot;Right, my son! But on which side?&quot; \n\n\n&quot;On her left side.&quot; \n\n\n&quot;Right! But how long are they? And how thick are they? And what do they look like?&quot; \n\n\n&quot;With all respect, your majesty, they are as long and as thick as knitting needles, and they are -- I think -- gold colored.&quot; \n\n\n&quot;Right, my son,&quot; cried the king. &quot;You have guessed correctly, and have rightfully won the princess.&quot; \n\n\nThus the priest had to go on his way shamefully, but the pig-boy married the beautiful princess.&#39;,
  &#39;title&#39;: &#39;The Pig-Boy and the Princess&#39;,
  &#39;subheading&#39;: &#39;Germany, Wilhelm Busch&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (books.google.com): Robert Eisel, &quot;Die Edelmannstochter und der Schafknecht,&quot; *[Sagenbuch des Voigtlandes](https://books.google.com/books?id=WX1TAAAAcAAJ&amp;pg=PP5#v=onepage&amp;q&amp;f=false)* (Gera: Verlag von C. B. Griesbach, 1871), [no. 561, pp. 215-16](https://books.google.com/books?id=WX1TAAAAcAAJ&amp;pg=PA215#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Robert Eisel, &quot;Die Edelmannstochter und der Schafknecht,&quot; *[Sagenbuch des Voigtlandes](https://archive.org/stream/sagenbuchdesvoi00eisegoog#page/n6/mode/2up)* (Gera: Verlag von C. B. Griesbach, 1871), [no. 561, pp. 215-16](https://archive.org/stream/sagenbuchdesvoi00eisegoog#page/n222/mode/2up).\n- Translated by D. L. Ashliman. © 2016.\n- The hare-herding episode is classified as a [type 570 folktale](type0570.html).&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &quot;The Nobleman&#39;s Daughter and the Shepherd\n----------------------------------------\n\n\n### Germany\n\n\nIn a village between Eisenberg and Naumburg there lived a nobleman&#39;s daughter. Nothing pleased her. One day she saw two dancing sows that a shepherd had obtained from a little gray man. To get one of these pigs -- for the dancing sows finally made her happy -- she had shown the shepherd her birthmark, namely a golden hair on her right breast. \nNow she declared that she would marry whatever man could guess her birthmark, then herd three hundred hares, and finally say something true that no one else knew about. \n\n\nOur shepherd already knew about her birthmark, so he volunteered to herd the three hundred hares. They were counted out to him, but he had scarcely gone into the open with them when they all scampered away from him. However, the little gray man gave him a flute, and when he blew into it every last one of the hares came running back to him. \n\n\nNow first the nobleman&#39;s daughter, then her mother, and finally her father -- all in disguise -- came to the shepherd to beg a hare from him. And each got one for a very high price, but when the shepherd blew into his flute the hares broke loose and ran back to him. \n\n\nThus only the third task remained. \n\n\nThe suitors were all invited to a gathering, but none of them, however noble they all were, was able to tell an unknown truth. \n\n\nFinally the shepherd rose from his seat in the back of the hall and began to relate what price he had received for the sale of the hares. This was all terribly embarrassing for the noble maiden and her parents, so they finally declared the shepherd the winner, and he married the nobleman&#39;s daughter.&quot;,
  &#39;title&#39;: &quot;The Nobleman&#39;s Daughter and the Shepherd&quot;,
  &#39;subheading&#39;: &#39;Germany&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (books.google.com): Wilibald von Schulenburg, &quot;Die drei goldenen Haare,&quot; *[Wendische Volkssagen und Gebräuche aus dem Spreewald](https://books.google.com/books?id=TOcBAAAAQAAJ&amp;pg=PR3#v=onepage&amp;q&amp;f=false)* (Leipzig: F. A. Brockhaus, 1880), [pp. 66-69](https://books.google.com/books?id=TOcBAAAAQAAJ&amp;pg=PA66#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Wilibald von Schulenburg, &quot;Die drei goldenen Haare,&quot; *[Wendische Volkssagen und Gebräuche aus dem Spreewald](https://archive.org/stream/wendischevolkss00schugoog#page/n7/mode/2up)* (Leipzig: F. A. Brockhaus, 1880), [pp. 66-69](https://archive.org/stream/wendischevolkss00schugoog#page/n107/mode/2up).\n- Translated by D. L. Ashliman. © 2016.&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;Three Golden Hairs\n------------------\n\n\n### Wendish\n\n\nIn former times there was a peasant in a village. At that time they grazed pigs in a common pasture. The peasant had a servant boy eleven or twelve years old who tended the pigs and piglets. \nOne day a ragman came to him with a wooden flute. \n\n\nThe one sow had six piglets, and the ragman said, &quot;I will trade this wooden flute to you for three of your six piglets. If you blow on the flute your piglets will dance to the tune.&quot; \n\n\nThe boy did not want to do this, fearing that his master, the peasant, would scold him and beat him. \n\n\nTo that the ragman said, &quot;You can tell your master that you\&#39;ll give up your wages for the piglets. It is possible that you\&#39;ll gain much more with the flute than your lost wages.&quot; \n\n\nWhen the boy returned home with the pigs the peasant asked him, &quot;Where are the three piglets?&quot; \n\n\n&quot;I traded them to the ragman for this flute. He said that the piglets will dance if I play the flute.&quot; \n\n\nThe peasant was about to beat the boy, but the latter told him to take the value of the missing piglets from his wages. \n\n\nEarly the next morning the boy let the sow and the three piglets out into the farmyard and began to blow on the flute. To the amazement of the peasant the piglets danced. Never in his lifetime had he heard of piglets that could dance. He was now satisfied with the situation. \n\n\nFrom then on the boy tended sows and piglets in the pasture, playing a little piece on the flute, to which the piglets danced. The people who came by saw the dancing piglets, and they became famous in the entire village and also in other villages as well. \n\n\nNow it happened that a young lady in the village heard about the dancing piglets. Early one morning she went out to the boy and asked to buy one of the piglets. The boy was not allowed to sell one without asking his master. \n\n\nThe peasant said, &quot;You can sell them if you get a good price.&quot; \n\n\nHappily the boy went back out to the pasture. \n\n\n&quot;The young lady asked, &quot;What will you take for one of the piglets?&quot; \n\n\n&quot;One hundred thalers, and then you\&#39;ll have to lift your skirts up to your knees.&quot; \n\n\nAt first she did not want to do this, but finally she did lift her skirts up to her knees. \n\n\n&quot;This boy knows a lot,&quot; she thought. \n\n\nThen the young lady took her piglet home with her and put it in the stall. The pig-girl was to keep watch over it and report when it began to dance. A whole day passed, but the piglet did not dance. \n\n\nThe young lady thought, &quot;If I had two of them, then they would dance for sure.&quot; \n\n\nSo she went to the boy and asked how much a second piglet would cost. \n\n\n&quot;Two hundred thalers, and lift your skirts up to your waist.&quot; \n\n\nShe did not want to do this, but the boy said, &quot;I\&#39;ll not sell the piglet for any other price.&quot; \n\n\nShe thought, &quot;This boy knows how to shame a girl,&quot; but she did what he asked, then gave him two hundred thalers, and took the piglet home with her. \n\n\nShe thought that the two piglets would dance, but they did not. \n\n\nOn the third day she went once again to the boy and said that it was not true, that the piglets could dance; but the boy said that they could indeed. So then she thought that if she had all three they would dance, and she asked how much the boy wanted for the third piglet. \n\n\nHe said, &quot;Three hundred thalers, and lift your skirt above your navel.&quot; \n\n\nShe did not want to do this, and thought about it for a long time, but finally she gave in. \n\n\nNow the young lady had an unusual mark: three golden hairs above her navel. \n\n\nWhen she returned home and had all three piglets together, she thought that they would dance. But they did not dance. So she sent a messenger to the boy, complaining that he had cheated her. The boy insisted, however, that they had danced for him. \n\n\nThen the peasant said, &quot;Send the wooden flute to the young lady. We received a good price for the piglets.&quot; \n\n\nSo the boy gave the flute to the messenger, and asked him to tell the young lady to play a while on it, and then the piglets would dance for sure. \n\n\nWhen the young lady blew on the flute the pigs danced, and she was very happy, for no one else had pigs like these. And she sent a generous tip to the boy. \n\n\nSome months later the young lady announced that she wanted to marry. She would give a feast and invite all the young gentlemen. She proclaimed that she would marry the one who could guess what her unusual mark was. \n\n\nOn the appointed day all the suitors sat around the table eating and drinking. \n\n\nThe boy had heard about this, and he sneaked into a corner. Beforehand he supplied himself with some peppermint drops, thinking that no one would offer him anything to eat. \n\n\nAfter dinner the guessing began, but no one could identify the young lady\&#39;s mark. A half-hour pause was declared to give everyone time to think. They continued with the guessing, but no one was right. And after a third round of guessing, still no one succeeded. \n\n\nFinally the boy shouted out, &quot;I know what the young lady\&#39;s mark is!&quot; \n\n\n&quot;Out with it! What is it?&quot; said everyone. \n\n\n&quot;She has three golden hairs above her navel.&quot; \n\n\nThen they asked the young lady if this was true. She had to admit that it was so, but she did not want to marry the boy instead of one of the young gentlemen. \n\n\nThen they had to decide how to settle the dispute. One said one thing; another said something else, and finally they decided to -------- \n\n\nNow I am not allowed to say what happened next, but in the end the boy did indeed get the young lady, and he became her gentleman.&#39;,
  &#39;title&#39;: &#39;Three Golden Hairs&#39;,
  &#39;subheading&#39;: &#39;Wendish&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (books.google.com): Friedrich S. Krauss, *[Sagen und Märchern der Südslaven: Zum großen Teil aus ungedruckten Quellen](https://books.google.com/books?id=Slvj1KzEavAC&amp;pg=PR3#v=onepage&amp;q&amp;f=false)*, vol. 2 (Leipzig: Verlag von Wilhelm Friedrich, 1884), [no. 131, pp. 302-306](https://books.google.com/books?id=Slvj1KzEavAC&amp;pg=PA302#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Friedrich S. Krauss, *[Sagen und Märchern der Südslaven: Zum großen Teil aus ungedruckten Quellen](https://archive.org/stream/sagenundmrchend00kraugoog#page/n6/mode/2up)*, vol. 2 (Leipzig: Verlag von Wilhelm Friedrich, 1884), [no. 131, pp. 302-306](https://archive.org/stream/sagenundmrchend00kraugoog#page/n374/mode/2up).\n- Translated by D. L. Ashliman. © 2016.&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Emperor\&#39;s Daughter and the Swineherd\n----------------------------------------\n\n\n### Slavic\n\n\nOnce upon a time there was an emperor who had a daughter with three birthmarks on her body: on her forehead one shaped like a star, on her bosom one shaped like the sun, and on her knee one shaped like the moon. \nWhen she reached the age of marriage she said to her father that she would marry only the man who could guess what her birthmarks were, be he the poorest man in the world, even a beggar. If he could guess her birthmarks, she would marry him. \n\n\nThis proclamation was made to the whole world, and many emperors and kings sought her hand, but none could guess what the birthmarks were. \n\n\nOne day she was walking with her maidens-in-waiting when they met a poor lad who was tending a sow with three suckling piglets. \n\n\nSeeing the cute piglets, she stepped aside from the other maidens and approached the swineherd, who was standing near the sow, and asked him, &quot;Would you give me one of the sow\&#39;s piglets?&quot; \n\n\n&quot;Yes, and as payment you will only have to loosen your veil so I can see your face.&quot; \n\n\nSuspecting nothing, the emperor\&#39;s daughter uncovered her face, and the swineherd saw the birthmark on her forehead. He then caught a piglet and handed it to her. She returned home happily, accompanied by the other maidens. \n\n\nWhen in the evening the swineherd drove the sow with two piglets home, his father accosted him with curse words: &quot;Where is the other piglet? Damn you!&quot; \n\n\nNot wanting to admit what had happened, he said that he had taken a nap and that the piglet had disappeared while he was asleep. \n\n\nMeanwhile the emperor\&#39;s daughter showed the piglet that she had won to her father and mother, and it was so cute that they both fell in love with it immediately. They told their daughter that it would be good if she could get another one, to which she answered that the swineherd had two more. \n\n\nThus the next day she again went out with her maidens-in-waiting, found the swineherd, and asked for another piglet. The lad agreed, on the condition that she would let him see her bosom. She immediately undid her bodice, and after he had seen the birthmark on her breast he gave her the second piglet. \n\n\nThe delighted princess hurried home with the piglet, and the swineherd returned to his home with the sow and only one piglet. His father scolded him even more severely than before. \n\n\nOn the third day the princess went out once again and asked the swineherd for the third piglet. He promised it to her if she would uncover her legs and let him see her knees. This she did, and after seeing the birthmark he gave her the third piglet. Then she returned to her home, and he to his; and his parents scolded him all the more severely. \n\n\nSome time later the lad asked his mother to bake a flatbread, roast a chicken, fill a bottle with wine, and prepare a bunch of basil for him. She did this, then put it all into a knapsack. \n\n\nHe threw the knapsack over his shoulders and went on his way, saying to his mother as he left, &quot;Mother, I\&#39;m going to the emperor\&#39;s daughter to guess her birthmarks. Perhaps I\&#39;ll be lucky, and with God\&#39;s help will guess them.&quot; \n\n\nHis mother replied, &quot;Oh, my child, we will never be so lucky!&quot; \n\n\nTo which he said, &quot;I have hope, if God is willing.&quot; \n\n\nThus he made his way to the emperor\&#39;s court, where a Turk had arrived, also wanting to guess the princess\&#39;s birthmarks. \n\n\nBoth were taken before the princess, and the Turk said to the swineherd, &quot;My friend, you speak first. I already know what I am going to say.&quot; \n\n\nWith this the lad began: &quot;Maiden, do you have a star on your forehead?&quot; \n\n\nThese words had barely escaped his lips when the Turk said, &quot;My goodness, we have the same thoughts!&quot; \n\n\nThe maiden took off her veil and said to the lad, &quot;You guessed right. Continue. What kind of birthmark do I have on my breast?&quot; \n\n\nThe youth answered: &quot;A sun.&quot; \n\n\nAnd the Turk interrupted, &quot;So help me, I was about to say the same thing.&quot; \n\n\nThe maiden uncovered her breast and said to the youth, &quot;You were right on that one as well. Now tell me, what do I have on my knee?&quot; \n\n\nThe youth: &quot;A moon.&quot; \n\n\nThe Turk: &quot;By my holy faith, what will we do now? I knew that as well.&quot; \n\n\nThus there was confusion as to who should get the maiden. She, of course preferred the Turk, who was a handsome, well-dressed young man, whereas the swineherd was standing there in tattered clothes. Finally it was decided that the two of them should spend the night with the maiden. Whoever she was facing the next morning would be the winner. That evening they all went to bed, and the maiden turned to face the Turk. Then the swineherd got up and went outside. \n\n\nThe princess said to the Turk, &quot;Follow him, and whatever he does, you should do as well.&quot; \n\n\nOnce outside, the swineherd squatted down in the dark, took the flatbread, the roasted chicken, and the wine out of his knapsack, then began to eat and drink. \n\n\nIn the darkness, the Turk thought that he saw the swineherd doing that which even the emperor has to get out his saddle to do, so he too squatted down and strained until he had relieved himself. \n\n\nMeanwhile the Turk noticed that the swineherd was eating something, and thinking that he was eating his own dung, the Turk began to eat what he himself had just left on the ground. After eating all he wanted, the swineherd rubbed the basil over his face. Thinking that the swineherd was rubbing filth on his face, the Turk did the same thing with rest of his own dung. \n\n\nWith this the two of them returned to the princess: one at her one side, the other at her other side. Once again the maiden turned to face the Turk, but unable to stand the stink of the dung, she immediately turned toward the swineherd, who smelled like basil. When they looked in on her in the morning she was still facing him. \n\n\nThe swineherd remained at court as the emperor\&#39;s son-in-law. He sent for his father and mother, and they all lived there happily until they died.&#39;,
  &#39;title&#39;: &quot;The Emperor&#39;s Daughter and the Swineherd&quot;,
  &#39;subheading&#39;: &#39;Slavic&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &quot;- Source (books.google.com): *[Serbian Folk-Lore](https://books.google.com/books?id=RxzaAAAAMAAJ&amp;pg=PR3#v=onepage&amp;q&amp;f=false)*, translated from the Serbian by Elodie L. Mijatovich, 2nd edition (Columbus Printing, Publishing, and Advertising Company, 1899), [pp. 165-79](https://books.google.com/books?id=RxzaAAAAMAAJ&amp;pg=PA165#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): *[Serbian Folk-Lore](https://archive.org/stream/serbianfolklore00mijaiala#page/n5/mode/2up)*, translated from the Serbian by Elodie L. Mijatovich, 2nd edition (Columbus Printing, Publishing, and Advertising Company, 1899), [pp. 165-79](https://archive.org/stream/serbianfolklore00mijaiala#page/164/mode/2up).\n- Editor&#39;s note: I have substantially shortened the episode describing the hero&#39;s miraculous healing of an entire kingdom.&quot;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Shepherd and the King\&#39;s Daughter\n------------------------------------\n\n\n### Serbia\n\n\nA long time ago there lived a poor woman, who possessed nothing in the world except one son and four lambs. The boy took the lambs out to graze every morning, and brought them home every night. One day it happened that the lambs were grazing in a field not far from the summer palace of the king, and the king\&#39;s daughter came out to the young shepherd and asked him to give her one of them. \nThe boy refused, saying, &quot;I cannot give you one, for my mother will scold me if I do, as we have nothing in the world except these four lambs.&quot; \n\n\nThe princess, however, had taken so great a fancy for a lamb that she would not be refused, and at last said, &quot;Only let me have this one and I will give you any price you like to ask.&quot; \n\n\nThe boy, seeing that the princess would not go away without a lamb, considered a little how he could get rid of her, and then he told her that he would give her one if she would show him one of her shoulders. To his great surprise the princess, without any hesitation, pushed her mantle aside and showed him her bare white arm, and he noticed that on the shoulder there was a mark like a star. He was obliged now to give her one of his lambs, and when he went home in the evening he told his mother that he had fallen asleep at noon, and that when he awoke, one of the lambs had vanished, and he could not find it anywhere. \n\n\nThen his mother scolded him very much, saying, &quot;I see you will bring me to the beggar\&#39;s staff with your carelessness! Tomorrow you must take these three lambs out to graze very early, and look well about for the lost one. And if you don\&#39;t find it you had better never let me set eyes on you again.&quot; \n\n\nAt dawn the next day the boy took the three lambs to graze in the same field, and sat down to consider how he could get back the lamb he had lost. \n\n\nAt noon, when no one was about, the king\&#39;s daughter came out of the palace and said to him, &quot;Young shepherd, give me another lamb, and ask what you please in return.&quot; \n\n\nBut the boy answered, &quot;No! I dare not give you another; I have suffered enough for the one I gave you yesterday! So please go and bring me my lamb back.&quot; \n\n\nThis the princess refused to do, and said, &quot;It is quite useless to speak of such a thing. But tell me, did you notice anything particular on my shoulder?&quot; \n\n\nThe youth answered, &quot;Yes, I saw a star!&quot; \n\n\n&quot;Ah!&quot; exclaimed the princess; &quot;for that you can never pay me enough, and yet you want your lamb back!&quot; \n\n\nSo they almost quarreled, for the king\&#39;s daughter persisted in begging him to give her another lamb, and the young shepherd insisted that she should bring him the first one back again. \n\n\nAt last, seeing there was no end to her begging, the boy said, &quot;Well! I will give you one if you uncover before me your other shoulder.&quot; \n\n\nThis the princess did instantly, and he noticed that she had the mark of a star on that arm also. In this way he lost a second lamb; and when the evening came he went home very sadly, feeling sure his mother would scold him. And so she did, far more than at the first time, calling him ill names and threatening to beat him. The boy was really sorry that he had given way to the princess\&#39;s pleas, but he could not help it now. \n\n\nNext day, again, the princess came to him and begged so hard and so long for a third lamb that he became impatient, and, thinking to shame her, said he would give her one if she showed him her neck. To his great surprise, however, the king\&#39;s daughter at once let her mantle fall, and he saw that she had the mark of a crescent on her throat. So the poor boy lost a third lamb, and hardly dared go home to his mother at night with the one lamb left them. \n\n\nIndeed the poor old woman was so angry at her son\&#39;s carelessness in losing one lamb after another whilst he slept -- for he did not dare to tell her the truth about the princess -- that she cursed him as &quot;a good-for-nothing who would bring her to beggary.&quot; \n\n\nNotwithstanding all his mother\&#39;s reproaches and threats the boy could not refuse the princess the next day when she came out to ask for the fourth lamb. \n\n\nHowever, he tried to get her to go away a long time, and not until quite tired out with her begging, did he exclaim, &quot;Well, I will give you the lamb if you will show me your breast!&quot; \n\n\nThen the princess pushed her robe aside, and the boy noticed that she had the mark of a sun on her bosom. In this way the young shepherd lost all the four lambs, and he lived a long time with his mother in great poverty. \n\n\nA long, long time afterwards the king sent out a proclamation that he intended to let his daughter marry, and would give her to that man who could tell him what particular birthmarks she had about her. \n\n\nThe young shepherd heard this proclamation, and when he went home in the evening he said to his mother, &quot;Mother, I intend to go to the king\&#39;s palace tomorrow, so get me my best linen ready.&quot; \n\n\n&quot;And what do you want in the king\&#39;s palace?&quot; asked the poor old woman wondering. \n\n\n&quot;I intend, God helping me, to marry the king\&#39;s daughter,&quot; replied the young man boldly. \n\n\n&quot;Oh! you had better give up that fancy,&quot; cried the mother. &quot;It will be better for you to go and work and gain a piaster than to go, like a fly without a head, dreaming about things that are as high as the sky above you.&quot; \n\n\nBut the young man would not be persuaded, and went the next day to the king\&#39;s palace. \n\n\nBefore going out of the hut, however, he said to his anxious old mother, &quot;Good-bye, mother.&quot; \n\n\nHe had not walked very far before a gipsy met him, and asked, &quot;Where are you going, my young man?&quot; \n\n\n&quot;I am going to the king\&#39;s palace,&quot; answered the youth, &quot;and I mean, God helping me, to marry the king\&#39;s daughter.&quot; \n\n\n&quot;But, my dear comrade,&quot; said the gipsy, keeping near him, &quot;how can you really expect that she will marry you, when you are so poor? Only a shepherd!&quot; \n\n\n&quot;Eh!&quot; returned the young man; &quot;but I know what birthmarks she has, and the king has sent out a proclamation that whoever guesses these shall have her for his wife.&quot; \n\n\n&quot;If it is so,&quot; rejoined the cunning gipsy, &quot;I myself will also go to the palace with you.&quot; \n\n\nThe young man was glad to have company on the road, and so he and the gipsy travelled on together until they came to the residence of the king. When they came to the palace they found a large number of people who had come to &quot;try their luck,&quot; and guess what birthmarks the princess had. But it was lost time, for every one of them, after going past the king and guessing &quot;by good luck&quot; at the marks of the princess, was obliged to go away, having lost his time and gained nothing. \n\n\nAt length the turn came for the young shepherd to pass before the king, and the gipsy kept close to him to hear what he would say. \n\n\nSo the youth stepped before the king and said, &quot;The princess has a star on each shoulder, and a crescent on the throat.&quot; \n\n\nAt this moment the gipsy shouted loudly, &quot;Look there! That is just what I was going to say!&quot; \n\n\n&quot;Be quiet!&quot; said the young shepherd; &quot;or, if you really know what other marks she has, speak out.&quot; \n\n\n&quot;No, no!&quot; cried the gipsy, &quot;Go on, go on! When *you* have done, *I* will speak what I know!&quot; \n\n\nThen the youth turned again to the king and continued, &quot;The princess has the mark of a sun on her bosom.&quot; \n\n\n&quot;That is exactly what I was going to say!&quot; cried the gipsy, coming up quickly; &quot;She has the mark of a sun on her breast.&quot; \n\n\nNow the king was exceeding surprised, and confessed to his counsellors that the young shepherd had really guessed the truth. But as neither the king nor the counsellors at all liked the idea of the princess marrying a poor shepherd, they consulted how they could get rid of him without giving the lie to the king\&#39;s proclamation. \n\n\nAt length it was decided that his majesty should say, &quot;As both the shepherd and the gipsy have guessed the princess\&#39;s birthmarks, I cannot justly decide which of them should marry her. But I will give to each of them seventy piasters, and they must both go and trade with this money for a year. At the end of the year, that one which brings back the most money shall have the princess for his wife.&quot; \n\n\nThe young shepherd and the gipsy, having received the money, went off in opposite directions to seek their fortunes. After having travelled about some time the shepherd stopped one night to rest in the hut of an old woman, who was even poorer than his own mother. \n\n\nAs he sat with the old woman in the hut that evening, the lad thought he might just as well ask her advice as to the best way to invest his capital of seventy piasters, so he said, &quot;I have seventy piasters to trade with, can you tell me some good way in which I may employ them profitably?&quot; \n\n\nThe old woman considered the matter for some time before she answered, and then said, &quot;Tomorrow is market day in the next city; go there yourself, and when a man brings a very poor cow for sale, go up and try to buy it. The cow will be of many different colors, but very thin and ill fed; but you must buy her at whatever price the man asks for her. When you have bought her, bring her here at once.&quot; \n\n\nThe young man agreed to follow the old woman\&#39;s counsel, and so next day he went to the city and really found there a man who had brought a poor, but variously colored, cow to sell. Many people wished to buy the cow, but the young man outbid them all, and at length offered all his seventy piasters for her. So he got the cow, and drove it to the hut where he had passed the night. \n\n\nWhen the old woman came out to see who was coming, he called out to her, &quot;Now, my old mother, I have bought the cow, and what shall we do with her? She has cost me all my capital!&quot; \n\n\nThe old woman answered at once, &quot;Kill the cow, my son, and cut it in pieces.&quot; \n\n\n&quot;But how will that bring me back my money with profit?&quot; asked the young shepherd, hesitating whether he should follow her advice or no. \n\n\n&quot;Don\&#39;t be afraid, my son, but do as I say,&quot; returned the old woman. \n\n\nAccordingly he did as she advised him, killed the cow and cut her into pieces. \n\n\nThis done, he asked again, &quot;And now, what shall I do?&quot; \n\n\nThe old woman said quietly, &quot;Well, now we will eat the meat, and the suet we will melt down and put into a pot to keep for some other occasion.&quot; \n\n\nThe shepherd did not at all like this proposal, for he could not see what return he could hope to get for such an investment of his capital. \n\n\nHowever, he thought within himself, &quot;Well, since I have been foolish enough to follow her counsel on the two former occasions, I may as well follow it also this third time.&quot; \n\n\nSo he remained with the old woman many days, until the last piece of meat had been eaten up. \n\n\nWhen, however, he thought over all that had happened, he grew very sad, and, seeing no sign of anything better, said one morning to the old woman reproachfully, &quot;Now you see by following your counsel I have spent all the king\&#39;s money, and am now a ruined man!&quot; \n\n\n&quot;Don\&#39;t be afraid, my son,&quot; said the old woman. &quot;You can now take that pot of suet with you and go to a certain country where all the people are suffering from a strange disease, and there you can sell for a good deal of money your suet, for it has the power to cure them.&quot; \n\n\nThe poor shepherd was very glad at hearing this, and next morning took the pot of suet on his shoulder and started on his journey. After he had travelled many, many days, he came to a strange-looking country, and, going a little farther, he discovered that the old woman had told the truth. All the citizens, from the poorest beggar to the king himself were suffering from a disease that no doctor had been able to cure. However, the shepherd\&#39;s suet performed miracles, and in short order the sufferers were again all healthy and vigorous. \n\n\nThe grateful king responded to the shepherd\&#39;s miracle with the promise, &quot;Only ask! I will give you whatever you wish, even if it be my throne!&quot; \n\n\n&quot;I thank your Majesty very humbly for offering me your throne, but I don\&#39;t want it,&quot; replied the shepherd; &quot;but if you will give me three ships full of gold and silver, and some good sailors to manage the ships, and some good soldiers and cannons to defend them against the pirates, I shall think myself more than repaid, and I will send you back the ships and cannons when the gold and silver are landed safely in my country.&quot; \n\n\nThen the king at once gave the necessary orders, and in a very few days his servants came to report to him that the ships were then filled with gold and silver, and that the cannons were ready loaded and posted for action, and all the sailors and soldiers prepared to fight if any sea-robber came in their way. Then the young shepherd took a courteous leave of the king, and of all those other people who were so thankful to him for having cured them of their illness. He now went on board one of the ships, very glad to go back to his own country, and the two other ships full of gold and silver followed the first one across the seas. \n\n\nAfter having sailed a long time the three ships reached at last the coast of the kingdom where the king was waiting, daily expecting the return of the gipsy and shepherd to claim his daughter. The shepherd let his ships lie quietly in the harbor one day, and then, noticing much tumult and disturbance in the city, went ashore to see what had happened. There he found a great crowd, and on asking some of the people what they were going to do, they told him that they were going to hang a gipsy who had come to the city with seventy piasters capital, and who had not only spent all his money in drinking and reveling, but had even got into debt for seventy other piasters which he was quite unable to pay, and that this was the reason they were about to hang him. \n\n\nIn a few moments the hangman appeared, leading the gipsy, who was no other than the very man who had tried to cheat the shepherd out of the princess. \n\n\nThe young shepherd recognized his rival at once, and, going near him, said, &quot;What is this, my old friend? Have you really come to this?&quot; \n\n\nThe instant the gipsy saw the shepherd he stopped and began to whine and wail, begging him to save him from the gibbet, and he would be his faithful servant all his life. \n\n\n&quot;As for the princess,&quot; he added cunningly, &quot;I have given her up a long time ago, and don\&#39;t care for anything if only my life is spared.&quot; \n\n\nThen the young shepherd was sorry for the poor trembling, whining wretch, and offered to pay the debt for the gipsy if the people would let him off. So they agreed to this, and the young man not only paid the seventy piasters the gipsy owed, but bought him besides a suit of good clothes as well as a carriage and a pair of fine horses. Then he left him and went back to his ships, and they sailed on slowly along the coast towards the king\&#39;s residence. Now when the gipsy had dressed himself out smartly in his fine new clothes, he got into his carriage and drove off quickly to the king\&#39;s palace. \n\n\nArrived there, he left his carriage and horses in the courtyard, and went at once to the presence of the king, whom he addressed thus: &quot;Your majesty knows it is not yet quite a year since you gave me seventy piasters to trade with, and see! I come back already handsomely dressed, and have a fine carriage with a pair of beautiful horses below in the yard. As for the young shepherd, I have heard that he has not only spent all your majesty\&#39;s money in rioting, but that he had also got in debt, for which he has been hung. So it is no use waiting for him! Let us keep my wedding at once!&quot; \n\n\nThe king did not fancy the gipsy for his son-in-law, and was thinking what he could say to put him off a little time, when, looking by chance through his window, he saw three strange-looking ships sailing slowly towards the shore. \n\n\nAt this he exclaimed, &quot;I see some foreign visitors are coming to visit me, and I shall have enough to do to receive them with due honors, so we must put off the marriage for some days, at least!&quot; \n\n\nBut the gipsy pressed the king more and more to let him marry the princess at once; he was even bold enough to tell his Majesty that he could not wait any longer, and that the wedding would be all over in an hour. The king, however, refused to hear anything of this; so the gipsy, seeing that his plan had failed, went out from the presence of the king in great anger. \n\n\nA few hours later the three strange-looking ships dropped their anchors just opposite the palace, and the young shepherd, landing, came into the presence of the king, who was greatly astonished to see him alive, and still more astonished to hear that in return for his seventy piasters he had brought three vessels full of gold and silver. \n\n\nThe king was now very well content to accept him as his son-in-law, and told him, in the course of conversation, what the gipsy had said about his having gone in debt and been hung. Then the young shepherd told his Majesty how he had found the gipsy, and had saved his life by paying his debt for him. The king was exceedingly angry, and ordered his servants to go after the gipsy and bring him at once into his presence. \n\n\nThe servants looked about and around the palace on all sides, but nowhere could they find any trace of the gipsy. Then the king commanded that some of them should go in search of him without delay, and armed men were speedily scattered over the whole country, so that at last he was caught, and brought before the king, who condemned him to be hung for having so shamefully tried to injure the man who had saved his life and treated him so generously, and for having, at the same time, attempted to cheat the king. \n\n\nThe young shepherd spent a few days in the palace, telling the king all the things he had seen abroad, and then, all preparations having been made, he was married to the princess, with great pomp and rejoicings. Then the king with his daughter and son-in-law lived for a great many years very happily.&#39;,
  &#39;title&#39;: &quot;The Shepherd and the King&#39;s Daughter&quot;,
  &#39;subheading&#39;: &#39;Serbia&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &quot;- Source (books.google.com): Louise Seymour Houghton *[The Russian Grandmother&#39;s Wonder Tales](https://books.google.com/books?id=tdpCAAAAIAAJ&amp;pg=PR3#v=onepage&amp;q&amp;f=false)* (New York: Charles Scribner&#39;s Sons, 1913), [pp. 253-59](https://books.google.com/books?id=tdpCAAAAIAAJ&amp;pg=PA253#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Louise Seymour Houghton *[The Russian Grandmother&#39;s Wonder Tales](https://archive.org/stream/russiangrandmoth00houg#page/n7/mode/2up)* (New York: Charles Scribner&#39;s Sons, 1906), [pp. 253-59](https://archive.org/stream/russiangrandmoth00houg#page/252/mode/2up).&quot;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Enchanted Lambs\n-------------------\n\n\n### Russia\n\n\nAn emperor once had an only daughter of surpassing beauty. In his pride he caused it to be sounded abroad through all the world that the youth who should guess the position of a certain mole on the maiden\&#39;s person should have her for his wife, and the half of his empire besides. But those who did not guess right should be transformed into lambs. \nThis wonderful news spread over the whole world, so that wooers by thousands came from all lands to sue for the princess\&#39;s hand. But all in vain. A countless number of them were changed into lambs. \n\n\nThe news came also to the ears of a youth who was as poor as a church mouse, but who was as sharp as a needle for all that. His desire to possess the beautiful maiden and half the empire grew so strong that he decided to try his fortune; not, however, by suing at once for the maiden\&#39;s hand, but by seeing her first and asking her something. \n\n\nArrived at the emperor\&#39;s court, what wonders does he see! Lambs of all kinds pressed around him. God only knows how many there were. \n\n\nThey swarmed about him, a pitiful sight and a warning example that might well turn him from his project. \n\n\nHe would have gone back, but at the gate was a monster of a man, wrapped in a blood-red mantle, with wings, and an eye in the middle of his forehead, who cried out in a commanding voice, &quot;Halt! Where are you going? Go back, or you are lost!&quot; \n\n\nSo he went back and caused himself to be announced to the emperor\&#39;s daughter, who was already waiting for him. \n\n\nShe said to him, &quot;Did you come to get me for your wife?&quot; \n\n\nHe answered, &quot;No, Imperial Highness; but as I understood that you were thinking of marrying at the first favorable opportunity, I come to ask you if you need more bridal clothes.&quot; \n\n\n&quot;What kind of clothes have you to offer?&quot; she asked. \n\n\nHe answered, &quot;I have a skirt of marble, a bodice of dew, a head-dress of threads made from the sun\&#39;s rays, with a clasp of the moon and stars; then I have shoes of pure gold which were neither sewed nor made by a smith. So, tell me, do you wish to buy these things or not? You have but to command, and I will bring them to you, but only on one condition. When you try these things on, piece by piece, there shall be no one present but only us two. If they fit we shall soon come to terms; if not, I will never offer them to another soul, but will lay them aside and keep them for my own bride.&quot; \n\n\nThe princess agreed to this condition and gave him the order to bring the garments. And, really, he brought them to her. God only knows where he found them and how he came to possess them; it is enough for us to know that he kept his word. \n\n\nThey shut themselves up in a room, and first she tried on the skirt, while he watched narrowly to see if by chance he could discover the mole. To his joy he saw it under her right knee -- a little golden star; but not the slightest change in his face betrayed his discovery. \n\n\nHe only thought in his heart, &quot;It is well for me today and for all time!&quot; \n\n\nThen the princess tried on the bodice and all the other things, and they fitted her as if she had been poured into them. They agreed as to the price; she paid it on the spot; he packed up his gold and departed. \n\n\nAfter a few days, having dressed himself in the finest suit that could be bought for money, he came back to sue for the hand of the emperor\&#39;s daughter. \n\n\nWhen he appeared before the emperor he said, &quot;Worthy emperor, I come to woo your daughter. Make no objections; give her to me!&quot; \n\n\n&quot;Good!&quot; answered the emperor; &quot;but do you know how my daughter\&#39;s hand is won? Take good care, for if you do not guess the mole you are lost; but if you do guess it she will be yours, and the half of my empire into the bargain.&quot; \n\n\nThe youth bowed to the emperor and said, &quot;My greetings, O emperor and father-in-law! If that is the case she is mine. She has a little star under the right knee.&quot; \n\n\nThe emperor was not a little surprised that he could know this, but there was nothing for it but to yield, and so the youth was married to the princess. \n\n\nWhen the emperor proceeded to give him the half of his empire the new-made son-in-law said to him, &quot;I willingly leave this half of your empire to you if you are ready to restore these poor souls to their former condition.&quot; \n\n\nThe emperor answered that this was no longer in his power, but lay in the hands of his daughter, &quot;who now,&quot; he added, is your wife.&quot; \n\n\nSo he turned to his wife with this request, and she answered: &quot;Cut the vein under the famous mole. Let every lamb touch the end of its tongue to the blood and moisten its underlip with it, and they will all be changed to men and live as before.&quot; \n\n\nHe did as she directed, and when the lambs had all assumed the forms of men again they were invited as wedding guests. Thus the youth took the maiden home amid song and chime of bells, and there he treated everybody royally to meat and drink, until finally they took their homeward way. But he stayed there with his young wife, and God knows what fortunes they met with in life that are all forgotten now. \n\n\n\n\n\n&gt;  \n&gt; &quot;I am sorry you have forgotten anything, grandmother,&quot; said the little boy. &quot;It is not dark yet, and I wanted a longer story.&quot; \n&gt; \n&gt; \n&gt; &quot;It is not I who forgot,&quot; answered the grandmother. &quot;I remember every word as it was told to me.&quot; \n&gt; \n&gt; \n&gt; &quot;It must have been your great-grandmother,&quot; observed the little boy. &quot; I wish she had had a better memory.&quot; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt;&#39;,
  &#39;title&#39;: &#39;The Enchanted Lambs&#39;,
  &#39;subheading&#39;: &#39;Russia&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (books.google.com): Henry Jones and Lewis L. Kropf, *[The Folk-Tales of the Magyars: Collected by Kriza, Erdélyi, Pap, and Others](https://books.google.com/books?id=1nQAAAAAMAAJ&amp;pg=PR1#v=onepage&amp;q&amp;f=false)* (London: Published for the Folk-Lore Society by Elliot Stock, 1889), [no. 27, pp. 137-41](https://books.google.com/books?id=1nQAAAAAMAAJ&amp;pg=PA137#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Henry Jones and Lewis L. Kropf, *[The Folk-Tales of the Magyars: Collected by Kriza, Erdélyi, Pap, and Others](https://archive.org/stream/folktalesmagyar01papgoog#page/n4/mode/2up)* (London: Published for the Folk-Lore Society by Elliot Stock, 1889), [no. 27, pp. 137-41](https://archive.org/stream/folktalesmagyar01papgoog#page/n212/mode/2up).&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Youngest Prince and the Youngest Princess\n---------------------------------------------\n\n\n### Hungary\n\n\nThere was once, I don\&#39;t know where, an old petticoat a hundred years old, and in this petticoat a tuck, in which I found the following story. \nThere was once a king who had seven sons and seven daughters. He was in great trouble where to find princesses of royal blood as wives for his sons and princes as husbands for his daughters. At last the idea struck him that the seven sons should marry the seven daughters. They all consented to their father\&#39;s wish with the exception of the youngest son and daughter. \n\n\n&quot;Well, if you won\&#39;t,&quot; said the father, &quot;I will give you your inheritance and you can go and try your fortune, and get married as best you can.&quot; \n\n\nThe two children went, and came to a strange land, where they were overtaken by darkness in a wood. They chose a bushy tree for their resting place, whose leafy boughs bent down to the ground and afforded shelter. When they woke next morning, the girl told her brother that she had dreamt that there was a town not far off, where a king lived who had been ill for a long time, and thousands upon thousands of doctors had failed to cure him. He again dreamt that an old man with snow-white hair told him that the tree under which they slept gave water. In this water the king was to be bathed, and he would be cured. \n\n\nThey at once examined the tree, and from a crack in the bark sap as clear as crystal was dripping; they filled their flasks with the fluid and continued their journey. When they reached the outskirts of the forest, they saw a town in front of them. \n\n\nHaving arrived there they went into an inn to find out whether their dream was true, and asked the host what the news was in the town; he, in his conversation, mentioned the illness of the king, and the many unsuccessful attempts of men to cure him, and that he had strict orders, under a heavy penalty, to report at once every doctor that came to his inn. \n\n\n&quot;I also am a doctor,&quot; said the prince, &quot;and this youth is my assistant,&quot; he continued, pointing to his sister, who was dressed in male attire. \n\n\nThe innkeeper at once reported them, and they went to court to try their remedy on the king. The king\&#39;s body was covered with sores, and the doctor bathed his hand with the juice of the tree. To his great joy, the king discovered next morning that the place which had been bathed was visibly improving; he therefore, the very same night, sent a huge wooden vessel on a cart to the tree, to bring him sufficient water for a bath. \n\n\nAfter a few baths the king actually recovered; and the doctor, having received a handsome present, requested a favor of the king, viz., to pay him a visit and to do him the honor of dining with him. The king cordially granted the request, and the prince received him with great splendor in his spacious apartments, which were decorated with a lavishness becoming a sovereign. As the king found the doctor alone, he inquired after his assistant, and at this moment a charming pretty girl stepped from one of the side rooms, whom the king at once recognized as the doctor\&#39;s assistant. \n\n\nThe strangers now related to him their story, and the king became more affable, especially towards the pretty assistant, who at once gained possession of his heart and soul, and the short acquaintance ended with a wedding. \n\n\nThe prince, not forgetting the object of his journey, started soon after the wedding festivities were over. He passed on till he came to the boundary of the king\&#39;s realm, and then went on as far as the capital of the next country. \n\n\nHe was riding about the streets on a fine horse, when he heard a voice coming from a window close by, &quot;Hum, you, too, won\&#39;t get on without me,&quot; and looking in the direction from which the voice came, he discovered an old man looking out of the window. \n\n\nHe didn\&#39;t take any notice of the voice, but went on; and, having arrived at an inn, made sundry inquiries, when he was told that adventurous young men in this town might either meet with great fortune or with a great misfortune; because the king had a daughter whom no one had as yet seen, with the exception of her old nurse. The girl had three marks on her, and whoever found out what they were, and where they were, would become her husband; but whosoever undertook the task and failed, would be impaled, and that already ninety-nine young fellows had died in this manner. \n\n\nUpon hearing this, it became clear to the prince what the meaning of the old man\&#39;s saying was; he thought, that no doubt the old man took him for another adventurer, and the thought struck him that the old man must be acquainted with the secret, and that it would be advantageous to make his acquaintance. He found a plea at once; the old man was a goldsmith, and, as the prince had lost the rowel of his golden spur on the road, he called on him, and, having come to terms about the spur, the prince inquired of him about the princess, and the old man\&#39;s tale tallied with that of the innkeeper. \n\n\nAfter a short reflection, the prince told the old man who he was, and, with a look full of meaning, inquired if the goldsmith could help him in case he tried his luck. \n\n\n&quot;For a good sum with pleasure,&quot; replied the goldsmith. \n\n\n&quot;You shall have it,&quot; said the prince; &quot;but tell me how, and I will give you this purse on account.&quot; \n\n\nThe old man, seeing that there was good opportunity for gain, said, &quot;I will construct a silver horse in which you can conceal yourself, and I will expose it for sale in the market. I am almost sure that no one will buy it but someone attached to the royal court, and if once you get in there, you can get out of the horse by a secret opening and go back whenever you like and, I think, you will succeed.&quot; \n\n\nAnd so it happened; on the following market day a splendid silver horse was exhibited in the vicinity of the royal palace. There were a good many admirers, but on account of the great price there was no buyer, till at last a person belonging to the royal court enquired the price; after a few moments he returned and bought the horse for the king, who presented it to his daughter, and thus the prince managed to get into the chamber of the princess, which was the most difficult of all things, and he listened amidst fear and joy to the silvery voice of the pretty girl, who amused herself with the horse -- which ran on wheels -- and called it her dear pet. \n\n\nEvening drew on, and the mysterious girl went to rest; everything became quiet, and only her old nurse was sitting up not far from her bed; but about midnight she, too, fell asleep. Hearing that she was fast asleep, the prince got out of the horse and approached the girl\&#39;s bed, holding his breath, and found the mark of the sun shining on the girl\&#39;s forehead, the moon on the right breast, and three stars on the left. \n\n\nHaving found out the three secret marks, the prince was about to retire to his hiding place when the princess woke. She tried to scream, but at an imploring gesture of the youth she kept silence. The girl could not take her eyes off the handsome prince, who related to her how and for what reason he had dared to come. \n\n\nThe girl, being tired of her long seclusion, consented to his scheme, and they secretly plotted how the prince should get out of the palace; whereupon he went back to his hiding place. In accord with the plot, next morning the girl broke one of the horse\&#39;s ears off, and it was sent back to the goldsmith\&#39;s to be repaired, and the prince was thus able to leave his dangerous position. \n\n\nHaving again splendidly remunerated the goldsmith, he returned to his new brother-in-law, so that he might come back with a splendid suite and royal pomp, and appear as a king to try his fortune. The prince returned with many magnificently clad knights and splendid horses, and reported himself to the king, and informed him by message that he was anxious to try his luck for the possession of his daughter. \n\n\nThe king was very much pleased with the appearance of the youth, and therefore kindly admonished him not to risk his life, but the prince seemed quite confident, and insisted on carrying out his wishes; so a day was fixed for carrying out the task. The people streamed out to the place where the trial was to take place, like as to a huge festival. And all pitied the handsome youth, and had sad misgivings as to his fate. \n\n\nThe king granted three days to those who tried their fortune, and three guesses. On the first and second day, in order not to betray the plot, and in order to increase the éclat the prince guessed wrongly on purpose; but on the third day, when everyone was convinced that he must die, he disclosed in a loud voice the secret marks of the princess. \n\n\nThe king declared them to be right, and the prince was led to his future wife, amidst the cheers of the multitude and the joyous strains of the band. The king ordered immense wedding festivities all over the town, and resigned his throne in favor of his son-in-law, who reigned happy for many years after!&#39;,
  &#39;title&#39;: &#39;The Youngest Prince and the Youngest Princess&#39;,
  &#39;subheading&#39;: &#39;Hungary&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (Internet Archive): Franz Miklosich, &quot;Die Nebenbuhler,&quot; *Märchen und Lieder der Zigeuner der Bukowina*, [no. 7, pp. 29-30](https://archive.org/stream/berdiemundarten00miklgoog#page/n232/mode/2up). This is part 4 of *[Über die Mundarten und die Wanderungen der Zigeuner Europa\&#39;s](https://archive.org/stream/berdiemundarten00miklgoog#page/n202/mode/2up%20)* (Vienna: Karl Gerold\&#39;s Sohn, 1874).\n- The text is in Bukovina Romani dialect with an interlinear Latin translation. Bukovina is a historical region located in present-day Romania and Ukraine.\n- Summarized by D. L. Ashliman, © 2016.&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Rivals\n----------\n\n\n### Bukovina\n\n\nOnce there was an emperor\&#39;s daughter who had a moon-shaped mark on her forehead, a moon-shaped mark on her breast, and one on her back shaped like the stars. The emperor proclaimed throughout the kingdom that whatever man could describe these marks could take her in marriage. \nNow another emperor\&#39;s son was her lover, and he knew the marks. \n\n\nAt the same time there was a swineherd who tended a sow with twelve golden piglets in the forest. The princess saw the piglets and asked the lad to sell one of them to her. \n\n\n&quot;They are not for sale,&quot; he replied, &quot;but if you will lift your skirts to your knees, I will give one of them to you.&quot; \n\n\nShe looked around, making sure that no one else could see, then lifted her skirts to her knees. The lad gave her a piglet. \n\n\nThe emperor was delighted with the little animal, for never before had he seen a golden piglet. \n\n\nThe next morning the princess went into the woods again, wanting to buy another piglet. \n\n\n&quot;They are not for sale,&quot; said the swineherd, but if you will lift your skirts to your waist, I will give one of them to you.&quot; \n\n\nShe did what he wanted, and took the second piglet back to the castle. The emperor was even happier with the new piglet than before. \n\n\nThe third morning the princess returned to the woods, but the swineherd would not sell her a another piglet. \n\n\n&quot;But,&quot; he said, &quot;if you will take off your shift and turn around in front of me three times, I will give you another piglet.&quot; \n\n\nThe princess did what he wanted, and the swineherd was able to see the sun on her forehead, the moon on her breast, and the stars on her back. \n\n\nThe princess returned to the castle with her prize, and the emperor rejoiced with the new golden piglet. \n\n\nHe now set the time for the great contest to guess his daughter\&#39;s birthmarks. One of the suitors was another emperor\&#39;s son. This prince was her lover, and he knew the marks. In the end, both the swineherd and the prince identified the marks. To settle the matter, the ministers declared that for one night the two rivals and the princess should all three sleep together in one bed. Whoever the princess was embracing the following morning would win her hand in marriage. \n\n\nThe swineherd hid a snack in his nightshirt: bread, fruit, and sweets. In the night he began to eat the sweets, and the princess said, &quot;I\&#39;m hungry, what are you eating?&quot; \n\n\n&quot;I\&#39;m eating my lips.&quot; \n\n\n&quot;Give me some.&quot; \n\n\nSo he gave here some of his sweets, which she ate, saying, &quot;Oh, they are sweet!&quot; \n\n\nThe prince heard this and replied, &quot;Mine are still sweeter,&quot; upon which he took out a knife, cut off his own lips, and handed them to the princess. She threw them onto the floor. \n\n\nNext the swineherd gave the princess some fruit, claiming that it was his nose. \n\n\n&quot;Oh, how sweet!&quot; said the princess. \n\n\n&quot;Mine is still sweeter,&quot; replied the emperor\&#39;s son, then cut off his own nose and handed it to the princess. Immediately she threw it onto the floor. \n\n\nFinally the swineherd gave the princess some bread, saying that it was his ears. \n\n\nAs before the prince cut off his own ears and handed them to the princess, who threw them onto the floor. \n\n\nThe prince bled to death, and the princess pushed him out of the bed onto the floor, then took the swineherd into her arms. \n\n\nThe next morning the swineherd and the princess were found embracing one another. They dressed the swineherd in clothes befitting an emperor, then he and the princess were joined together in marriage.&#39;,
  &#39;title&#39;: &#39;The Rivals&#39;,
  &#39;subheading&#39;: &#39;Bukovina&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (books.google.com): Ludwig Bechstein, &quot;Die Perlenkönigin *[Deutsches Märchenbuch](https://books.google.com/books?id=O0I_AAAAcAAJ&amp;pg=PR1#v=onepage&amp;q&amp;f=false)* (Leipzig: Georg Wigand\&#39;s Verlag, 1846), [pp. 202-205](http://books.google.com/books?id=O0I_AAAAcAAJ&amp;pg=PA202#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Ludwig Bechstein, &quot;Die Perlenkönigin *[Deutsches Märchenbuch](https://archive.org/stream/bub_gb_j9kDAAAAQAAJ#page/n5/mode/2up)* (Leipzig: Verlag von Georg Wigand, 1847), [pp. 194-97](https://archive.org/stream/bub_gb_j9kDAAAAQAAJ#page/n205/mode/2up).\n- Bechstein\&#39;s source, as stated in the above editions: &quot;Oral, from Franken.&quot; Walter Scherf gives Wilhelmine Mylius as Bechstein\&#39;s immediate source. -- Ludwig Bechstein, *Sämtliche Märchen* (Darmstadt: Wissenschaftliche Buchgesellschaft, 1983), p. 837.\n- Translated by D. L. Ashliman. © 2016.&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Pearl Queen\n---------------\n\n\n### Germany, Ludwig Bechstein\n\n\nAt certain times every year an unearthly beautiful maiden was seen on the seashore not far from a peaceful village inhabited mostly by fishing people. She came in a beautiful little ship which appeared to have been constructed from pure brightly colored pearls. No one knew where she came from or where she went when she disappeared. \nThe good fishing people were very fond of her, especially the children, because at every visit she would scatter a quantity of pearls onto the bank, and then motion to them that they should gather them up. The little ones busied themselves gathering up the pearls, delighted at their glistening colors. Then the fishing people -- men and women -- brought the pearl queen a something to eat: fish, bread, and good wine. The lovely maiden was friendly toward them all, ate a few bites and drank a little wine. \n\n\nWhen the beautiful stranger was expected to come ashore, princes and noblemen from foreign lands would often arrive, hoping to see the beautiful maiden, and perhaps to gain her hand in marriage, for it was said far and wide that she possessed earthly wealth equal to her physical beauty. However, they all left disappointed. The noble maiden demanded from each suitor that he fulfill three tasks that she gave him. Until now these tasks had been too difficult. No one had been able to fulfill them, so all the noble suitors had had to depart saddened and ashamed. \n\n\nThe maiden\&#39;s first task was to guess what color her hair was, for she always kept her head fully covered with a thick shawl. No one had guessed correctly, although they had named all the colors: black, red, blond, brown, white, green, gray, and blue. \n\n\nThe second task was to put the maiden\&#39;s necklace around one\&#39;s own neck. If the glistening peals then turned cloudy it was an evil sign, causing the maiden to weep. Her tears turned to bright pearls and affixed themselves to the necklace. When she put the necklace back around her own neck the pearls again glistened brilliantly and marvelously. \n\n\nThe third task was to guess what the maiden wore next to her breast. No one was able to guess. Thus no one gained the maiden\&#39;s favor, nor her hand in marriage, even if he were the wealthiest prince. \n\n\nShe remained a mystery. All attempts failed to discover more about her and her homeland. When her little ship of pearls left shore it quickly disappeared from sight. However, at certain times she appeared again, was as friendly and lovely as before, and scattered pearls on the bank. \n\n\nA little boy was there whom she favored more than all the other children. She would take him into her arms and squeeze him warmly. The boy loved the beautiful, gracious lady as well. However, when he grew older he became shy and bashful, no longer daring to gather the pearls. In any event, he was mostly at sea fishing with his father. \n\n\nThe maiden had gone ashore several times without seeing her dear fisher-boy. This saddened her, for in her heart she had chosen this handsome youth, hoping that one day he would be able to solve the three tasks, and then follow her to the beautiful Isle of Pearls, her homeland. \n\n\nWhen she again came ashore without seeing her beloved fisher-lad, after casting off from land she resolved to return that same evening and to invisibly approach him. After the golden moon had risen, mirroring itself in the water, the little ship of pearls landed again on the familiar shore. Her beloved was now sound asleep in his little hut. The lovely maiden stepped into his little room and bent silently over the sleeping lad, who had only moss for a mattress. \n\n\nShe took off her necklace and hung it around the lad\&#39;s neck. When the pearls remained as bright and clear as before, great joy streamed through her loving heart! She gently kissed her beloved and left. She returned every evening, each time hanging the pearls around the lad\&#39;s neck, and they always remained bright and glistening. \n\n\nThe lad was also in love with the beautiful pearl queen, but was too shy and modest to openly approach her. \n\n\nOne night while she was at the youth\&#39;s bedside he awoke, but remained still, so she thought that he was asleep. Again she took the string of pearls from her neck, hung it around his neck, then wept warm tears onto his cheeks. Taking the shawl from her head, she used it to wipe away the tears. The youth saw that her hair was *golden*. Then she pulled aside her breast-cloth, and he saw a glistening mirror on her breast that softly and beautifully reflected his own image. \n\n\nUpon leaving she became sad, for she knew that if the string of pearls became cloudy even a single time on her beloved\&#39;s neck, that she would never again be able to approach him. \n\n\nThe time came when the beautiful pearl queen again came ashore near the fishing village. In her customary manner she scattered pearls for the happy children. This time many princes and noblemen had arrived in order to court the wealthy and beautiful princess. The fisher-lad was there as well, standing at the rear. He gathered courage and approached the suitors. His turn came at last, after all the others had failed and shamefully stepped aside. \n\n\nHe modestly advanced and asked for the three tasks. Glowing with pleasure the maiden gave them to him, then cast a secret and pleading glance toward heaven, praying that her beloved youth would be able to solve them. \n\n\nThe handsome fisher-lad bowed respectfully before the lovely maiden and said: &quot;Oh, your hair must be golden.&quot; In that instant the shawl fell from her head, and her golden locks flowed down. \n\n\nThen the happy maiden hung the string of pearls around the youth\&#39;s neck, and they remained pure and glistening. \n\n\nThe fisher-lad spoke again: &quot;And your breast must be a clear, beautiful mirror, noble maiden!&quot; \n\n\nAnd that instant her breast-cloth fell to the ground, revealing the clear mirror on the maiden\&#39;s breast. The mirror reflected a beautiful, gentle image: that of the youth. \n\n\nA jubilant cheer and joyful music sounded forth from the ship of pearls, and a circle of beautiful women and radiant men came forth from the ship. They led the blessed couple back aboard, and the ship glided away to the magical Isle of Pearls, now the homeland of the lovely bride and the fisher lad. And they never, never returned.&#39;,
  &#39;title&#39;: &#39;The Pearl Queen&#39;,
  &#39;subheading&#39;: &#39;Germany, Ludwig Bechstein&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;- Source (books.google.com): Hans Christian Andersen *[Fairy Tales from Hans Christian Andersen](https://books.google.com/books?id=bOQ3IsWHXJEC&amp;pg=PP11#v=onepage&amp;q&amp;f=false)*, third edition (London: J. M. Dent and Company; New York: E. P. Dutton and Company, 1907), [pp. 355-60](http://books.google.com/books?id=bOQ3IsWHXJEC&amp;pg=PA355#v=onepage&amp;q&amp;f=false).\n- Source (Internet Archive): Hans Christian Andersen *[Fairy Tales from Hans Christian Andersen](https://archive.org/stream/fairytalesfromh00andegoog#page/n6/mode/2up)*, third edition (London: J. M. Dent and Company; New York: E. P. Dutton and Company, 1907), [pp. 355-60](https://archive.org/stream/fairytalesfromh00andegoog#page/n370/mode/2up).\n- Translation revised by D. L. Ashliman. © 2016.\n- Link to the text in Danish: [Svinedrengen (1842)](http://wayback-01.kb.dk/wayback/20101103140739/http://www2.kb.dk/elib/lit/dan/andersen/eventyr.dsl/hcaev018.htm).\n- Note by Andersen concerning his source for this story: \n\n&gt; \n&gt; &quot;The Swineherd&quot; has a few traits in common with an old Danish folktale that I heard as a child. It was, however, too indecent to be repeated. ([H. C. Andersens *Samlede Skrifter*, vol. 15 [Copenhagen: C. A. Reitzels Forlag, 1880], p. 299)](https://books.google.com/books?id=724OAAAAYAAJ&amp;pg=PA299#v=onepage&amp;q&amp;f=false). \n&gt;&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;The Swineherd\n-------------\n\n\n### Hans Christian Andersen\n\n\nThere was once a poor prince; he had only a tiny kingdom, but it was big enough to allow him to marry, and he was bent upon marrying. \nNow, it certainly was rather bold of him to say to the emperor\&#39;s daughter, &quot;Will you have me?&quot; He did, however, venture to say so, for his name was known far and wide; and there were hundreds of princesses who would have said &quot;Yes,&quot; and &quot;Thank you, kindly,&quot; but see if she would! \n\n\nJust let us hear about it. \n\n\nA rose tree grew on the grave of the prince\&#39;s father, it was such a beautiful rose tree. It only bloomed every fifth year, and then only bore one blossom; but what a rose that was! By merely smelling it one forgot all one\&#39;s cares and sorrows. \n\n\nHe also had a nightingale which sang as if every lovely melody in the world dwelt in its little throat. This rose and this nightingale were to be given to the princess, so they were put into great silver caskets and sent to her. \n\n\nThe emperor had them carried before him into the great hall where the princess was playing house with her ladies-in-waiting. They had nothing else to do. When she saw the caskets with the gifts she clapped her hands with delight! \n\n\n&quot;If only it were a little kitten!&quot; said she, -- but there was the lovely rose. \n\n\n&quot;Oh, how exquisitely it is made!&quot; said all the ladies-in-waiting. \n\n\n&quot;It is more than beautiful,&quot; said the emperor. &quot;It is nice.&quot; \n\n\nBut the princess touched it, and then she was ready to cry. &quot;Fie, papa!&quot; she said. &quot;It is not artificial. It is a real one!&quot; \n\n\n&quot;Fie!&quot; said all the ladies-in-waiting. &quot;It is a real one!&quot; \n\n\n&quot;Well, let us see what there is in the other casket, before we get angry,&quot; said the emperor, and out came the nightingale. It sang so beautifully that at first no one could find anything to say against it. \n\n\n&quot;*Superbe! Charmant!*&quot; said the ladies-in-waiting, for they all spoke French, each one worse than the others. \n\n\n&quot;How that bird reminds me of our late empress\&#39;s musical box,&quot; said an old courtier. &quot; Ah, yes, they are the same tunes, and the same beautiful performance.&quot; \n\n\n&quot;So they are,&quot; said the emperor, and he cried like a little child. \n\n\n&quot;I should hardly think it could be a real one,&quot; said the princess. \n\n\n&quot;Yes, it is a real one,&quot; said those who had brought it. \n\n\n&quot;Oh, let that bird fly away then,&quot; said the princess, and she would not hear of allowing the prince to come. \n\n\nBut the prince was not to be crushed. He stained his face brown and black, and, pressing his cap over his eyes, he knocked at the door. \n\n\n&quot;Good morning, emperor,&quot; said he; &quot;can I be taken into service in the palace?&quot; \n\n\n&quot;Well, there are so many wishing to do that,&quot; said the emperor; &quot;but let me see! -- Yes, I need somebody to look after the pigs, for we have so many of them.&quot; \n\n\nSo the prince was made imperial swineherd. A horrid little room was given him near the pig-sties, and here he had to live. He sat busily at work all day, and by the evening he had made a beautiful little cooking pot. It had bells all round it and when the pot boiled they tinkled delightfully and played the old tune: \n\n\n\n\n\n&gt; *Ach du lieber Augustin,   \n&gt;  \n&gt; Alles ist weg, weg, weg!*\n\n \nBut the greatest charm of all about it was, that by holding one\&#39;s finger in the steam one could immediately smell all the dinners that were being cooked at every stove in the town. Now this was a very different matter from a rose. \n\n\nThe princess came walking along with all her ladies-in-waiting, and when she heard the tune she stopped and looked pleased, for she herself could play its melody on the piano, but only with one finger. \n\n\n&quot;Why, that is my song,&quot; she said. &quot;This must be a cultivated swineherd. Go and ask him what the instrument costs.&quot; \n\n\nSo one of the ladies-in-waiting had to go into his room, but she put clogs on first. \n\n\n&quot;How much do you want for the pot,&quot; she asked. \n\n\n&quot;I must have ten kisses from the princess,&quot; said the swineherd. \n\n\n&quot;Heaven preserve us!&quot; said the lady. \n\n\n&quot;I won\&#39;t take less,&quot; said the swineherd. \n\n\n&quot;Well, what does he say?&quot; asked the princess. \n\n\n&quot;I really cannot tell you,&quot; said the lady-in-waiting. &quot;It is so shocking.&quot; \n\n\n&quot;Then you must whisper it.&quot; \n\n\nAnd she whispered it. \n\n\n&quot;He is a wretch!&quot; said the princess, and went away at once. But she had only gone a little way when she heard the bells tinkling beautifully: \n\n\n\n\n\n&gt; *Ach du lieber Augustin.*\n\n \n&quot;Go and ask him if he will take ten kisses from the ladies-in-waiting.&quot; \n\n\n&quot;No, thank you,&quot; said the swineherd. &quot;Ten kisses from the princess, or I keep my pot.&quot; \n\n\n&quot;How tiresome it is,&quot; said the princess. &quot;Then you will have to stand round me, so that no one may see.&quot; \n\n\nSo the ladies-in-waiting stood round her and spread out their skirts while the swineherd took his ten kisses, and then the pot was hers. \n\n\nWhat a delight it was to them. The pot was kept on the boil day and night. They knew what was cooking on every stove in the town, from the chamberlain\&#39;s to the shoemaker\&#39;s. The ladies-in-waiting danced about and clapped their hands. \n\n\n&quot;We know who has sweet soup and pancakes for dinner, and who has cutlets. How amusing it is.&quot; \n\n\n&quot;Highly interesting,&quot; said the mistress of the robes. \n\n\n&quot;Yes, but hold your tongues, for I am the emperor\&#39;s daughter.&quot; \n\n\n&quot;Heaven preserve us!&quot; they all said. \n\n\nThe swineherd -- that is to say, the prince, only nobody knew that he was not a real swineherd -- did not let the day pass in idleness, and he now constructed a rattle. When it was swung round it played all the waltzes, gallops and jig tunes which have ever been heard since the creation of the world. \n\n\n&quot;But this is *superbe*!&quot; said the princess, as she walked by. &quot;I have never heard finer compositions. Go and ask him what the instrument costs, but let us have no more kissing.&quot; \n\n\n&quot;He wants a hundred kisses from the princess!&quot; said the lady-in-waiting. \n\n\n&quot;I think he is mad!&quot; said the princess, and she went away, but she had not gone far when she stopped. \n\n\n&quot;One must encourage art,&quot; she said; &quot;I am the emperor\&#39;s daughter. Tell him he can have ten kisses, the same as yesterday, and he can take the others from the ladies-in-waiting.&quot; \n\n\n&quot;But we don\&#39;t like that at all,&quot; said the ladies. \n\n\n&quot;Oh, nonsense! If I can kiss him you can do the same. Remember that I pay your wages as well as give you board and lodging.&quot; \n\n\nSo the lady-in-waiting had to go again. \n\n\n&quot;A hundred kisses from the princess, or let each keep his own.&quot; \n\n\n&quot;Stand in front of me,&quot; said she, and all the ladies stood round, while he kissed her. \n\n\n&quot;Whatever is the meaning of that crowd round the pig-sties?&quot; said the emperor as he stepped out onto the balcony; he rubbed his eyes and put on his spectacles. &quot;Why it is the ladies-in-waiting, what game are they up to? I must go and see!&quot; \n\n\nSo he pulled up the heels of his slippers for they were shoes which he had trodden down. Bless us, what a hurry he was in! When he got into the yard, he walked very softly and the ladies were so busy counting the kisses, so that there should be fair play, and neither too few nor too many kisses, that they never heard the emperor. He stood on tiptoe. \n\n\n&quot;What is all this?&quot; he said when he saw what was going on, and he hit them on the head with his slipper just as the swineherd was taking the eighty-sixth kiss. \n\n\n&quot;Out you go!&quot; said the emperor, for he was furious, and both the princess and the prince were put out of his realm. There she stood crying, and the swineherd scolded, and the rain poured down in torrents. \n\n\n&quot;Oh, miserable creature that I am! If only I had accepted the handsome prince. Oh, how unhappy I am!&quot; \n\n\nThe swineherd went behind a tree, wiped the black and brown stain from his face, and threw away his ugly clothes. Then he stepped out dressed as a prince. He was so handsome that the princess could not help curtseying to him. \n\n\n&quot;I am come to despise you,&quot; he said. &quot;You would not have an honorable prince, you could not prize the rose or the nightingale, but you would kiss the swineherd for a trumpery musical box! As you have made your bed, so must you lie upon it!&quot; \n\n\nThen he went back into his own little kingdom and shut and locked, the door. \n\n\nSo she had to stand outside and sing in earnest: \n\n\n\n\n\n&gt; *Ach du lieber Augustin   \n&gt;  \n&gt; Alles ist weg, weg, weg!*&#39;,
  &#39;title&#39;: &#39;The Swineherd&#39;,
  &#39;subheading&#39;: &#39;Hans Christian Andersen&#39;},
 {&#39;generic_type&#39;: &#39;The Birthmarks of the Princess&#39;,
  &#39;atu&#39;: &#39;850&#39;,
  &#39;metadata&#39;: &#39;&#39;,
  &#39;url&#39;: &#39;https://sites.pitt.edu/~dash/type0850.html&#39;,
  &#39;text&#39;: &#39;Additional type 850 tales\n-------------------------\n\n\n### Copyrighted stories, not in the public domain\n\n\n1. Abrahams, Roger D. &quot;Golden Breasts, Diamond Navel, Chain of Gold.&quot; *Afro-American Folktales: Tales from Black Traditions in the New World*. New York: Pantheon Books, 1985. Pp. 223-29.\n2. Afanas\&#39;ev, Aleksandr. &quot;The Self-Playing Gusla.&quot; *Russian Fairy Tales.* Translated by Norbert Guterman. New York: Pantheon Books, 1975. Pp. 211-13.\n3. Dorson, Richard M. &quot;The Swineherd Who Married a Princess&quot; (Germany). *Folktales Told around the World*. Chicago and London: University of Chicago Press, 1975. Pp. 87-90.\n4. Pino-Saavedra, Yolando. &quot;The Simple Lad and the Three Little Pigs,&quot; *Folktales of Chile.* Translated by Rockwell Gray. London: Routledge and Kegan Paul, 1968. No. 32, pp. 165-68.\n5. Ranke, Kurt. &quot;The Swineherd Who Married a Princess.&quot; *Folktales of Germany.* Translated by Lotte Baumann. Chicago: University of Chicago Press, 1966. No. 46, pp. 121-24.\n6. Weinreich, Beatrice Silverman. &quot;The King\&#39;s Lost Daughter.&quot; *Yiddish Folktales.* Translated by Leonard Wolf. New York: Pantheon Books, 1988. No. 39, pp. 112-14.&#39;,
  &#39;title&#39;: &#39;Additional type 850 tales&#39;,
  &#39;subheading&#39;: &#39;Copyrighted stories, not in the public domain&#39;}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">links</span><span class="p">[</span><span class="mi">53</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;https://sites.pitt.edu/~dash/type0850.html&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the structure we&#39;ll be aiming for</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">record = {&quot;title&quot;:&#39;&#39;,</span>
<span class="sd">          &quot;subheading&quot;:&#39;&#39;,</span>
<span class="sd">          &quot;text&quot;: &#39;&#39;,</span>
<span class="sd">          &quot;metadata&quot;: &#39;&#39;,</span>
<span class="sd">          &quot;generic_type&quot;: &#39;&#39;,</span>
<span class="sd">          &quot;atu&quot;: &#39;&#39;, </span>
<span class="sd">          &quot;url&quot;:&#39;&#39;}</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">ORIG_fetch_and_parse_page</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fetch and parse Ashliman story pages.&quot;&quot;&quot;</span>
    
    <span class="n">page_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="n">atu_regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^.*Aarne-Thompson-Uther type (?P&lt;atu&gt;[\da-zA-Z]+).*&quot;</span>
    
    <span class="n">story_records</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">atu</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">generic_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="c1"># Low hanging fruit: ATU in URL</span>
    <span class="n">url_regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^type(?P&lt;atu&gt;[\da-zA-Z]+)\.html&quot;</span>

    <span class="n">_url</span> <span class="o">=</span> <span class="n">_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">matches</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">_url</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">atu</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>

    <span class="c1"># The generic type is the page title</span>
    <span class="c1"># Get the head information</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//h1[@align=&quot;CENTER&quot;]&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">full_text</span>
        <span class="n">generic_type</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c1"># See if an ATU is defined in the header</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atu_regex</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">atu</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>

    <span class="c1"># Now find stories</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">html</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">html</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">page_response</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">html</span>
        <span class="c1"># This pages are old so patch them</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;hr&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;hr/&gt;&quot;</span><span class="p">)</span>
        
    <span class="c1"># Split out the section containing the stories</span>
    <span class="n">story_section</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&lt;hr/&gt;</span><span class="se">\n</span><span class="s2">&lt;p&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">exceptions</span><span class="p">[</span><span class="n">url</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">story_section</span><span class="si">}{</span><span class="n">exceptions</span><span class="p">[</span><span class="n">url</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">stories_html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">story_section</span><span class="p">)</span>
    <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stories_html</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">stories_html</span> <span class="o">=</span> <span class="n">stories_html</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

    <span class="c1"># Chunk the stories</span>
    <span class="n">story_chunks</span> <span class="o">=</span> <span class="n">stories_html</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;hr/&gt;&lt;hr/&gt;&quot;</span><span class="p">)</span>
    <span class="c1"># Some old pages may not have the non-story boilerplate at the end</span>
    <span class="n">story_chunks</span> <span class="o">=</span> <span class="n">story_chunks</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">story_chunks</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">story_chunks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Now iterate through all the stories</span>
    <span class="k">for</span> <span class="n">story_chunk</span> <span class="ow">in</span> <span class="n">story_chunks</span><span class="p">:</span>
        <span class="n">record</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;generic_type&#39;</span><span class="p">:</span> <span class="n">generic_type</span><span class="p">,</span>
                  <span class="s1">&#39;atu&#39;</span><span class="p">:</span><span class="n">atu</span><span class="p">,</span>
                  <span class="s1">&#39;metadata&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
        
        <span class="n">story_chunk_items</span> <span class="o">=</span> <span class="n">story_chunk</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">)</span>
        
        <span class="c1"># Trap any broken html...</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">story_html</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="n">story_chunk_items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">story_html</span><span class="o">.</span><span class="n">full_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># If there is no story text, move on</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]:</span>
            <span class="k">continue</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">story_chunk_items</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">record</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">story_chunk_items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># Check to see if we can find an ATU; if we do, this overrides the page atu</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">atu_regex</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">matches</span><span class="p">:</span>
                <span class="n">record</span><span class="p">[</span><span class="s1">&#39;atu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matches</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;atu&quot;</span><span class="p">)</span>
                
        <span class="c1"># Get title</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">story_html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">title</span> <span class="k">else</span> <span class="n">generic_type</span>
        <span class="c1"># If we have not dropped the contents section, and we can identify it, move on...</span>
        <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="s1">&#39;Contents&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        
        <span class="c1"># Get optional subheading</span>
        <span class="n">subheading</span> <span class="o">=</span> <span class="n">story_html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">)</span>
        <span class="n">subheading</span> <span class="o">=</span> <span class="n">subheading</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">subheading</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;subheading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subheading</span>
        
        <span class="c1"># Depending on the layout, we may get what is essentially a null record</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;folktexts&#39;</span> <span class="ow">and</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span>
            <span class="n">story_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">story_records</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="lang-fairy-books-db.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">A Full Text Searchable Database of Lang’s Fairy Books</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="MTFD-Multilingual_Folk_Tale_Database.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Multilingual Folk Tale Database (MTFD)</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Tony Hirst<br/>
        
            &copy; Copyright 2022.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>